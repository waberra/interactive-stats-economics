<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Regression Hypothesis Testing - Canadian Economics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .canada-header {
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }

        .scenario-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 6px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .scenario-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }

        .scenario-btn.active {
            background-color: #007bff;
        }

        .model-section {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }

        .regression-equation {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #007bff;
            text-align: center;
            font-size: 1.3em;
            font-family: monospace;
            color: #007bff;
            font-weight: bold;
        }

        .data-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .data-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .data-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .data-value {
            font-size: 1.1em;
            color: #007bff;
            font-weight: bold;
        }

        .coef-table-wrapper {
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #007bff;
            overflow-x: auto;
        }

        .coef-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .coef-table th {
            background: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .coef-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }

        .coef-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .calculation-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }

        .prediction-section {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }

        .decision-section {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #9c27b0;
        }

        .input-row {
            display: grid;
            grid-template-columns: 2fr 120px 70px 70px 90px;
            gap: 8px;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 0.9em;
        }

        .input-row label {
            font-weight: bold;
            color: #2c3e50;
        }

        .input-row input {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }

        .input-row select {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }

        .small-button {
            padding: 5px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
        }

        .check-btn {
            background: #17a2b8;
        }

        .answer-btn {
            background: #28a745;
        }

        .steps-btn {
            background: #6f42c1;
        }

        .button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 8px 4px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }

        .button:hover {
            background: #218838;
        }

        .correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }

        .incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }

        .step-instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }

        .tutorial-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            display: none;
        }

        .tutorial-step {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
            font-family: monospace;
            font-size: 0.9em;
        }

        .answer-display {
            background: #d4edda;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #c3e6cb;
            font-weight: bold;
            display: none;
            font-size: 0.9em;
        }

        .formula-box {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 10px 0;
            font-family: monospace;
            text-align: center;
            font-size: 1em;
        }

        .data-table-wrapper {
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #6c757d;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }

        .data-table th {
            background: #6c757d;
            color: white;
            padding: 8px;
            text-align: center;
        }

        .data-table td {
            padding: 6px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üìà Simple Regression Hypothesis Testing - Advanced</h1>

    <div class="canada-header">
        <h2>üá®üá¶ Canadian Economic Simple Linear Regression</h2>
        <p><strong>One Predictor</strong> ‚Ä¢ <strong>Slope Testing</strong> ‚Ä¢ <strong>t-Critical & p-value</strong> ‚Ä¢ <strong>Prediction of Y</strong></p>
    </div>

    <div class="scenario-selector">
        <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50; margin-bottom: 15px;">
            üìä Choose Economic Simple Regression Scenario:
        </div>
        <button class="scenario-btn" onclick="chooseScenario('income-spending')">üí∞ Household Income ‚Üí Monthly Spending</button>
        <button class="scenario-btn" onclick="chooseScenario('interest-investment')">üìâ Interest Rate ‚Üí Business Investment</button>
        <button class="scenario-btn" onclick="chooseScenario('ad-sales')">üì∫ Advertising Spending ‚Üí Sales Revenue</button>
        <button class="scenario-btn" onclick="chooseScenario('unemployment-gdp')">üßë‚Äçüíº Unemployment Rate ‚Üí GDP Growth</button>
    </div>

    <div id="problemArea" style="display:none;">
        <div class="model-section">
            <h3>üìã Economic Regression Model</h3>
            <div class="step-instructions">
                <div id="modelDescription"></div>
            </div>

            <div class="regression-equation" id="regressionEquation">
                Y = Œ≤‚ÇÄ + Œ≤‚ÇÅX + Œµ
            </div>

            <div class="coef-table-wrapper">
                <table class="coef-table">
                    <thead>
                    <tr>
                        <th>Variable</th>
                        <th>Coefficient</th>
                        <th>Std Error</th>
                        <th>t-Stat</th>
                        <th>Lower 95%</th>
                        <th>Upper 95%</th>
                    </tr>
                    </thead>
                    <tbody id="coefTableBody">
                    </tbody>
                </table>
            </div>

            <div class="data-display">
                <div class="data-box">
                    <div class="data-label">Sample Information:</div>
                    <div>Sample size (n): <span id="sampleSize" class="data-value"></span></div>
                    <div>df (for slope test): <span id="dfDisplay" class="data-value"></span></div>
                    <div>R¬≤: <span id="rSquared" class="data-value"></span></div>
                    <div>Standard error of regression: <span id="seReg" class="data-value"></span></div>
                </div>
                <div class="data-box">
                    <div class="data-label">Summaries:</div>
                    <div>Mean X: <span id="meanX" class="data-value"></span></div>
                    <div>Mean Y: <span id="meanY" class="data-value"></span></div>
                    <div>Œ£(X ‚àí XÃÑ)¬≤: <span id="Sxx" class="data-value"></span></div>
                    <div>Œ£(Y ‚àí ≈∂)¬≤ (SSE): <span id="SSE" class="data-value"></span></div>
                </div>
            </div>

            <div class="data-table-wrapper">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>Obs</th>
                        <th id="xHeader"></th>
                        <th id="yHeader"></th>
                        <th>≈∂</th>
                        <th>Residual</th>
                    </tr>
                    </thead>
                    <tbody id="dataTableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="calculation-section">
            <h3>üßÆ Step 1: Inference on the Slope Œ≤‚ÇÅ</h3>
            <div class="step-instructions">
                We test <strong>H‚ÇÄ: Œ≤‚ÇÅ = 0</strong> (no linear relationship) vs <strong>H‚ÇÅ: Œ≤‚ÇÅ ‚â† 0</strong>, using df = n ‚àí 2.
            </div>

            <div class="formula-box">
                t = b‚ÇÅ / SE(b‚ÇÅ), &nbsp;&nbsp; df = n ‚àí 2<br>
                95% CI for Œ≤‚ÇÅ: b‚ÇÅ ¬± t<sub>Œ±/2, n‚àí2</sub> ¬∑ SE(b‚ÇÅ)
            </div>

            <div class="input-row">
                <label for="tCritical">t-critical (two-tailed, Œ± = 0.05):</label>
                <input type="number" id="tCritical" step="0.01" placeholder="t‚ÇÄ.‚ÇÄ‚ÇÇ‚ÇÖ, n‚àí2">
                <button class="small-button check-btn" onclick="checkTCritical()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('tCritical')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('t-critical')">Steps</button>
            </div>
            <div class="answer-display" id="tCritical-answer"></div>
            <div class="tutorial-box" id="t-critical-tutorial"></div>

            <div class="input-row">
                <label for="tStatB1">t-statistic for b‚ÇÅ:</label>
                <input type="number" id="tStatB1" step="0.01" placeholder="b‚ÇÅ / SE(b‚ÇÅ)">
                <button class="small-button check-btn" onclick="checkTStat()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('tStatB1')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('t-b1')">Steps</button>
            </div>
            <div class="answer-display" id="tStatB1-answer"></div>
            <div class="tutorial-box" id="t-b1-tutorial"></div>

            <div class="input-row">
                <label for="pValue">p-value for slope test:</label>
                <input type="number" id="pValue" step="0.001" placeholder="two-tailed p">
                <button class="small-button check-btn" onclick="checkPValue()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('pValue')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('p-value')">Steps</button>
            </div>
            <div class="answer-display" id="pValue-answer"></div>
            <div class="tutorial-box" id="p-value-tutorial"></div>

            <div class="input-row">
                <label for="marginB1">Margin of error for Œ≤‚ÇÅ (95% CI):</label>
                <input type="number" id="marginB1" step="0.01" placeholder="ME for Œ≤‚ÇÅ">
                <button class="small-button check-btn" onclick="checkMargin()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('marginB1')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('margin-b1')">Steps</button>
            </div>
            <div class="answer-display" id="marginB1-answer"></div>
            <div class="tutorial-box" id="margin-b1-tutorial"></div>

            <div class="input-row">
                <label>95% CI for Œ≤‚ÇÅ (lower & upper):</label>
                <input type="number" id="ciLowerB1" step="0.01" placeholder="Lower">
                <input type="number" id="ciUpperB1" step="0.01" placeholder="Upper">
                <button class="small-button check-btn" onclick="checkCI()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('ciB1')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('ci-b1')">Steps</button>
            </div>
            <div class="answer-display" id="ciB1-answer"></div>
            <div class="tutorial-box" id="ci-b1-tutorial"></div>
        </div>

        <div class="decision-section">
            <h3>‚öñÔ∏è Step 2: Hypothesis Testing ‚Äì Three Approaches</h3>
            <div class="step-instructions">
                All three methods should lead to the same decision about H‚ÇÄ: Œ≤‚ÇÅ = 0.
            </div>

            <div class="input-row">
                <label>Decision using t-critical:</label>
                <select id="decisionCritical">
                    <option value="">Choose...</option>
                    <option value="reject">Reject H‚ÇÄ (slope is significant)</option>
                    <option value="fail">Fail to Reject H‚ÇÄ (slope not significant)</option>
                </select>
                <button class="small-button check-btn" onclick="checkDecisionCritical()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('decisionCritical')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('decision-critical')">Steps</button>
            </div>
            <div class="answer-display" id="decisionCritical-answer"></div>
            <div class="tutorial-box" id="decision-critical-tutorial"></div>

            <div class="input-row">
                <label>Decision using p-value:</label>
                <select id="decisionP">
                    <option value="">Choose...</option>
                    <option value="reject">Reject H‚ÇÄ (p ‚â§ 0.05)</option>
                    <option value="fail">Fail to Reject H‚ÇÄ (p &gt; 0.05)</option>
                </select>
                <button class="small-button check-btn" onclick="checkDecisionP()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('decisionP')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('decision-p')">Steps</button>
            </div>
            <div class="answer-display" id="decisionP-answer"></div>
            <div class="tutorial-box" id="decision-p-tutorial"></div>

            <div class="input-row">
                <label>Economic interpretation:</label>
                <select id="interpretation">
                    <option value="">Choose...</option>
                    <option value="significant">X is a significant predictor of Y</option>
                    <option value="not-significant">No significant linear effect of X on Y</option>
                </select>
                <button class="small-button check-btn" onclick="checkInterpretation()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('interpretation')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('interpretation')">Steps</button>
            </div>
            <div class="answer-display" id="interpretation-answer"></div>
            <div class="tutorial-box" id="interpretation-tutorial"></div>
        </div>

        <div class="prediction-section">
            <h3>üîÆ Step 3: Prediction of Y for a Given X</h3>
            <div class="step-instructions">
                Use the fitted line ≈∂ = b‚ÇÄ + b‚ÇÅX to predict Y for a specific value of X.
            </div>

            <div class="formula-box" id="predictionInfo">
                Prediction point will appear here.
            </div>

            <div class="input-row">
                <label id="predictionLabel">Predicted Y at X = ?</label>
                <input type="number" id="predictedY" step="0.01" placeholder="≈∂ at X‚ÇÄ">
                <button class="small-button check-btn" onclick="checkPrediction()">Check</button>
                <button class="small-button answer-btn" onclick="showAnswer('predictedY')">Answer</button>
                <button class="small-button steps-btn" onclick="showSteps('prediction')">Steps</button>
            </div>
            <div class="answer-display" id="predictedY-answer"></div>
            <div class="tutorial-box" id="prediction-tutorial"></div>
        </div>

        <button class="button" onclick="generateNewModel()">üé≤ Generate New Dataset</button>
        <button class="button" onclick="checkAllAnswers()">‚úÖ Check All Answers</button>
        <button class="button" onclick="showCompleteAnalysis()">üìñ Complete Analysis</button>
    </div>
</div>

<script>
    let currentScenario = '';
    let modelData = {};
    let correctAnswers = {};

    const scenarios = {
        'income-spending': {
            name: 'Household Income vs Monthly Spending',
            description: 'Statistics Canada examining whether higher-income households spend more each month.',
            yName: 'Monthly Spending ($)',
            xName: 'Household Income ($1000s)',
            context: 'consumer spending behaviour',
            params: { intercept: 400, slope: 30, xStart: 30, xStep: 3, xJitter: 2, noise: 80 }
        },
        'interest-investment': {
            name: 'Interest Rate vs Business Investment',
            description: 'Bank of Canada studying how interest rates affect business investment.',
            yName: 'Business Investment ($ millions)',
            xName: 'Interest Rate (%)',
            context: 'monetary policy and investment',
            params: { intercept: 800, slope: -40, xStart: 1.5, xStep: 0.3, xJitter: 0.15, noise: 40 }
        },
        'ad-sales': {
            name: 'Advertising Spending vs Sales Revenue',
            description: 'A Canadian retailer analyzing whether more advertising boosts monthly sales.',
            yName: 'Sales Revenue ($ thousands)',
            xName: 'Advertising Spending ($ thousands)',
            context: 'marketing effectiveness',
            params: { intercept: 120, slope: 6, xStart: 10, xStep: 2, xJitter: 1, noise: 25 }
        },
        'unemployment-gdp': {
            name: 'Unemployment Rate vs GDP Growth',
            description: 'Finance Canada examining whether higher unemployment is associated with lower GDP growth.',
            yName: 'GDP Growth (%)',
            xName: 'Unemployment Rate (%)',
            context: 'labour market and growth',
            params: { intercept: 5, slope: -0.6, xStart: 4, xStep: 0.5, xJitter: 0.2, noise: 0.8 }
        }
    };

    function chooseScenario(scenarioKey) {
        currentScenario = scenarioKey;
        document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
        if (typeof event !== 'undefined') { event.target.classList.add('active'); }

        generateModelData(scenarioKey);
        document.getElementById('problemArea').style.display = 'block';
        clearAllInputs();
    }

    function generateModelData(scenarioKey) {
        const sc = scenarios[scenarioKey];
        const p = sc.params;
        const n = 12 + Math.floor(Math.random() * 7); // 12‚Äì18 obs

        let x = [];
        let y = [];

        for (let i = 0; i < n; i++) {
            const baseX = p.xStart + i * p.xStep;
            const xi = baseX + (Math.random() - 0.5) * 2 * p.xJitter;
            const noise = (Math.random() - 0.5) * 2 * p.noise;
            const yi = p.intercept + p.slope * xi + noise;
            x.push(xi);
            y.push(yi);
        }

        const stats = computeRegressionStats(x, y);

        modelData = {
            scenarioName: sc.name,
            description: sc.description,
            xName: sc.xName,
            yName: sc.yName,
            context: sc.context,
            x: x,
            y: y,
            n: n,
            stats: stats,
            alpha: 0.05
        };

        calculateCorrectAnswers();
        updateDisplay();
    }

    function computeRegressionStats(x, y) {
        const n = x.length;
        let sumX = 0, sumY = 0;
        for (let i = 0; i < n; i++) {
            sumX += x[i];
            sumY += y[i];
        }
        const meanX = sumX / n;
        const meanY = sumY / n;

        let Sxx = 0, Syy = 0, Sxy = 0;
        for (let i = 0; i < n; i++) {
            const dx = x[i] - meanX;
            const dy = y[i] - meanY;
            Sxx += dx * dx;
            Syy += dy * dy;
            Sxy += dx * dy;
        }

        const b1 = Sxy / Sxx;
        const b0 = meanY - b1 * meanX;

        let SSE = 0;
        let yHat = [];
        let residuals = [];
        for (let i = 0; i < n; i++) {
            const yhat = b0 + b1 * x[i];
            yHat.push(yhat);
            const e = y[i] - yhat;
            residuals.push(e);
            SSE += e * e;
        }

        const df = n - 2;
        const MSE = SSE / df;
        const seReg = Math.sqrt(MSE);
        const seB1 = Math.sqrt(MSE / Sxx);
        const tB1 = b1 / seB1;
        const rSquared = 1 - SSE / Syy;

        return {
            n,
            meanX,
            meanY,
            Sxx,
            Syy,
            Sxy,
            b0,
            b1,
            yHat,
            residuals,
            SSE,
            MSE,
            seReg,
            seB1,
            tB1,
            rSquared,
            df
        };
    }

    function approximateTCritical(df) {
        if (df <= 1) return 12.706;
        if (df === 2) return 4.303;
        if (df === 3) return 3.182;
        if (df === 4) return 2.776;
        if (df === 5) return 2.571;
        if (df === 6) return 2.447;
        if (df === 7) return 2.365;
        if (df === 8) return 2.306;
        if (df === 9) return 2.262;
        if (df === 10) return 2.228;
        if (df === 11) return 2.201;
        if (df === 12) return 2.179;
        if (df === 13) return 2.160;
        if (df === 14) return 2.145;
        if (df === 15) return 2.131;
        if (df === 16) return 2.120;
        if (df === 17) return 2.110;
        if (df === 18) return 2.101;
        if (df === 19) return 2.093;
        if (df === 20) return 2.086;
        if (df <= 30) return 2.042;
        if (df <= 40) return 2.021;
        if (df <= 60) return 2.000;
        return 1.96;
    }

    function calculateCorrectAnswers() {
        const s = modelData.stats;
        const df = s.df;
        const tCritical = approximateTCritical(df);
        const t = s.tB1;
        const absT = Math.abs(t);

        let p;
        if (absT > tCritical * 2.2) p = 0.001;
        else if (absT > tCritical * 1.6) p = 0.01;
        else if (absT > tCritical) p = 0.05;
        else if (absT > tCritical * 0.7) p = 0.10;
        else p = 0.20;

        const decision = absT > tCritical ? 'reject' : 'fail';
        const interpretation = decision === 'reject' ? 'significant' : 'not-significant';

        const margin = tCritical * s.seB1;
        const ciLower = s.b1 - margin;
        const ciUpper = s.b1 + margin;

        // prediction point
        const minX = Math.min(...modelData.x);
        const maxX = Math.max(...modelData.x);
        const predX = minX + Math.random() * (maxX - minX);
        const predY = s.b0 + s.b1 * predX;

        correctAnswers = {
            tCritical,
            tB1: t,
            pValue: p,
            decision,
            interpretation,
            marginB1: margin,
            ciLowerB1: ciLower,
            ciUpperB1: ciUpper,
            predX,
            predY
        };
    }

    function updateDisplay() {
        const s = modelData.stats;

        document.getElementById('modelDescription').innerHTML =
            `<strong>${modelData.scenarioName}</strong><br>${modelData.description}`;

        document.getElementById('regressionEquation').textContent =
            `${modelData.yName} = ${s.b0.toFixed(2)} + ${s.b1.toFixed(2)} √ó (${modelData.xName})`;

        document.getElementById('sampleSize').textContent = modelData.n;
        document.getElementById('dfDisplay').textContent = `${s.df} = n ‚àí 2`;
        document.getElementById('rSquared').textContent = s.rSquared.toFixed(3);
        document.getElementById('seReg').textContent = s.seReg.toFixed(3);
        document.getElementById('meanX').textContent = s.meanX.toFixed(2);
        document.getElementById('meanY').textContent = s.meanY.toFixed(2);
        document.getElementById('Sxx').textContent = s.Sxx.toFixed(2);
        document.getElementById('SSE').textContent = s.SSE.toFixed(2);

        const coefBody = document.getElementById('coefTableBody');
        coefBody.innerHTML = `
            <tr>
                <td><strong>Intercept (b‚ÇÄ)</strong></td>
                <td>${s.b0.toFixed(3)}</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
                <td>‚Äî</td>
            </tr>
            <tr>
                <td><strong>Slope (b‚ÇÅ) on ${modelData.xName}</strong></td>
                <td>${s.b1.toFixed(3)}</td>
                <td>${s.seB1.toFixed(3)}</td>
                <td>${s.tB1.toFixed(2)}</td>
                <td>${correctAnswers.ciLowerB1.toFixed(3)}</td>
                <td>${correctAnswers.ciUpperB1.toFixed(3)}</td>
            </tr>
        `;

        const dataBody = document.getElementById('dataTableBody');
        dataBody.innerHTML = '';
        document.getElementById('xHeader').textContent = modelData.xName;
        document.getElementById('yHeader').textContent = modelData.yName;
        for (let i = 0; i < modelData.n; i++) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${i + 1}</td>
                <td>${modelData.x[i].toFixed(2)}</td>
                <td>${modelData.y[i].toFixed(2)}</td>
                <td>${s.yHat[i].toFixed(2)}</td>
                <td>${s.residuals[i].toFixed(2)}</td>
            `;
            dataBody.appendChild(row);
        }

        document.getElementById('predictionInfo').textContent =
            `Use ≈∂ = ${s.b0.toFixed(2)} + ${s.b1.toFixed(2)}X to predict Y when X = ${correctAnswers.predX.toFixed(2)}.`;
        document.getElementById('predictionLabel').textContent =
            `Predicted ${modelData.yName} at ${modelData.xName} = ${correctAnswers.predX.toFixed(2)}:`;
    }

    function checkAnswer(inputId, correctValue, tolerance) {
        const input = document.getElementById(inputId);
        const val = parseFloat(input.value);
        if (isNaN(val)) {
            input.className = '';
            return false;
        }
        const ok = Math.abs(val - correctValue) <= tolerance;
        input.className = ok ? 'correct' : 'incorrect';
        return ok;
    }

    function checkTCritical() { return checkAnswer('tCritical', correctAnswers.tCritical, 0.05); }
    function checkTStat() { return checkAnswer('tStatB1', correctAnswers.tB1, 0.2); }
    function checkPValue() { return checkAnswer('pValue', correctAnswers.pValue, 0.02); }
    function checkMargin() { return checkAnswer('marginB1', correctAnswers.marginB1, 0.1); }

    function checkCI() {
        const lowerOK = checkAnswer('ciLowerB1', correctAnswers.ciLowerB1, 0.1);
        const upperOK = checkAnswer('ciUpperB1', correctAnswers.ciUpperB1, 0.1);
        return lowerOK && upperOK;
    }

    function checkDecisionCritical() {
        const sel = document.getElementById('decisionCritical');
        const ok = sel.value === correctAnswers.decision;
        sel.style.backgroundColor = ok ? '#d4edda' : '#f8d7da';
        sel.style.borderColor = ok ? '#c3e6cb' : '#f5c6cb';
        return ok;
    }

    function checkDecisionP() {
        const sel = document.getElementById('decisionP');
        const ok = sel.value === correctAnswers.decision;
        sel.style.backgroundColor = ok ? '#d4edda' : '#f8d7da';
        sel.style.borderColor = ok ? '#c3e6cb' : '#f5c6cb';
        return ok;
    }

    function checkInterpretation() {
        const sel = document.getElementById('interpretation');
        const ok = sel.value === correctAnswers.interpretation;
        sel.style.backgroundColor = ok ? '#d4edda' : '#f8d7da';
        sel.style.borderColor = ok ? '#c3e6cb' : '#f5c6cb';
        return ok;
    }

    function checkPrediction() {
        return checkAnswer('predictedY', correctAnswers.predY, 0.5);
    }

    function showAnswer(inputId) {
        const div = document.getElementById(inputId + '-answer');
        if (!div) return;

        switch (inputId) {
            case 'tCritical':
                div.innerHTML = `‚úÖ t-critical ‚âà ¬±${correctAnswers.tCritical.toFixed(3)} (two-tailed, df = ${modelData.stats.df})`;
                break;
            case 'tStatB1':
                div.innerHTML = `‚úÖ t-statistic for b‚ÇÅ = ${correctAnswers.tB1.toFixed(2)}`;
                break;
            case 'pValue':
                div.innerHTML = `‚úÖ p-value ‚âà ${correctAnswers.pValue.toFixed(3)}`;
                break;
            case 'marginB1':
                div.innerHTML = `‚úÖ Margin of error for Œ≤‚ÇÅ ‚âà ${correctAnswers.marginB1.toFixed(3)}`;
                break;
            case 'ciB1':
                div.innerHTML = `‚úÖ 95% CI for Œ≤‚ÇÅ ‚âà [${correctAnswers.ciLowerB1.toFixed(3)}, ${correctAnswers.ciUpperB1.toFixed(3)}]`;
                break;
            case 'decisionCritical':
            case 'decisionP':
                div.innerHTML = `‚úÖ Decision: ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ (slope is significant)' : 'Fail to Reject H‚ÇÄ (slope not significant)'}`;
                break;
            case 'interpretation':
                div.innerHTML = correctAnswers.interpretation === 'significant'
                    ? '‚úÖ X is a significant predictor of Y in this model.'
                    : '‚úÖ No statistically significant linear effect of X on Y.';
                break;
            case 'predictedY':
                div.innerHTML = `‚úÖ ≈∂ at X = ${correctAnswers.predX.toFixed(2)} is approximately ${correctAnswers.predY.toFixed(2)}`;
                break;
        }
        div.style.display = 'block';
    }

    function showSteps(stepType) {
        const div = document.getElementById(stepType + '-tutorial');
        const s = modelData.stats;

        if (stepType === 't-critical') {
            div.innerHTML = `
                <h4>üìö Finding t-critical (two-tailed):</h4>
                <div class="tutorial-step">
                    df = n ‚àí 2 = ${modelData.n} ‚àí 2 = ${s.df}<br><br>
                    For Œ± = 0.05 two-tailed, look up t<sub>0.025, df=${s.df}</sub> in the t-table.<br>
                    Approximate value: t-critical ‚âà ${correctAnswers.tCritical.toFixed(3)}.<br><br>
                    Use this for the CI and critical-value test.
                </div>`;
        } else if (stepType === 't-b1') {
            div.innerHTML = `
                <h4>üìö Calculating the t-statistic for b‚ÇÅ:</h4>
                <div class="tutorial-step">
                    b‚ÇÅ = ${s.b1.toFixed(3)}<br>
                    SE(b‚ÇÅ) = ‚àö[MSE / Œ£(X ‚àí XÃÑ)¬≤] = ${s.seB1.toFixed(3)}<br><br>
                    t = b‚ÇÅ / SE(b‚ÇÅ) = ${s.b1.toFixed(3)} / ${s.seB1.toFixed(3)} = ${s.tB1.toFixed(2)}.<br><br>
                    Large |t| suggests strong evidence against H‚ÇÄ: Œ≤‚ÇÅ = 0.
                </div>`;
        } else if (stepType === 'p-value') {
            div.innerHTML = `
                <h4>üìö Interpreting the p-value:</h4>
                <div class="tutorial-step">
                    Test statistic: t = ${s.tB1.toFixed(2)}, df = ${s.df}.<br><br>
                    p-value = 2¬∑P(T ‚â• |t|) under H‚ÇÄ with df = ${s.df}.<br>
                    Approximate p-value used here: p ‚âà ${correctAnswers.pValue.toFixed(3)}.<br><br>
                    Compare to Œ± = 0.05:<br>
                    ‚Ä¢ If p ‚â§ 0.05 ‚Üí Reject H‚ÇÄ.<br>
                    ‚Ä¢ If p &gt; 0.05 ‚Üí Fail to Reject H‚ÇÄ.
                </div>`;
        } else if (stepType === 'margin-b1') {
            div.innerHTML = `
                <h4>üìö Margin of Error for Œ≤‚ÇÅ:</h4>
                <div class="tutorial-step">
                    ME = t<sub>Œ±/2, df</sub> ¬∑ SE(b‚ÇÅ)<br><br>
                    t<sub>0.025, ${s.df}</sub> ‚âà ${correctAnswers.tCritical.toFixed(3)}<br>
                    SE(b‚ÇÅ) = ${s.seB1.toFixed(3)}<br><br>
                    ME = ${correctAnswers.tCritical.toFixed(3)} √ó ${s.seB1.toFixed(3)} ‚âà ${correctAnswers.marginB1.toFixed(3)}.
                </div>`;
        } else if (stepType === 'ci-b1') {
            div.innerHTML = `
                <h4>üìö 95% CI for Œ≤‚ÇÅ:</h4>
                <div class="tutorial-step">
                    CI: b‚ÇÅ ¬± t<sub>Œ±/2, df</sub> ¬∑ SE(b‚ÇÅ)<br><br>
                    b‚ÇÅ = ${s.b1.toFixed(3)}<br>
                    ME = ${correctAnswers.marginB1.toFixed(3)}<br><br>
                    Lower = ${s.b1.toFixed(3)} ‚àí ${correctAnswers.marginB1.toFixed(3)} = ${correctAnswers.ciLowerB1.toFixed(3)}<br>
                    Upper = ${s.b1.toFixed(3)} + ${correctAnswers.marginB1.toFixed(3)} = ${correctAnswers.ciUpperB1.toFixed(3)}<br><br>
                    If 0 is outside this interval, the slope is statistically significant.
                </div>`;
        } else if (stepType === 'decision-critical') {
            div.innerHTML = `
                <h4>üìö Decision Using t-critical:</h4>
                <div class="tutorial-step">
                    |t| = ${Math.abs(s.tB1).toFixed(2)}, t-critical = ${correctAnswers.tCritical.toFixed(3)}.<br><br>
                    If |t| &gt; t-critical ‚Üí Reject H‚ÇÄ.<br>
                    If |t| ‚â§ t-critical ‚Üí Fail to Reject H‚ÇÄ.<br><br>
                    Here: |t| ${Math.abs(s.tB1) > correctAnswers.tCritical ? '&gt;' : '‚â§'} t-critical ‚Üí ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}.
                </div>`;
        } else if (stepType === 'decision-p') {
            div.innerHTML = `
                <h4>üìö Decision Using p-value:</h4>
                <div class="tutorial-step">
                    p ‚âà ${correctAnswers.pValue.toFixed(3)}, Œ± = 0.05.<br><br>
                    If p ‚â§ Œ± ‚Üí Reject H‚ÇÄ.<br>
                    If p &gt; Œ± ‚Üí Fail to Reject H‚ÇÄ.<br><br>
                    Here: p ${correctAnswers.pValue <= 0.05 ? '‚â§' : '&gt;'} Œ± ‚Üí ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}.
                </div>`;
        } else if (stepType === 'interpretation') {
            const msg = correctAnswers.interpretation === 'significant'
                ? `There is evidence of a significant linear relationship between ${modelData.xName} and ${modelData.yName}.`
                : `We do not find a statistically significant linear effect of ${modelData.xName} on ${modelData.yName}.`;
            div.innerHTML = `
                <h4>üìö Economic Interpretation:</h4>
                <div class="tutorial-step">
                    Statistical decision: ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'} (based on t and p).<br><br>
                    Economic meaning:<br>
                    ${msg}<br><br>
                    Context: ${modelData.context}.
                </div>`;
        } else if (stepType === 'prediction') {
            div.innerHTML = `
                <h4>üìö Prediction Using the Regression Line:</h4>
                <div class="tutorial-step">
                    Fitted line: ≈∂ = ${s.b0.toFixed(2)} + ${s.b1.toFixed(2)}X<br><br>
                    Prediction point: X‚ÇÄ = ${correctAnswers.predX.toFixed(2)}<br>
                    ≈∂‚ÇÄ = ${s.b0.toFixed(2)} + ${s.b1.toFixed(2)} √ó ${correctAnswers.predX.toFixed(2)} = ${correctAnswers.predY.toFixed(2)}.<br><br>
                    This is a <em>point prediction</em> for the expected value of Y when X = ${correctAnswers.predX.toFixed(2)}.
                </div>`;
        }

        div.style.display = div.style.display === 'none' ? 'block' : 'none';
    }

    function checkAllAnswers() {
        const results = [
            checkTCritical(),
            checkTStat(),
            checkPValue(),
            checkMargin(),
            checkCI(),
            checkDecisionCritical(),
            checkDecisionP(),
            checkInterpretation(),
            checkPrediction()
        ];

        const correct = results.filter(Boolean).length;
        const total = results.length;
        alert(`You got ${correct}/${total} items correct.\n\n${correct === total ? 'Excellent simple regression analysis! üéâ' : 'Use the Steps buttons to review any incorrect parts.'}`);
    }

    function generateNewModel() {
        if (!currentScenario) {
            alert('Please select a scenario first.');
            return;
        }
        generateModelData(currentScenario);
        clearAllInputs();
    }

    function clearAllInputs() {
        const numInputs = ['tCritical', 'tStatB1', 'pValue', 'marginB1', 'ciLowerB1', 'ciUpperB1', 'predictedY'];
        numInputs.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.value = '';
                el.className = '';
            }
            const ans = document.getElementById(id + '-answer');
            if (ans) ans.style.display = 'none';
        });

        const selects = ['decisionCritical', 'decisionP', 'interpretation'];
        selects.forEach(id => {
            const sel = document.getElementById(id);
            if (sel) {
                sel.value = '';
                sel.style.backgroundColor = '';
                sel.style.borderColor = '';
            }
            const ans = document.getElementById(id + '-answer');
            if (ans) ans.style.display = 'none';
        });

        const tutorials = ['t-critical', 't-b1', 'p-value', 'margin-b1', 'ci-b1',
            'decision-critical', 'decision-p', 'interpretation', 'prediction'];
        tutorials.forEach(id => {
            const div = document.getElementById(id + '-tutorial');
            if (div) div.style.display = 'none';
        });
    }

    function showCompleteAnalysis() {
        if (!currentScenario) {
            alert('Please select a scenario first.');
            return;
        }
        const s = modelData.stats;
        const text =
`Complete Simple Regression Analysis

Scenario: ${modelData.scenarioName}

Model:
${modelData.yName} = ${s.b0.toFixed(3)} + ${s.b1.toFixed(3)} √ó (${modelData.xName})

Sample:
n = ${modelData.n}, df = ${s.df}
R¬≤ = ${s.rSquared.toFixed(3)}
SSE = ${s.SSE.toFixed(2)}, MSE = ${s.MSE.toFixed(2)}

Slope inference:
b‚ÇÅ = ${s.b1.toFixed(3)}, SE(b‚ÇÅ) = ${s.seB1.toFixed(3)}
t = ${s.tB1.toFixed(2)}, t-critical ‚âà ${correctAnswers.tCritical.toFixed(3)}
p ‚âà ${correctAnswers.pValue.toFixed(3)}
95% CI for Œ≤‚ÇÅ ‚âà [${correctAnswers.ciLowerB1.toFixed(3)}, ${correctAnswers.ciUpperB1.toFixed(3)}]

Decision: ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ: Œ≤‚ÇÅ = 0' : 'Fail to Reject H‚ÇÄ: insufficient evidence that Œ≤‚ÇÅ ‚â† 0'}

Prediction:
At X = ${correctAnswers.predX.toFixed(2)}, ≈∂ ‚âà ${correctAnswers.predY.toFixed(2)}

Context: ${modelData.context}.`;

        alert(text);
    }
</script>
</body>
</html>
