<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi-Square Hypothesis Testing - Canadian Economics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        .canada-header {
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .scenario-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 6px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }
        
        .scenario-btn.active {
            background-color: #007bff;
        }
        
        .hypothesis-section {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }
        
        .hypothesis-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #007bff;
        }
        
        .hypothesis-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            font-size: 1.1em;
            font-family: monospace;
        }
        
        .data-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }
        
        .contingency-table {
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #007bff;
            overflow-x: auto;
        }
        
        .chi-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .chi-table th {
            background: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .chi-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .chi-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .observed-cell {
            background: #e8f5e8;
            font-weight: bold;
        }
        
        .expected-cell {
            background: #fff8e1;
            color: #856404;
        }
        
        .calculation-section {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #9c27b0;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 2fr 120px 70px 70px 90px;
            gap: 8px;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 0.9em;
        }
        
        .input-row label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-row input {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .input-row select {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .small-button {
            padding: 5px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
        }
        
        .check-btn {
            background: #17a2b8;
        }
        
        .answer-btn {
            background: #28a745;
        }
        
        .steps-btn {
            background: #6f42c1;
        }
        
        .button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 8px 4px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        
        .button:hover {
            background: #218838;
        }
        
        .correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        
        .incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }
        
        .step-instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .tutorial-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            display: none;
        }
        
        .tutorial-step {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .answer-display {
            background: #d4edda;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #c3e6cb;
            font-weight: bold;
            display: none;
            font-size: 0.9em;
        }
        
        .decision-section {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }
        
        .formula-box {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 10px 0;
            font-family: monospace;
            text-align: center;
            font-size: 1em;
        }
        
        .expected-calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .expected-cell-calc {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.85em;
        }
        
        .test-type-selector {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Chi-Square Hypothesis Testing - Advanced</h1>
        
        <div class="canada-header">
            <h2>üá®üá¶ Canadian Economic Categorical Data Analysis</h2>
            <p><strong>Independence Testing</strong> ‚Ä¢ <strong>Goodness of Fit</strong> ‚Ä¢ <strong>Expected Frequencies</strong> ‚Ä¢ <strong>Three Decision Methods</strong></p>
        </div>
        
        <div class="scenario-selector">
            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50; margin-bottom: 15px;">
                üìä Choose Chi-Square Testing Scenario:
            </div>
            <button class="scenario-btn" onclick="chooseScenario('employment-province')">üíº Employment vs Province</button>
            <button class="scenario-btn" onclick="chooseScenario('industry-size')">üè≠ Industry vs Company Size</button>
            <button class="scenario-btn" onclick="chooseScenario('investment-age')">üí∞ Investment vs Age</button>
            <button class="scenario-btn" onclick="chooseScenario('spending-income')">üõí Spending vs Income</button>
        </div>
        
        <div id="problemArea" style="display: none;">
            <div class="hypothesis-section">
                <h3>üìã Step 1: Formulating Chi-Square Hypotheses</h3>
                <div class="step-instructions">
                    <div id="scenarioDescription"></div>
                </div>
                
                <div class="test-type-selector">
                    <div style="font-weight: bold; margin-bottom: 10px;">üî¨ Type of Chi-Square Test:</div>
                    <div id="testTypeDisplay" style="font-size: 1.1em; color: #007bff; font-weight: bold;"></div>
                    <div id="testExplanation" style="margin-top: 10px; font-style: italic;"></div>
                </div>
                
                <div class="hypothesis-display">
                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 15px;">üéØ Null and Alternative Hypotheses:</div>
                    <div class="hypothesis-box">
                        <div id="h0Display" style="margin: 8px 0; color: #dc3545;"><strong>H‚ÇÄ:</strong> Loading...</div>
                        <div id="h1Display" style="margin: 8px 0; color: #007bff;"><strong>H‚ÇÅ:</strong> Loading...</div>
                    </div>
                    <div style="margin-top: 15px;">
                        <strong>üßÆ Test Statistic:</strong> œá¬≤ = Œ£[(Observed - Expected)¬≤/Expected]<br>
                        <strong>üìê Degrees of Freedom:</strong> <span id="degreesOfFreedom">Calculate after selecting scenario</span>
                    </div>
                </div>
            </div>
            
            <div class="data-section">
                <h3>üìä Step 2: Observed Data (Contingency Table)</h3>
                <div class="step-instructions">
                    <strong>Observed frequencies</strong> from the sample data:
                </div>
                
                <div class="contingency-table" id="observedTable">
                    <!-- Will be populated dynamically -->
                </div>
                
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0;">
                    <div style="font-weight: bold;">Sample Information:</div>
                    <div>Total Sample Size (n): <span id="totalSample" style="color: #007bff; font-weight: bold;"></span></div>
                    <div>Significance Level (Œ±): <span style="color: #007bff; font-weight: bold;">0.05</span></div>
                </div>
            </div>
            
            <div class="calculation-section">
                <h3>üìä Step 3: Calculate Expected Frequencies</h3>
                <div class="step-instructions">
                    <strong>Formula:</strong> Expected = (Row Total √ó Column Total) / Grand Total
                </div>
                
                <div id="expectedCalculations">
                    <!-- Expected frequency calculations will be populated dynamically -->
                </div>
                
                <div class="contingency-table" id="expectedTable">
                    <!-- Expected frequencies table will be populated dynamically -->
                </div>
            </div>
            
            <div class="calculation-section">
                <h3>üßÆ Step 4: Calculate Chi-Square Test Statistic</h3>
                <div class="step-instructions">
                    <strong>Calculate œá¬≤ for each cell, then sum:</strong> œá¬≤ = Œ£[(O-E)¬≤/E]
                </div>
                
                <div class="formula-box">
                    œá¬≤ = Œ£[(Observed - Expected)¬≤/Expected]
                </div>
                
                <div class="input-row">
                    <label for="chiSquareCalc">Chi-Square Test Statistic:</label>
                    <input type="number" id="chiSquareCalc" step="0.001" placeholder="Calculate œá¬≤">
                    <button class="small-button check-btn" onclick="checkChiSquare()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('chiSquareCalc')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('chi-square-calc')">Steps</button>
                </div>
                
                <div class="answer-display" id="chiSquareCalc-answer"></div>
                <div class="tutorial-box" id="chi-square-calc-tutorial"></div>
                
                <div class="input-row">
                    <label for="degreesOfFreedomCalc">Degrees of Freedom:</label>
                    <input type="number" id="degreesOfFreedomCalc" step="1" placeholder="Calculate df">
                    <button class="small-button check-btn" onclick="checkDegreesOfFreedom()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('degreesOfFreedomCalc')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('degrees-freedom')">Steps</button>
                </div>
                
                <div class="answer-display" id="degreesOfFreedomCalc-answer"></div>
                <div class="tutorial-box" id="degrees-freedom-tutorial"></div>
            </div>
            
            <div class="decision-section">
                <h3>‚öñÔ∏è Step 5: Three Decision Methods</h3>
                <div class="step-instructions">
                    <strong>All three methods must give the SAME decision:</strong><br>
                    <strong>1. Critical Value:</strong> Compare œá¬≤ to œá¬≤-critical<br>
                    <strong>2. P-value:</strong> Compare p-value to Œ±<br>
                    <strong>3. Interpretation:</strong> Economic meaning of independence/dependence
                </div>
                
                <div class="input-row">
                    <label for="chiCritical">œá¬≤-Critical Value:</label>
                    <input type="number" id="chiCritical" step="0.001" placeholder="From œá¬≤-table">
                    <button class="small-button check-btn" onclick="checkChiCritical()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('chiCritical')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('chi-critical')">Steps</button>
                </div>
                
                <div class="answer-display" id="chiCritical-answer"></div>
                <div class="tutorial-box" id="chi-critical-tutorial"></div>
                
                <div class="input-row">
                    <label for="pValue">P-value (approximate):</label>
                    <input type="number" id="pValue" step="0.001" placeholder="Probability">
                    <button class="small-button check-btn" onclick="checkPValue()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('pValue')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('p-value')">Steps</button>
                </div>
                
                <div class="answer-display" id="pValue-answer"></div>
                <div class="tutorial-box" id="p-value-tutorial"></div>
                
                <div class="input-row">
                    <label>Statistical Decision:</label>
                    <select id="decision">
                        <option value="">Choose...</option>
                        <option value="reject">Reject H‚ÇÄ (Variables are dependent)</option>
                        <option value="fail">Fail to Reject H‚ÇÄ (Variables are independent)</option>
                    </select>
                    <button class="small-button check-btn" onclick="checkDecision()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('decision')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('final-decision')">Steps</button>
                </div>
                
                <div class="answer-display" id="decision-answer"></div>
                <div class="tutorial-box" id="final-decision-tutorial"></div>
                
                <div class="input-row">
                    <label>Economic Interpretation:</label>
                    <select id="interpretation">
                        <option value="">Choose...</option>
                        <option value="relationship">Significant relationship exists</option>
                        <option value="no-relationship">No significant relationship</option>
                    </select>
                    <button class="small-button check-btn" onclick="checkInterpretation()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('interpretation')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('economic-interpretation')">Steps</button>
                </div>
                
                <div class="answer-display" id="interpretation-answer"></div>
                <div class="tutorial-box" id="economic-interpretation-tutorial"></div>
            </div>
            
            <button class="button" onclick="generateNewProblem()">üé≤ Generate New Problem</button>
            <button class="button" onclick="checkAllAnswers()">‚úÖ Check All Calculations</button>
            <button class="button" onclick="showCompleteAnalysis()">üìñ Complete Analysis</button>
        </div>
    </div>

    <script>
        let currentScenario = '';
        let testData = {};
        let correctAnswers = {};

        const scenarios = {
            'employment-province': {
                name: 'Employment Status vs Province Analysis',
                description: 'Statistics Canada examining whether employment status varies significantly across Canadian provinces.',
                testType: 'Test of Independence',
                explanation: 'Testing whether employment status (employed/unemployed) is independent of province of residence.',
                variables: {
                    row: { name: 'Employment Status', categories: ['Employed', 'Unemployed'] },
                    col: { name: 'Province', categories: ['Ontario', 'Quebec', 'BC', 'Alberta'] }
                },
                h0: 'Employment status is independent of province (no regional employment differences)',
                h1: 'Employment status depends on province (regional employment differences exist)',
                context: 'labor market policy',
                meaning: {
                    reject: 'Employment rates vary significantly by province - targeted regional policies needed',
                    fail: 'Employment rates are consistent across provinces - uniform policies appropriate'
                }
            },
            'industry-size': {
                name: 'Industry Type vs Company Size Analysis',
                description: 'Innovation Canada analyzing the relationship between industry sectors and company size distribution.',
                testType: 'Test of Independence',
                explanation: 'Testing whether industry type is independent of company size category.',
                variables: {
                    row: { name: 'Industry Type', categories: ['Manufacturing', 'Services', 'Technology'] },
                    col: { name: 'Company Size', categories: ['Small', 'Medium', 'Large'] }
                },
                h0: 'Industry type is independent of company size (no sector-size patterns)',
                h1: 'Industry type depends on company size (sector-size patterns exist)',
                context: 'business development policy',
                meaning: {
                    reject: 'Different industries have distinct size patterns - sector-specific support needed',
                    fail: 'Size distribution is similar across industries - uniform business policies work'
                }
            },
            'investment-age': {
                name: 'Investment Preference vs Age Group Analysis',
                description: 'Bank of Canada studying whether investment preferences vary systematically across age demographics.',
                testType: 'Test of Independence',
                explanation: 'Testing whether investment type preference is independent of age group.',
                variables: {
                    row: { name: 'Investment Type', categories: ['Conservative', 'Moderate', 'Aggressive'] },
                    col: { name: 'Age Group', categories: ['18-35', '36-55', '56+'] }
                },
                h0: 'Investment preference is independent of age (no age-based investment patterns)',
                h1: 'Investment preference depends on age (age-based investment patterns exist)',
                context: 'financial services regulation',
                meaning: {
                    reject: 'Age significantly influences investment choices - age-targeted financial products needed',
                    fail: 'Investment preferences are consistent across ages - uniform financial services work'
                }
            },
            'spending-income': {
                name: 'Spending Category vs Income Level Analysis',
                description: 'Statistics Canada examining whether consumer spending patterns vary by income levels.',
                testType: 'Test of Independence',
                explanation: 'Testing whether primary spending category is independent of household income level.',
                variables: {
                    row: { name: 'Primary Spending', categories: ['Essentials', 'Discretionary', 'Savings'] },
                    col: { name: 'Income Level', categories: ['Low', 'Middle', 'High'] }
                },
                h0: 'Spending patterns are independent of income level (no income-based spending differences)',
                h1: 'Spending patterns depend on income level (income-based spending patterns exist)',
                context: 'fiscal and tax policy',
                meaning: {
                    reject: 'Income significantly affects spending patterns - income-targeted policies needed',
                    fail: 'Spending patterns are similar across income levels - broad-based policies work'
                }
            }
        };

        function chooseScenario(scenario) {
            currentScenario = scenario;
            
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            generateTestData(scenario);
            document.getElementById('problemArea').style.display = 'block';
            clearAllInputs();
        }

        function generateTestData(scenario) {
            const scenarioData = scenarios[scenario];
            
            // Generate realistic contingency table data
            const rowCategories = scenarioData.variables.row.categories;
            const colCategories = scenarioData.variables.col.categories;
            const rows = rowCategories.length;
            const cols = colCategories.length;
            
            // Generate observed frequencies with some pattern to make realistic
            let observedFreq = [];
            let totalSample = 800 + Math.floor(Math.random() * 400); // 800-1200 sample
            
            // Create base distribution
            for (let i = 0; i < rows; i++) {
                observedFreq[i] = [];
                for (let j = 0; j < cols; j++) {
                    // Add some realistic variation
                    let baseFreq = totalSample / (rows * cols);
                    let variation = (Math.random() - 0.5) * baseFreq * 0.6;
                    observedFreq[i][j] = Math.max(5, Math.round(baseFreq + variation));
                }
            }
            
            // Adjust to match target sample size
            let currentTotal = observedFreq.flat().reduce((a, b) => a + b, 0);
            let adjustment = totalSample / currentTotal;
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    observedFreq[i][j] = Math.max(5, Math.round(observedFreq[i][j] * adjustment));
                }
            }
            
            // Recalculate actual total
            totalSample = observedFreq.flat().reduce((a, b) => a + b, 0);
            
            testData = {
                scenario: scenarioData.name,
                description: scenarioData.description,
                testType: scenarioData.testType,
                explanation: scenarioData.explanation,
                h0: scenarioData.h0,
                h1: scenarioData.h1,
                context: scenarioData.context,
                meaning: scenarioData.meaning,
                variables: scenarioData.variables,
                observedFreq: observedFreq,
                rows: rows,
                cols: cols,
                totalSample: totalSample,
                alpha: 0.05
            };
            
            calculateCorrectAnswers();
            updateDisplay();
        }

        function calculateCorrectAnswers() {
            const { observedFreq, rows, cols, totalSample } = testData;
            
            // Calculate row and column totals
            let rowTotals = [];
            let colTotals = [];
            
            for (let i = 0; i < rows; i++) {
                rowTotals[i] = observedFreq[i].reduce((a, b) => a + b, 0);
            }
            
            for (let j = 0; j < cols; j++) {
                colTotals[j] = 0;
                for (let i = 0; i < rows; i++) {
                    colTotals[j] += observedFreq[i][j];
                }
            }
            
            // Calculate expected frequencies
            let expectedFreq = [];
            for (let i = 0; i < rows; i++) {
                expectedFreq[i] = [];
                for (let j = 0; j < cols; j++) {
                    expectedFreq[i][j] = (rowTotals[i] * colTotals[j]) / totalSample;
                }
            }
            
            // Calculate chi-square statistic
            let chiSquare = 0;
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    let o = observedFreq[i][j];
                    let e = expectedFreq[i][j];
                    chiSquare += Math.pow(o - e, 2) / e;
                }
            }
            
            // Degrees of freedom
            const df = (rows - 1) * (cols - 1);
            
            // Chi-square critical value (approximate for Œ± = 0.05)
            let chiCritical;
            if (df === 1) chiCritical = 3.841;
            else if (df === 2) chiCritical = 5.991;
            else if (df === 3) chiCritical = 7.815;
            else if (df === 4) chiCritical = 9.488;
            else if (df === 5) chiCritical = 11.071;
            else if (df === 6) chiCritical = 12.592;
            else chiCritical = 3.841 + df * 2; // Rough approximation for larger df
            
            // P-value approximation
            let pValue;
            if (chiSquare > chiCritical * 2) pValue = 0.001;
            else if (chiSquare > chiCritical * 1.5) pValue = 0.01;
            else if (chiSquare > chiCritical) pValue = 0.05;
            else if (chiSquare > chiCritical * 0.7) pValue = 0.10;
            else pValue = 0.20;
            
            // Decision
            const decision = chiSquare > chiCritical ? 'reject' : 'fail';
            const interpretation = decision === 'reject' ? 'relationship' : 'no-relationship';
            
            correctAnswers = {
                observedFreq: observedFreq,
                expectedFreq: expectedFreq,
                rowTotals: rowTotals,
                colTotals: colTotals,
                chiSquare: chiSquare,
                degreesOfFreedom: df,
                chiCritical: chiCritical,
                pValue: pValue,
                decision: decision,
                interpretation: interpretation
            };
        }

        function updateDisplay() {
            document.getElementById('scenarioDescription').innerHTML = 
                `<strong>${testData.scenario}</strong><br>${testData.description}`;
            
            document.getElementById('testTypeDisplay').textContent = testData.testType;
            document.getElementById('testExplanation').textContent = testData.explanation;
            document.getElementById('h0Display').innerHTML = `<strong>H‚ÇÄ:</strong> ${testData.h0}`;
            document.getElementById('h1Display').innerHTML = `<strong>H‚ÇÅ:</strong> ${testData.h1}`;
            document.getElementById('degreesOfFreedom').textContent = `df = (${testData.rows}-1) √ó (${testData.cols}-1) = ${correctAnswers.degreesOfFreedom}`;
            document.getElementById('totalSample').textContent = testData.totalSample;
            
            updateObservedTable();
            updateExpectedCalculations();
            updateExpectedTable();
        }

        function updateObservedTable() {
            const container = document.getElementById('observedTable');
            const { variables, observedFreq, rows, cols } = testData;
            const { rowTotals, colTotals } = correctAnswers;
            
            let tableHTML = `
                <table class="chi-table">
                    <thead>
                        <tr>
                            <th>${variables.row.name} \\ ${variables.col.name}</th>
            `;
            
            for (let j = 0; j < cols; j++) {
                tableHTML += `<th>${variables.col.categories[j]}</th>`;
            }
            tableHTML += `<th>Row Total</th></tr></thead><tbody>`;
            
            for (let i = 0; i < rows; i++) {
                tableHTML += `<tr><th>${variables.row.categories[i]}</th>`;
                for (let j = 0; j < cols; j++) {
                    tableHTML += `<td class="observed-cell">${observedFreq[i][j]}</td>`;
                }
                tableHTML += `<td><strong>${rowTotals[i]}</strong></td></tr>`;
            }
            
            tableHTML += `<tr><th>Col Total</th>`;
            for (let j = 0; j < cols; j++) {
                tableHTML += `<td><strong>${colTotals[j]}</strong></td>`;
            }
            tableHTML += `<td><strong>${testData.totalSample}</strong></td></tr></tbody></table>`;
            
            container.innerHTML = tableHTML;
        }

        function updateExpectedCalculations() {
            const container = document.getElementById('expectedCalculations');
            const { variables, rows, cols } = testData;
            const { expectedFreq, rowTotals, colTotals } = correctAnswers;
            
            let calcHTML = `<div class="expected-calc-grid">`;
            
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    calcHTML += `
                        <div class="expected-cell-calc">
                            <strong>${variables.row.categories[i]} √ó ${variables.col.categories[j]}:</strong><br>
                            E = (${rowTotals[i]} √ó ${colTotals[j]}) / ${testData.totalSample}<br>
                            E = ${expectedFreq[i][j].toFixed(1)}
                        </div>
                    `;
                }
            }
            
            calcHTML += `</div>`;
            container.innerHTML = calcHTML;
        }

        function updateExpectedTable() {
            const container = document.getElementById('expectedTable');
            const { variables, rows, cols } = testData;
            const { expectedFreq, rowTotals, colTotals } = correctAnswers;
            
            let tableHTML = `
                <table class="chi-table">
                    <thead>
                        <tr>
                            <th>Expected Frequencies</th>
            `;
            
            for (let j = 0; j < cols; j++) {
                tableHTML += `<th>${variables.col.categories[j]}</th>`;
            }
            tableHTML += `<th>Row Total</th></tr></thead><tbody>`;
            
            for (let i = 0; i < rows; i++) {
                tableHTML += `<tr><th>${variables.row.categories[i]}</th>`;
                for (let j = 0; j < cols; j++) {
                    tableHTML += `<td class="expected-cell">${expectedFreq[i][j].toFixed(1)}</td>`;
                }
                tableHTML += `<td><strong>${rowTotals[i]}</strong></td></tr>`;
            }
            
            tableHTML += `<tr><th>Col Total</th>`;
            for (let j = 0; j < cols; j++) {
                tableHTML += `<td><strong>${colTotals[j]}</strong></td>`;
            }
            tableHTML += `<td><strong>${testData.totalSample}</strong></td></tr></tbody></table>`;
            
            container.innerHTML = tableHTML;
        }

        function checkAnswer(inputId, correctValue, tolerance = 0.1) {
            const input = document.getElementById(inputId);
            const userAnswer = parseFloat(input.value);
            
            if (isNaN(userAnswer)) {
                input.className = '';
                return false;
            }
            
            const isCorrect = Math.abs(userAnswer - correctValue) <= tolerance;
            input.className = isCorrect ? 'correct' : 'incorrect';
            return isCorrect;
        }

        function checkChiSquare() {
            return checkAnswer('chiSquareCalc', correctAnswers.chiSquare, 0.5);
        }

        function checkDegreesOfFreedom() {
            return checkAnswer('degreesOfFreedomCalc', correctAnswers.degreesOfFreedom, 0);
        }

        function checkChiCritical() {
            return checkAnswer('chiCritical', correctAnswers.chiCritical, 0.1);
        }

        function checkPValue() {
            return checkAnswer('pValue', correctAnswers.pValue, 0.02);
        }

        function checkDecision() {
            const select = document.getElementById('decision');
            const userAnswer = select.value;
            const isCorrect = userAnswer === correctAnswers.decision;
            select.style.backgroundColor = isCorrect ? '#d4edda' : '#f8d7da';
            select.style.borderColor = isCorrect ? '#c3e6cb' : '#f5c6cb';
            return isCorrect;
        }

        function checkInterpretation() {
            const select = document.getElementById('interpretation');
            const userAnswer = select.value;
            const isCorrect = userAnswer === correctAnswers.interpretation;
            select.style.backgroundColor = isCorrect ? '#d4edda' : '#f8d7da';
            select.style.borderColor = isCorrect ? '#c3e6cb' : '#f5c6cb';
            return isCorrect;
        }

        function showAnswer(inputId) {
            const answerDiv = document.getElementById(inputId + '-answer');
            
            switch(inputId) {
                case 'chiSquareCalc':
                    answerDiv.innerHTML = `‚úÖ œá¬≤ = ${correctAnswers.chiSquare.toFixed(3)}`;
                    break;
                case 'degreesOfFreedomCalc':
                    answerDiv.innerHTML = `‚úÖ df = ${correctAnswers.degreesOfFreedom}`;
                    break;
                case 'chiCritical':
                    answerDiv.innerHTML = `‚úÖ œá¬≤-critical = ${correctAnswers.chiCritical.toFixed(3)}`;
                    break;
                case 'pValue':
                    answerDiv.innerHTML = `‚úÖ P-value ‚âà ${correctAnswers.pValue.toFixed(3)}`;
                    break;
                case 'decision':
                    const decisionText = correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ (Variables are dependent)' : 'Fail to Reject H‚ÇÄ (Variables are independent)';
                    answerDiv.innerHTML = `‚úÖ ${decisionText}`;
                    break;
                case 'interpretation':
                    const interpText = correctAnswers.interpretation === 'relationship' ? 'Significant relationship exists' : 'No significant relationship';
                    answerDiv.innerHTML = `‚úÖ ${interpText}`;
                    break;
            }
            
            answerDiv.style.display = 'block';
        }

        function showSteps(stepType) {
            const tutorialDiv = document.getElementById(stepType + '-tutorial');
            
            if (stepType === 'chi-square-calc') {
                let calcSteps = '';
                for (let i = 0; i < testData.rows; i++) {
                    for (let j = 0; j < testData.cols; j++) {
                        const o = testData.observedFreq[i][j];
                        const e = correctAnswers.expectedFreq[i][j];
                        const contrib = Math.pow(o - e, 2) / e;
                        calcSteps += `${testData.variables.row.categories[i]}-${testData.variables.col.categories[j]}: (${o}-${e.toFixed(1)})¬≤/${e.toFixed(1)} = ${contrib.toFixed(3)}<br>`;
                    }
                }
                
                tutorialDiv.innerHTML = `
                    <h4>üìö How to Calculate Chi-Square Test Statistic:</h4>
                    <div class="tutorial-step">
                        <strong>Formula:</strong> œá¬≤ = Œ£[(O-E)¬≤/E]<br><br>
                        <strong>Calculate for each cell:</strong><br>
                        ${calcSteps}<br>
                        <strong>Sum all contributions:</strong><br>
                        œá¬≤ = ${correctAnswers.chiSquare.toFixed(3)}<br><br>
                        <strong>This measures:</strong> How much the observed frequencies deviate from what we'd expect if the variables were independent.
                    </div>
                `;
            } else if (stepType === 'degrees-freedom') {
                tutorialDiv.innerHTML = `
                    <h4>üìö How to Calculate Degrees of Freedom:</h4>
                    <div class="tutorial-step">
                        <strong>Formula:</strong> df = (rows - 1) √ó (columns - 1)<br><br>
                        <strong>Our Data:</strong><br>
                        Rows (${testData.variables.row.name}): ${testData.rows} categories<br>
                        Columns (${testData.variables.col.name}): ${testData.cols} categories<br><br>
                        <strong>Calculation:</strong><br>
                        df = (${testData.rows} - 1) √ó (${testData.cols} - 1)<br>
                        df = ${testData.rows - 1} √ó ${testData.cols - 1}<br>
                        df = ${correctAnswers.degreesOfFreedom}<br><br>
                        <strong>Meaning:</strong> Number of independent pieces of information after fixing marginal totals.
                    </div>
                `;
            } else if (stepType === 'chi-critical') {
                tutorialDiv.innerHTML = `
                    <h4>üìö How to Find Chi-Square Critical Value:</h4>
                    <div class="tutorial-step">
                        <strong>Parameters:</strong><br>
                        Œ± = ${testData.alpha}<br>
                        df = ${correctAnswers.degreesOfFreedom}<br><br>
                        <strong>From œá¬≤-table:</strong><br>
                        œá¬≤‚ÇÄ.‚ÇÄ‚ÇÖ(${correctAnswers.degreesOfFreedom}) = ${correctAnswers.chiCritical.toFixed(3)}<br><br>
                        <strong>Decision Rule:</strong><br>
                        If œá¬≤ > ${correctAnswers.chiCritical.toFixed(3)} ‚Üí Reject H‚ÇÄ<br>
                        If œá¬≤ ‚â§ ${correctAnswers.chiCritical.toFixed(3)} ‚Üí Fail to reject H‚ÇÄ<br><br>
                        <strong>Note:</strong> Chi-square tests are always right-tailed.
                    </div>
                `;
            } else if (stepType === 'final-decision') {
                tutorialDiv.innerHTML = `
                    <h4>üìö Final Decision - Statistical Methods:</h4>
                    <div class="tutorial-step">
                        <strong>Method 1 (Critical Value):</strong><br>
                        œá¬≤ = ${correctAnswers.chiSquare.toFixed(3)} ${correctAnswers.chiSquare > correctAnswers.chiCritical ? '>' : '‚â§'} œá¬≤-critical = ${correctAnswers.chiCritical.toFixed(3)}<br>
                        Decision: ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}<br><br>
                        <strong>Method 2 (P-value):</strong><br>
                        p = ${correctAnswers.pValue.toFixed(3)} ${correctAnswers.pValue <= testData.alpha ? '‚â§' : '>'} Œ± = ${testData.alpha}<br>
                        Decision: ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}<br><br>
                        <strong>Both methods agree!</strong><br><br>
                        <strong>Conclusion:</strong> ${correctAnswers.decision === 'reject' ? 
                          `The variables ${testData.variables.row.name} and ${testData.variables.col.name} are NOT independent - there is a significant relationship.` :
                          `The variables ${testData.variables.row.name} and ${testData.variables.col.name} are independent - no significant relationship detected.`}
                    </div>
                `;
            } else if (stepType === 'economic-interpretation') {
                const meaning = correctAnswers.decision === 'reject' ? testData.meaning.reject : testData.meaning.fail;
                tutorialDiv.innerHTML = `
                    <h4>üìö Economic Interpretation:</h4>
                    <div class="tutorial-step">
                        <strong>Statistical Result:</strong><br>
                        ${correctAnswers.decision === 'reject' ? 
                          'Variables are significantly dependent (related)' : 
                          'Variables are independent (not related)'}<br><br>
                        <strong>Economic Meaning:</strong><br>
                        ${meaning}<br><br>
                        <strong>Policy Implications for ${testData.context}:</strong><br>
                        ${correctAnswers.decision === 'reject' ? 
                          'Differentiated approaches may be needed across categories.' : 
                          'Uniform policies are likely appropriate across categories.'}<br><br>
                        <strong>Strength of Evidence:</strong><br>
                        œá¬≤ = ${correctAnswers.chiSquare.toFixed(3)}, p ‚âà ${correctAnswers.pValue.toFixed(3)}
                    </div>
                `;
            }
            
            tutorialDiv.style.display = tutorialDiv.style.display === 'none' ? 'block' : 'none';
        }

        function checkAllAnswers() {
            const results = [
                checkChiSquare(),
                checkDegreesOfFreedom(),
                checkChiCritical(),
                checkPValue(),
                checkDecision(),
                checkInterpretation()
            ];
            
            const correct = results.filter(r => r).length;
            const total = results.length;
            
            alert(`You got ${correct}/${total} calculations correct!\n\n${correct === total ? 'Perfect chi-square analysis! üéâ' : 'Review the incorrect calculations using the Steps buttons.'}`);
        }

        function generateNewProblem() {
            if (currentScenario) {
                generateTestData(currentScenario);
                clearAllInputs();
            } else {
                alert('Please select a scenario first.');
            }
        }

        function clearAllInputs() {
            const inputs = ['chiSquareCalc', 'degreesOfFreedomCalc', 'chiCritical', 'pValue'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = '';
                    input.className = '';
                }
                
                const answerDiv = document.getElementById(id + '-answer');
                if (answerDiv) answerDiv.style.display = 'none';
            });
            
            const selects = ['decision', 'interpretation'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.value = '';
                    select.style.backgroundColor = '';
                    select.style.borderColor = '';
                }
            });
        }

        function showCompleteAnalysis() {
            if (!currentScenario) {
                alert('Please select a scenario first.');
                return;
            }
            
            const meaning = correctAnswers.decision === 'reject' ? testData.meaning.reject : testData.meaning.fail;
            
            alert(`Complete Chi-Square Analysis:\n\nScenario: ${testData.scenario}\n\nHypotheses:\nH‚ÇÄ: ${testData.h0}\nH‚ÇÅ: ${testData.h1}\n\nTest Statistics:\n‚Ä¢ œá¬≤ = ${correctAnswers.chiSquare.toFixed(3)}\n‚Ä¢ df = ${correctAnswers.degreesOfFreedom}\n‚Ä¢ œá¬≤-critical = ${correctAnswers.chiCritical.toFixed(3)}\n‚Ä¢ p-value ‚âà ${correctAnswers.pValue.toFixed(3)}\n\nDecision: ${correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}\n\nEconomic Interpretation:\n${meaning}\n\nPolicy Context: ${testData.context}`);
        }
    </script>
</body>
</html>
