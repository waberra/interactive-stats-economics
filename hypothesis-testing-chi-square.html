<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi-Square Testing: Independence & Goodness of Fit - Canadian Economics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.2em;
        }
        
        .canada-header {
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .test-type-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
            text-align: center;
        }
        
        .test-type-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .test-type-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }
        
        .test-type-btn.active {
            background-color: #007bff;
        }
        
        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .scenario-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 6px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .scenario-btn.active {
            background-color: #dc3545;
        }
        
        .hypothesis-section {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }
        
        .hypothesis-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #4caf50;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .data-section {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table th {
            background-color: #f8f9fa;
            color: #495057;
        }
        
        .calculation-section {
            background: linear-gradient(135deg, #fff3e0, #ffcc80);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ff9800;
        }
        
        .calculation-step {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #ff9800;
        }
        
        .answer-section {
            background: linear-gradient(135deg, #f3e5f5, #ce93d8);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #9c27b0;
        }
        
        .control-panel {
            background: #343a40;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .control-btn {
            background-color: #6f42c1;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 8px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background-color: #5a32a3;
            transform: translateY(-2px);
        }
        
        .hidden { display: none; }
        
        .economic-context {
            background: linear-gradient(135deg, #fff8e1, #ffcc02);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #ff6f00;
            font-style: italic;
        }
        
        .tutorial-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4169e1;
        }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            h1 { font-size: 1.8em; }
            .data-table { font-size: 0.9em; }
            .scenario-btn, .control-btn { padding: 10px 15px; font-size: 0.9em; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üá®üá¶ Chi-Square Testing: Independence & Goodness of Fit</h1>
    <div class="canada-header">
        <h2>üçÅ Canadian Economic Data Analysis üçÅ</h2>
        <p><strong>Master both types of chi-square testing with real Canadian economic scenarios!</strong></p>
    </div>

    <!-- Test Type Selection -->
    <div class="test-type-selector">
        <h3>üéØ Select Chi-Square Test Type:</h3>
        <button class="test-type-btn active" onclick="selectTestType('independence', this)">
            üìä Test of Independence<br><small>(Two Variables)</small>
        </button>
        <button class="test-type-btn" onclick="selectTestType('goodness', this)">
            üìà Goodness of Fit<br><small>(One Variable vs Expected)</small>
        </button>
    </div>

    <!-- Independence Test Scenarios -->
    <div id="independence-scenarios" class="scenario-selector">
        <h3>üîó Test of Independence Scenarios (Two Categorical Variables):</h3>
        <button class="scenario-btn" onclick="generateScenario('employment-province', this)">üíº Employment vs Province</button>
        <button class="scenario-btn" onclick="generateScenario('industry-size', this)">üè≠ Industry vs Company Size</button>
        <button class="scenario-btn" onclick="generateScenario('investment-age', this)">üí∞ Investment vs Age Group</button>
        <button class="scenario-btn" onclick="generateScenario('spending-income', this)">üõí Spending vs Income Level</button>
    </div>

    <!-- Goodness of Fit Test Scenarios -->
    <div id="goodness-scenarios" class="scenario-selector hidden">
        <h3>üìà Goodness of Fit Scenarios (One Variable vs Expected Distribution):</h3>
        <button class="scenario-btn" onclick="generateScenario('gdp-distribution', this)">üìä Provincial GDP Distribution</button>
        <button class="scenario-btn" onclick="generateScenario('employment-education', this)">üéì Employment by Education</button>
        <button class="scenario-btn" onclick="generateScenario('housing-market', this)">üè† Housing Market Distribution</button>
        <button class="scenario-btn" onclick="generateScenario('retail-sales', this)">üõí Retail Sales Categories</button>
        <button class="scenario-btn" onclick="generateScenario('tax-revenue', this)">üí∞ Tax Revenue Sources</button>
        <button class="scenario-btn" onclick="generateScenario('banking-assets', this)">üè¶ Banking Sector Assets</button>
    </div>

    <!-- Economic Context -->
    <div id="economic-context" class="economic-context hidden">
        <!-- Will be populated by JavaScript -->
    </div>

    <!-- Hypothesis Section -->
    <div id="hypothesis-section" class="hypothesis-section hidden">
        <h3>üìù Step 1: Hypothesis Formulation</h3>
        <div id="hypothesis-display" class="hypothesis-display">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Data Section -->
    <div id="data-section" class="data-section hidden">
        <h3>üìä Step 2: Data Analysis</h3>
        <div id="data-display">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Calculation Section -->
    <div id="calculation-section" class="calculation-section hidden">
        <h3>üßÆ Step 3: Chi-Square Calculations</h3>
        <div id="calculation-display">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Answer Section -->
    <div id="answer-section" class="answer-section hidden">
        <h3>üéØ Step 4: Statistical Decision & Economic Interpretation</h3>
        <div id="answer-display">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Tutorial Section -->
    <div id="tutorial-section" class="tutorial-section hidden">
        <h3>üìö Understanding Chi-Square Testing</h3>
        <div id="tutorial-content">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <button class="control-btn" onclick="showTutorial()">üìö Tutorial</button>
        <button class="control-btn" onclick="showCalculations()">üßÆ Show Calculations</button>
        <button class="control-btn" onclick="showAnswer()">üéØ Show Answer</button>
        <button class="control-btn" onclick="generateNewScenario()">üîÑ New Scenario</button>
    </div>
</div>

<script>
let currentTestType = 'independence';
let currentScenario = '';
let testData = {};
let correctAnswers = {};

// Test scenarios data
const independenceScenarios = {
    'employment-province': {
        title: 'üíº Employment Status vs Province',
        context: 'Testing if employment status is independent of province in Canada.',
        description: 'Statistics Canada wants to determine if employment status varies significantly across Canadian provinces.',
        variables: ['Employment Status', 'Province'],
        categories: {
            rows: ['Employed', 'Unemployed', 'Not in Labor Force'],
            cols: ['Ontario', 'Quebec', 'BC', 'Alberta']
        }
    },
    'industry-size': {
        title: 'üè≠ Industry Type vs Company Size',
        context: 'Testing if industry type is independent of company size in Canadian businesses.',
        description: 'Innovation, Science and Economic Development Canada investigates whether certain industries favor specific company sizes.',
        variables: ['Industry Type', 'Company Size'],
        categories: {
            rows: ['Technology', 'Manufacturing', 'Services'],
            cols: ['Small (1-99)', 'Medium (100-499)', 'Large (500+)']
        }
    },
    'investment-age': {
        title: 'üí∞ Investment Type vs Age Group',
        context: 'Testing if investment preferences are independent of age groups among Canadians.',
        description: 'The Canada Pension Plan Investment Board studies whether investment choices vary by age demographics.',
        variables: ['Investment Type', 'Age Group'],
        categories: {
            rows: ['Stocks', 'Bonds', 'Real Estate', 'GICs'],
            cols: ['18-35', '36-50', '51-65']
        }
    },
    'spending-income': {
        title: 'üõí Spending Category vs Income Level',
        context: 'Testing if spending patterns are independent of income levels in Canadian households.',
        description: 'Statistics Canada examines whether consumption patterns differ significantly across income brackets.',
        variables: ['Spending Category', 'Income Level'],
        categories: {
            rows: ['Housing', 'Food', 'Transportation', 'Recreation'],
            cols: ['Low Income', 'Middle Income', 'High Income']
        }
    }
};

const goodnessScenarios = {
    'gdp-distribution': {
        title: 'üìä Provincial GDP Distribution',
        context: 'Testing if actual provincial GDP distribution matches expected federal transfer formula.',
        description: 'Finance Canada tests whether provincial economic output aligns with federal equalization assumptions.',
        variable: 'Provincial GDP Share',
        categories: ['Ontario', 'Quebec', 'BC', 'Alberta', 'Other Provinces']
    },
    'employment-education': {
        title: 'üéì Employment by Education Level',
        context: 'Testing if employment distribution matches workforce development projections.',
        description: 'Employment and Social Development Canada evaluates if actual employment patterns match education policy goals.',
        variable: 'Education Level',
        categories: ['High School', 'College/Trade', 'University', 'Graduate']
    },
    'housing-market': {
        title: 'üè† Housing Market Price Distribution',
        context: 'Testing if housing prices match expected affordability framework.',
        description: 'Canada Mortgage and Housing Corporation examines if regional housing markets align with affordability targets.',
        variable: 'Housing Price Category',
        categories: ['Under $300K', '$300K-$500K', '$500K-$750K', 'Over $750K']
    },
    'retail-sales': {
        title: 'üõí Retail Sales by Category',
        context: 'Testing if consumer spending matches economic forecasting models.',
        description: 'Statistics Canada evaluates whether retail patterns align with consumer expenditure projections.',
        variable: 'Retail Category',
        categories: ['Food & Beverage', 'Clothing', 'Electronics', 'Home & Garden', 'Other']
    },
    'tax-revenue': {
        title: 'üí∞ Government Tax Revenue Sources',
        context: 'Testing if tax revenue composition matches budget projections.',
        description: 'Finance Canada analyzes whether actual revenue sources align with fiscal planning assumptions.',
        variable: 'Tax Revenue Source',
        categories: ['Income Tax', 'Corporate Tax', 'GST/HST', 'Other Taxes']
    },
    'banking-assets': {
        title: 'üè¶ Banking Sector Asset Distribution',
        context: 'Testing if bank portfolio composition matches regulatory guidelines.',
        description: 'Office of the Superintendent of Financial Institutions examines if bank asset allocation meets regulatory expectations.',
        variable: 'Asset Category',
        categories: ['Residential Mortgages', 'Commercial Loans', 'Government Securities', 'Other Assets']
    }
};

function selectTestType(type, clickedButton) {
    currentTestType = type;
    
    // Update button states
    document.querySelectorAll('.test-type-btn').forEach(btn => btn.classList.remove('active'));
    clickedButton.classList.add('active');
    
    // Show/hide scenario selectors
    if (type === 'independence') {
        document.getElementById('independence-scenarios').classList.remove('hidden');
        document.getElementById('goodness-scenarios').classList.add('hidden');
    } else {
        document.getElementById('independence-scenarios').classList.add('hidden');
        document.getElementById('goodness-scenarios').classList.remove('hidden');
    }
    
    // Hide other sections
    hideAllSections();
}

function generateScenario(scenario, clickedButton) {
    currentScenario = scenario;
    
    // Update button states
    document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
    clickedButton.classList.add('active');
    
    if (currentTestType === 'independence') {
        generateIndependenceData(scenario);
    } else {
        generateGoodnessData(scenario);
    }
    
    updateDisplay();
    hideCalculationsAndAnswers();
}

function generateIndependenceData(scenario) {
    const scenarioData = independenceScenarios[scenario];
    const rows = scenarioData.categories.rows.length;
    const cols = scenarioData.categories.cols.length;
    
    // Generate random observed frequencies
    let observedFreq = [];
    for (let i = 0; i < rows; i++) {
        observedFreq[i] = [];
        for (let j = 0; j < cols; j++) {
            observedFreq[i][j] = Math.floor(Math.random() * 50) + 20; // 20-69
        }
    }
    
    // Calculate totals
    let rowTotals = [];
    let colTotals = [];
    let totalSample = 0;
    
    for (let i = 0; i < rows; i++) {
        rowTotals[i] = observedFreq[i].reduce((a, b) => a + b, 0);
        totalSample += rowTotals[i];
    }
    
    for (let j = 0; j < cols; j++) {
        colTotals[j] = 0;
        for (let i = 0; i < rows; i++) {
            colTotals[j] += observedFreq[i][j];
        }
    }
    
    // Calculate expected frequencies
    let expectedFreq = [];
    for (let i = 0; i < rows; i++) {
        expectedFreq[i] = [];
        for (let j = 0; j < cols; j++) {
            expectedFreq[i][j] = (rowTotals[i] * colTotals[j]) / totalSample;
        }
    }
    
    testData = {
        type: 'independence',
        scenario: scenarioData,
        observedFreq: observedFreq,
        expectedFreq: expectedFreq,
        rowTotals: rowTotals,
        colTotals: colTotals,
        totalSample: totalSample,
        rows: rows,
        cols: cols
    };
    
    calculateIndependenceAnswers();
}

function generateGoodnessData(scenario) {
    const scenarioData = goodnessScenarios[scenario];
    const numCategories = scenarioData.categories.length;
    
    // Generate expected frequencies (theoretical distribution)
    let expectedFreq = [];
    const totalSample = Math.floor(Math.random() * 400) + 600; // 600-999
    
    // Generate expected proportions that sum to 1
    let expectedProps = [];
    let sum = 0;
    for (let i = 0; i < numCategories; i++) {
        expectedProps[i] = Math.random() * 0.3 + 0.1; // 0.1 to 0.4
        sum += expectedProps[i];
    }
    // Normalize to sum to 1
    for (let i = 0; i < numCategories; i++) {
        expectedProps[i] = expectedProps[i] / sum;
        expectedFreq[i] = Math.round(expectedProps[i] * totalSample);
    }
    
    // Generate observed frequencies (add some deviation)
    let observedFreq = [];
    for (let i = 0; i < numCategories; i++) {
        let deviation = (Math.random() - 0.5) * 0.3; // -15% to +15% deviation
        observedFreq[i] = Math.max(5, Math.round(expectedFreq[i] * (1 + deviation)));
    }
    
    testData = {
        type: 'goodness',
        scenario: scenarioData,
        observedFreq: observedFreq,
        expectedFreq: expectedFreq,
        numCategories: numCategories,
        totalSample: observedFreq.reduce((a, b) => a + b, 0)
    };
    
    calculateGoodnessAnswers();
}

function calculateIndependenceAnswers() {
    const { observedFreq, expectedFreq, rows, cols } = testData;
    
    // Calculate chi-square statistic
    let chiSquare = 0;
    for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
            let o = observedFreq[i][j];
            let e = expectedFreq[i][j];
            chiSquare += Math.pow(o - e, 2) / e;
        }
    }
    
    // Degrees of freedom
    const df = (rows - 1) * (cols - 1);
    
    const { chiCritical, pValue, decision, interpretation } = calculateCommonAnswers(chiSquare, df);
    
    correctAnswers = {
        observedFreq: observedFreq,
        expectedFreq: expectedFreq,
        chiSquare: chiSquare,
        degreesOfFreedom: df,
        chiCritical: chiCritical,
        pValue: pValue,
        decision: decision,
        interpretation: interpretation
    };
}

function calculateGoodnessAnswers() {
    const { observedFreq, expectedFreq, numCategories } = testData;
    
    // Calculate chi-square statistic
    let chiSquare = 0;
    for (let i = 0; i < numCategories; i++) {
        let o = observedFreq[i];
        let e = expectedFreq[i];
        chiSquare += Math.pow(o - e, 2) / e;
    }
    
    // Degrees of freedom for goodness of fit
    const df = numCategories - 1;
    
    const { chiCritical, pValue, decision, interpretation } = calculateCommonAnswers(chiSquare, df);
    
    correctAnswers = {
        observedFreq: observedFreq,
        expectedFreq: expectedFreq,
        chiSquare: chiSquare,
        degreesOfFreedom: df,
        chiCritical: chiCritical,
        pValue: pValue,
        decision: decision,
        interpretation: interpretation
    };
}

function calculateCommonAnswers(chiSquare, df) {
    // Chi-square critical value (approximate for Œ± = 0.05)
    let chiCritical;
    if (df === 1) chiCritical = 3.841;
    else if (df === 2) chiCritical = 5.991;
    else if (df === 3) chiCritical = 7.815;
    else if (df === 4) chiCritical = 9.488;
    else if (df === 5) chiCritical = 11.071;
    else if (df === 6) chiCritical = 12.592;
    else chiCritical = 3.841 + df * 2; // Rough approximation for larger df
    
    // P-value approximation
    let pValue;
    if (chiSquare > chiCritical * 2) pValue = 0.001;
    else if (chiSquare > chiCritical * 1.5) pValue = 0.01;
    else if (chiSquare > chiCritical) pValue = 0.05;
    else if (chiSquare > chiCritical * 0.7) pValue = 0.10;
    else pValue = 0.20;
    
    // Decision
    const decision = chiSquare > chiCritical ? 'reject' : 'fail';
    const interpretation = decision === 'reject' ? 
        'There is sufficient evidence of a significant relationship' : 
        'There is insufficient evidence of a significant relationship';
    
    return { chiCritical, pValue, decision, interpretation };
}

function updateDisplay() {
    updateEconomicContext();
    updateHypothesisDisplay();
    updateDataDisplay();
    
    // Show relevant sections
    document.getElementById('economic-context').classList.remove('hidden');
    document.getElementById('hypothesis-section').classList.remove('hidden');
    document.getElementById('data-section').classList.remove('hidden');
}

function updateEconomicContext() {
    const scenario = testData.scenario;
    let contextHTML = `
        <h4>üá®üá¶ ${scenario.title}</h4>
        <p><strong>Context:</strong> ${scenario.context}</p>
        <p><strong>Research Question:</strong> ${scenario.description}</p>
    `;
    
    if (testData.type === 'independence') {
        contextHTML += `<p><strong>Variables:</strong> ${scenario.variables[0]} and ${scenario.variables[1]}</p>`;
    } else {
        contextHTML += `<p><strong>Variable:</strong> ${scenario.variable}</p>`;
    }
    
    document.getElementById('economic-context').innerHTML = contextHTML;
}

function updateHypothesisDisplay() {
    const scenario = testData.scenario;
    let hypothesisHTML;
    
    if (testData.type === 'independence') {
        hypothesisHTML = `
            <h4>üîó Test of Independence Hypotheses</h4>
            <p><strong>H‚ÇÄ (Null Hypothesis):</strong> ${scenario.variables[0]} and ${scenario.variables[1]} are independent</p>
            <p><strong>H‚ÇÅ (Alternative Hypothesis):</strong> ${scenario.variables[0]} and ${scenario.variables[1]} are not independent (dependent)</p>
            <p><strong>Test Type:</strong> Two-way chi-square test of independence</p>
            <p><strong>Significance Level:</strong> Œ± = 0.05</p>
        `;
    } else {
        hypothesisHTML = `
            <h4>üìà Goodness of Fit Test Hypotheses</h4>
            <p><strong>H‚ÇÄ (Null Hypothesis):</strong> The observed ${scenario.variable} distribution matches the expected distribution</p>
            <p><strong>H‚ÇÅ (Alternative Hypothesis):</strong> The observed ${scenario.variable} distribution does not match the expected distribution</p>
            <p><strong>Test Type:</strong> One-way chi-square goodness of fit test</p>
            <p><strong>Significance Level:</strong> Œ± = 0.05</p>
        `;
    }
    
    document.getElementById('hypothesis-display').innerHTML = hypothesisHTML;
}

function updateDataDisplay() {
    let dataHTML;
    
    if (testData.type === 'independence') {
        dataHTML = createIndependenceTable();
    } else {
        dataHTML = createGoodnessTable();
    }
    
    document.getElementById('data-display').innerHTML = dataHTML;
}

function createIndependenceTable() {
    const { observedFreq, rowTotals, colTotals, totalSample, scenario } = testData;
    const rows = scenario.categories.rows;
    const cols = scenario.categories.cols;
    
    let tableHTML = `
        <h4>üìä Contingency Table (Observed Frequencies)</h4>
        <table class="data-table">
            <tr>
                <th>${scenario.variables[0]} \\ ${scenario.variables[1]}</th>
    `;
    
    // Column headers
    cols.forEach(col => {
        tableHTML += `<th>${col}</th>`;
    });
    tableHTML += '<th>Row Total</th></tr>';
    
    // Data rows
    for (let i = 0; i < rows.length; i++) {
        tableHTML += `<tr><th>${rows[i]}</th>`;
        for (let j = 0; j < cols.length; j++) {
            tableHTML += `<td>${observedFreq[i][j]}</td>`;
        }
        tableHTML += `<td><strong>${rowTotals[i]}</strong></td></tr>`;
    }
    
    // Column totals
    tableHTML += '<tr><th>Column Total</th>';
    colTotals.forEach(total => {
        tableHTML += `<td><strong>${total}</strong></td>`;
    });
    tableHTML += `<td><strong>${totalSample}</strong></td></tr></table>`;
    
    return tableHTML;
}

function createGoodnessTable() {
    const { observedFreq, expectedFreq, scenario } = testData;
    
    let tableHTML = `
        <h4>üìä Observed vs Expected Frequencies</h4>
        <table class="data-table">
            <tr>
                <th>${scenario.variable}</th>
                <th>Observed</th>
                <th>Expected</th>
                <th>Difference</th>
            </tr>
    `;
    
    for (let i = 0; i < scenario.categories.length; i++) {
        const diff = observedFreq[i] - expectedFreq[i];
        tableHTML += `
            <tr>
                <th>${scenario.categories[i]}</th>
                <td>${observedFreq[i]}</td>
                <td>${expectedFreq[i].toFixed(1)}</td>
                <td>${diff > 0 ? '+' : ''}${diff.toFixed(1)}</td>
            </tr>
        `;
    }
    
    const totalObs = observedFreq.reduce((a, b) => a + b, 0);
    const totalExp = expectedFreq.reduce((a, b) => a + b, 0);
    
    tableHTML += `
        <tr style="border-top: 3px solid #333;">
            <th>Total</th>
            <td><strong>${totalObs}</strong></td>
            <td><strong>${totalExp.toFixed(1)}</strong></td>
            <td><strong>${(totalObs - totalExp).toFixed(1)}</strong></td>
        </tr>
        </table>
    `;
    
    return tableHTML;
}

function showCalculations() {
    let calculationHTML;
    
    if (testData.type === 'independence') {
        calculationHTML = createIndependenceCalculations();
    } else {
        calculationHTML = createGoodnessCalculations();
    }
    
    document.getElementById('calculation-display').innerHTML = calculationHTML;
    document.getElementById('calculation-section').classList.remove('hidden');
}

function createIndependenceCalculations() {
    const { observedFreq, expectedFreq, rowTotals, colTotals, totalSample, scenario } = testData;
    const { chiSquare, degreesOfFreedom } = correctAnswers;
    
    let calcHTML = `
        <div class="calculation-step">
            <h4>üßÆ Step 1: Expected Frequencies</h4>
            <p><strong>Formula:</strong> E<sub>ij</sub> = (Row<sub>i</sub> Total √ó Column<sub>j</sub> Total) √∑ Grand Total</p>
            <table class="data-table">
                <tr><th>Cell</th><th>Calculation</th><th>Expected</th></tr>
    `;
    
    const rows = scenario.categories.rows;
    const cols = scenario.categories.cols;
    
    for (let i = 0; i < rows.length; i++) {
        for (let j = 0; j < cols.length; j++) {
            calcHTML += `
                <tr>
                    <td>${rows[i]} √ó ${cols[j]}</td>
                    <td>(${rowTotals[i]} √ó ${colTotals[j]}) √∑ ${totalSample}</td>
                    <td>${expectedFreq[i][j].toFixed(2)}</td>
                </tr>
            `;
        }
    }
    
    calcHTML += `</table></div>
        <div class="calculation-step">
            <h4>üìä Step 2: Chi-Square Test Statistic</h4>
            <p><strong>Formula:</strong> œá¬≤ = Œ£[(O<sub>ij</sub> - E<sub>ij</sub>)¬≤ √∑ E<sub>ij</sub>]</p>
            <table class="data-table">
                <tr><th>Cell</th><th>O</th><th>E</th><th>O-E</th><th>(O-E)¬≤</th><th>(O-E)¬≤/E</th></tr>
    `;
    
    let totalChi = 0;
    for (let i = 0; i < rows.length; i++) {
        for (let j = 0; j < cols.length; j++) {
            const o = observedFreq[i][j];
            const e = expectedFreq[i][j];
            const diff = o - e;
            const diffSq = diff * diff;
            const component = diffSq / e;
            totalChi += component;
            
            calcHTML += `
                <tr>
                    <td>${rows[i]} √ó ${cols[j]}</td>
                    <td>${o}</td>
                    <td>${e.toFixed(2)}</td>
                    <td>${diff.toFixed(2)}</td>
                    <td>${diffSq.toFixed(2)}</td>
                    <td>${component.toFixed(3)}</td>
                </tr>
            `;
        }
    }
    
    calcHTML += `
                <tr style="border-top: 3px solid #333;">
                    <td colspan="5"><strong>œá¬≤ = </strong></td>
                    <td><strong>${chiSquare.toFixed(3)}</strong></td>
                </tr>
            </table>
        </div>
        
        <div class="calculation-step">
            <h4>üéØ Step 3: Degrees of Freedom</h4>
            <p><strong>Formula:</strong> df = (rows - 1) √ó (columns - 1)</p>
            <p>df = (${rows.length} - 1) √ó (${cols.length} - 1) = ${degreesOfFreedom}</p>
        </div>
    `;
    
    return calcHTML;
}

function createGoodnessCalculations() {
    const { observedFreq, expectedFreq, scenario } = testData;
    const { chiSquare, degreesOfFreedom } = correctAnswers;
    
    let calcHTML = `
        <div class="calculation-step">
            <h4>üìä Step 1: Chi-Square Components</h4>
            <p><strong>Formula:</strong> œá¬≤ = Œ£[(O<sub>i</sub> - E<sub>i</sub>)¬≤ √∑ E<sub>i</sub>]</p>
            <table class="data-table">
                <tr><th>Category</th><th>O</th><th>E</th><th>O-E</th><th>(O-E)¬≤</th><th>(O-E)¬≤/E</th></tr>
    `;
    
    let totalChi = 0;
    for (let i = 0; i < scenario.categories.length; i++) {
        const o = observedFreq[i];
        const e = expectedFreq[i];
        const diff = o - e;
        const diffSq = diff * diff;
        const component = diffSq / e;
        totalChi += component;
        
        calcHTML += `
            <tr>
                <td>${scenario.categories[i]}</td>
                <td>${o}</td>
                <td>${e.toFixed(2)}</td>
                <td>${diff.toFixed(2)}</td>
                <td>${diffSq.toFixed(2)}</td>
                <td>${component.toFixed(3)}</td>
            </tr>
        `;
    }
    
    calcHTML += `
            <tr style="border-top: 3px solid #333;">
                <td><strong>œá¬≤ = </strong></td>
                <td colspan="4"></td>
                <td><strong>${chiSquare.toFixed(3)}</strong></td>
            </tr>
        </table>
        </div>
        
        <div class="calculation-step">
            <h4>üéØ Step 2: Degrees of Freedom</h4>
            <p><strong>Formula:</strong> df = categories - 1</p>
            <p>df = ${scenario.categories.length} - 1 = ${degreesOfFreedom}</p>
        </div>
    `;
    
    return calcHTML;
}

function showAnswer() {
    const { chiSquare, degreesOfFreedom, chiCritical, pValue, decision, interpretation } = correctAnswers;
    const scenario = testData.scenario;
    
    let answerHTML = `
        <div class="calculation-step">
            <h4>üìä Test Statistics Summary</h4>
            <p><strong>Calculated œá¬≤:</strong> ${chiSquare.toFixed(3)}</p>
            <p><strong>Degrees of Freedom:</strong> ${degreesOfFreedom}</p>
            <p><strong>Critical Value (Œ± = 0.05):</strong> ${chiCritical.toFixed(3)}</p>
            <p><strong>Estimated P-value:</strong> ${pValue.toFixed(3)}</p>
        </div>
        
        <div class="calculation-step">
            <h4>üéØ Statistical Decision</h4>
            <p><strong>Decision Rule:</strong> If œá¬≤ > œá¬≤<sub>critical</sub>, reject H‚ÇÄ</p>
            <p><strong>Comparison:</strong> ${chiSquare.toFixed(3)} ${chiSquare > chiCritical ? '>' : '‚â§'} ${chiCritical.toFixed(3)}</p>
            <p><strong>Decision:</strong> <span style="color: ${decision === 'reject' ? '#dc3545' : '#28a745'}; font-weight: bold;">
                ${decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}</span></p>
        </div>
        
        <div class="calculation-step">
            <h4>üá®üá¶ Economic Interpretation</h4>
            <p><strong>Statistical Result:</strong> ${interpretation}</p>
    `;
    
    if (testData.type === 'independence') {
        if (decision === 'reject') {
            answerHTML += `<p><strong>Economic Meaning:</strong> ${scenario.variables[0]} and ${scenario.variables[1]} are significantly related. Policy makers should consider these dependencies in economic planning.</p>`;
            answerHTML += `<p><strong>Policy Implication:</strong> Targeted interventions may be needed as patterns vary significantly across categories.</p>`;
        } else {
            answerHTML += `<p><strong>Economic Meaning:</strong> ${scenario.variables[0]} and ${scenario.variables[1]} appear to be independent. Uniform policies may be appropriate.</p>`;
            answerHTML += `<p><strong>Policy Implication:</strong> No evidence of systematic differences; general policies should be equally effective across categories.</p>`;
        }
    } else {
        if (decision === 'reject') {
            answerHTML += `<p><strong>Economic Meaning:</strong> The observed ${scenario.variable} distribution significantly differs from the expected model. Current forecasting assumptions may need revision.</p>`;
            answerHTML += `<p><strong>Policy Implication:</strong> Economic models and targets should be reassessed based on actual observed patterns.</p>`;
        } else {
            answerHTML += `<p><strong>Economic Meaning:</strong> The observed ${scenario.variable} distribution is consistent with expected patterns. Current models appear valid.</p>`;
            answerHTML += `<p><strong>Policy Implication:</strong> Continue with current economic assumptions and policy frameworks.</p>`;
        }
    }
    
    answerHTML += '</div>';
    
    document.getElementById('answer-display').innerHTML = answerHTML;
    document.getElementById('answer-section').classList.remove('hidden');
}

function showTutorial() {
    let tutorialHTML = `
        <h4>üìö Understanding Chi-Square Testing</h4>
        
        <div class="calculation-step">
            <h4>üîó Test of Independence</h4>
            <p><strong>Purpose:</strong> Determines if two categorical variables are independent or related.</p>
            <p><strong>Example:</strong> Is employment status related to province?</p>
            <p><strong>Data Structure:</strong> Contingency table (rows √ó columns)</p>
            <p><strong>Degrees of Freedom:</strong> df = (rows - 1) √ó (columns - 1)</p>
            <p><strong>Interpretation:</strong> If variables are independent, knowing one doesn't help predict the other.</p>
        </div>
        
        <div class="calculation-step">
            <h4>üìà Goodness of Fit Test</h4>
            <p><strong>Purpose:</strong> Determines if observed distribution matches an expected theoretical distribution.</p>
            <p><strong>Example:</strong> Does actual provincial GDP match expected federal transfer formula?</p>
            <p><strong>Data Structure:</strong> One variable with multiple categories</p>
            <p><strong>Degrees of Freedom:</strong> df = categories - 1</p>
            <p><strong>Interpretation:</strong> Tests if reality matches our theoretical expectations or models.</p>
        </div>
        
        <div class="calculation-step">
            <h4>üßÆ Chi-Square Formula</h4>
            <p><strong>œá¬≤ = Œ£[(Observed - Expected)¬≤ √∑ Expected]</strong></p>
            <p>‚Ä¢ Larger differences between observed and expected lead to larger œá¬≤ values</p>
            <p>‚Ä¢ Larger œá¬≤ values provide stronger evidence against the null hypothesis</p>
            <p>‚Ä¢ Compare calculated œá¬≤ to critical value to make decision</p>
        </div>
        
        <div class="calculation-step">
            <h4>üéØ Decision Making</h4>
            <p><strong>If œá¬≤ > Critical Value:</strong> Reject H‚ÇÄ (significant relationship/difference)</p>
            <p><strong>If œá¬≤ ‚â§ Critical Value:</strong> Fail to reject H‚ÇÄ (no significant relationship/difference)</p>
            <p><strong>P-value approach:</strong> If p < 0.05, reject H‚ÇÄ</p>
        </div>
    `;
    
    document.getElementById('tutorial-content').innerHTML = tutorialHTML;
    document.getElementById('tutorial-section').classList.remove('hidden');
}

function generateNewScenario() {
    if (currentScenario) {
        generateScenario(currentScenario);
    }
}

function hideAllSections() {
    document.getElementById('economic-context').classList.add('hidden');
    document.getElementById('hypothesis-section').classList.add('hidden');
    document.getElementById('data-section').classList.add('hidden');
    document.getElementById('calculation-section').classList.add('hidden');
    document.getElementById('answer-section').classList.add('hidden');
    document.getElementById('tutorial-section').classList.add('hidden');
}

function hideCalculationsAndAnswers() {
    document.getElementById('calculation-section').classList.add('hidden');
    document.getElementById('answer-section').classList.add('hidden');
    document.getElementById('tutorial-section').classList.add('hidden');
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    const firstButton = document.querySelector('.test-type-btn');
    selectTestType('independence', firstButton);
});

</script>

</body>
</html>
