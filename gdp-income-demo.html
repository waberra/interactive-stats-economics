<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDP Income Approach Calculator - Canadian Method</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .canadian-flag {
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
        }
        
        .formula-box {
            background: linear-gradient(135deg, #e8f4f8, #d6eaf8);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #1e3c72;
            text-align: center;
        }
        
        .formula {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }
        
        .formula-explanation {
            margin-top: 15px;
            font-size: 0.9em;
            color: #555;
        }
        
        .type-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .type-calculation {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }
        
        .type-analysis {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .type-comprehensive {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
        }
        
        .economic-context {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .context-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .economic-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .data-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .data-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .data-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .question-text {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            padding: 25px;
            border-left: 5px solid #1e3c72;
            margin-bottom: 25px;
            line-height: 1.6;
            border-radius: 0 10px 10px 0;
        }
        
        .question-text h3 {
            margin-top: 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .income-components {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #f39c12;
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .component-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 2px solid #f39c12;
        }
        
        .component-label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        .component-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #e67e22;
            margin-top: 5px;
        }
        
        .answer-section {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .input-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .input-group label {
            display: inline-block;
            min-width: 200px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 150px;
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #1e3c72;
            box-shadow: 0 0 0 3px rgba(30, 60, 114, 0.1);
            transform: translateY(-1px);
        }
        
        .input-correct {
            border-color: #27ae60 !important;
            background-color: #d4edda !important;
        }
        
        .input-incorrect {
            border-color: #e74c3c !important;
            background-color: #f8d7da !important;
        }
        
        .btn {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2a5298, #3498db);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        
        .btn-generate:hover {
            background: linear-gradient(135deg, #2ecc71, #58d68d);
        }
        
        .feedback {
            padding: 18px;
            margin: 20px 0;
            border-radius: 10px;
            font-weight: bold;
            border-left: 5px solid;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left-color: #27ae60;
        }
        
        .feedback.partial {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left-color: #f39c12;
        }
        
        .feedback.incorrect {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-left-color: #e74c3c;
        }
        
        .solution {
            background: linear-gradient(135deg, #eaf2f8, #d6eaf8);
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border-left: 5px solid #1e3c72;
        }
        
        .solution h4 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .solution-step {
            background-color: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #d6eaf8;
        }
        
        .solution-step h5 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .calculation {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            display: block;
            margin: 5px 0;
            border: 1px solid #dee2e6;
            font-size: 1.1em;
        }
        
        .result {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            background: linear-gradient(135deg, #d6eaf8, #aed6f1);
            padding: 10px 15px;
            border-radius: 5px;
            display: inline-block;
            margin: 8px 0;
        }
        
        .interpretation-box {
            background: linear-gradient(135deg, #e8f5e8, #d4f1d4);
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #155724;
        }
        
        .hidden {
            display: none;
        }
        
        .navigation {
            text-align: center;
            margin: 30px 0;
        }
        
        .question-counter {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 10px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .question-types {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .type-selector {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            border: 2px solid #95a5a6;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .type-selector.active {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border-color: #2a5298;
        }
        
        .type-selector:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .comprehensive-answers {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .analysis-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #1e3c72;
        }

        .analysis-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .percentage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .percentage-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 2px solid #1e3c72;
        }
    </style>
</head>
<body>
    <div class="canadian-flag">üá®üá¶</div>
    <h1>üí∞ GDP Income Approach Calculator</h1>
    <h2 style="text-align: center; color: #2c3e50; margin-top: -20px;">Canadian Method</h2>
    
    <div class="container">
        <div class="formula-box">
            <div class="formula">GDP = CE + GOS + GMI + (T - S)</div>
            <div class="formula-explanation">
                <strong>CE:</strong> Compensation of Employees &nbsp;|&nbsp;
                <strong>GOS:</strong> Gross Operating Surplus &nbsp;|&nbsp;
                <strong>GMI:</strong> Gross Mixed Income &nbsp;|&nbsp;
                <strong>(T - S):</strong> Net Taxes on Production
            </div>
        </div>
        
        <div class="navigation">
            <div class="question-counter" id="question-counter">Question 1 of ‚àû</div>
            
            <div class="question-types">
                <div class="type-selector active" id="calculation-selector" onclick="selectQuestionType('calculation')">
                    üßÆ GDP Calculations
                </div>
                <div class="type-selector" id="analysis-selector" onclick="selectQuestionType('analysis')">
                    üìä Income Analysis
                </div>
                <div class="type-selector" id="comprehensive-selector" onclick="selectQuestionType('comprehensive')">
                    üéØ Comprehensive Study
                </div>
                <div class="type-selector" id="random-selector" onclick="selectQuestionType('random')">
                    üé≤ Random Mix
                </div>
            </div>
            
            <button class="btn btn-generate" onclick="generateNewQuestion()">Generate New Problem</button>
        </div>
        
        <div id="question-container"></div>
        
        <div class="answer-section">
            <div id="answer-inputs"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="checkAnswers()">‚úì Check Answer</button>
                <button class="btn btn-secondary" onclick="showSolution()">üí° Show Solution</button>
                <button class="btn btn-secondary" onclick="clearAnswers()">üóëÔ∏è Clear</button>
            </div>
        </div>

        <div id="feedback" class="feedback hidden"></div>
        
        <div id="solution" class="solution hidden"></div>
    </div>

    <script>
        // Include the GDPIncomeSimulator class from the previous file
        class GDPIncomeSimulator {
            constructor() {
                // Economic scenarios with realistic Canadian data ranges
                this.scenarios = {
                    economic_expansion: {
                        context: 'strong economic expansion',
                        description: 'robust growth with high employment and business investment',
                        gdpRange: [2200, 2800], // CAD billions
                        ceGDPRatio: [0.50, 0.56], // Compensation of employees
                        gosGDPRatio: [0.22, 0.28], // Gross operating surplus
                        gmiGDPRatio: [0.06, 0.10], // Gross mixed income
                        taxGDPRatio: [0.12, 0.16], // Taxes on production and imports
                        subsidyGDPRatio: [0.02, 0.04] // Subsidies (subtracted)
                    },
                    moderate_growth: {
                        context: 'moderate economic growth',
                        description: 'steady expansion with balanced income distribution',
                        gdpRange: [2000, 2400],
                        ceGDPRatio: [0.52, 0.58],
                        gosGDPRatio: [0.20, 0.26],
                        gmiGDPRatio: [0.07, 0.11],
                        taxGDPRatio: [0.13, 0.17],
                        subsidyGDPRatio: [0.02, 0.05]
                    },
                    economic_slowdown: {
                        context: 'economic slowdown',
                        description: 'reduced business profits with stable employment',
                        gdpRange: [1800, 2200],
                        ceGDPRatio: [0.54, 0.60],
                        gosGDPRatio: [0.18, 0.24],
                        gmiGDPRatio: [0.06, 0.09],
                        taxGDPRatio: [0.11, 0.15],
                        subsidyGDPRatio: [0.03, 0.06]
                    },
                    resource_boom: {
                        context: 'natural resource boom',
                        description: 'high commodity prices driving corporate profits',
                        gdpRange: [2300, 2900],
                        ceGDPRatio: [0.48, 0.54],
                        gosGDPRatio: [0.25, 0.32],
                        gmiGDPRatio: [0.05, 0.09],
                        taxGDPRatio: [0.13, 0.18],
                        subsidyGDPRatio: [0.01, 0.03]
                    },
                    service_economy: {
                        context: 'service-oriented economy',
                        description: 'high employment in services with moderate business profits',
                        gdpRange: [2100, 2600],
                        ceGDPRatio: [0.55, 0.62],
                        gosGDPRatio: [0.19, 0.25],
                        gmiGDPRatio: [0.08, 0.12],
                        taxGDPRatio: [0.12, 0.16],
                        subsidyGDPRatio: [0.02, 0.04]
                    }
                };

                // Canadian provinces and territories
                this.provinces = [
                    'Ontario', 'Quebec', 'British Columbia', 'Alberta', 'Manitoba', 
                    'Saskatchewan', 'Nova Scotia', 'New Brunswick', 'Newfoundland and Labrador',
                    'Prince Edward Island', 'Northwest Territories', 'Yukon', 'Nunavut'
                ];

                // Time periods
                this.years = ['2019', '2020', '2021', '2022', '2023', '2024'];
                this.quarters = ['Q1', 'Q2', 'Q3', 'Q4'];

                this.currentQuestion = null;
                this.currentSolution = null;
                this.questionCount = 1;
                this.questionType = 'calculation';
            }

            randomBetween(min, max, decimals = 1) {
                const factor = Math.pow(10, decimals);
                return Math.round((Math.random() * (max - min) + min) * factor) / factor;
            }

            generateGDPIncomeData(scenario = 'moderate_growth') {
                const scenarioData = this.scenarios[scenario];
                
                // Select random province and time period
                const province = this.provinces[Math.floor(Math.random() * this.provinces.length)];
                const year = this.years[Math.floor(Math.random() * this.years.length)];
                const quarter = this.quarters[Math.floor(Math.random() * this.quarters.length)];
                
                // Generate GDP first, then calculate components
                const gdp = this.randomBetween(scenarioData.gdpRange[0], scenarioData.gdpRange[1]);
                
                // Generate ratios for each component
                const ceRatio = this.randomBetween(scenarioData.ceGDPRatio[0], scenarioData.ceGDPRatio[1], 3);
                const gosRatio = this.randomBetween(scenarioData.gosGDPRatio[0], scenarioData.gosGDPRatio[1], 3);
                const gmiRatio = this.randomBetween(scenarioData.gmiGDPRatio[0], scenarioData.gmiGDPRatio[1], 3);
                const taxRatio = this.randomBetween(scenarioData.taxGDPRatio[0], scenarioData.taxGDPRatio[1], 3);
                const subsidyRatio = this.randomBetween(scenarioData.subsidyGDPRatio[0], scenarioData.subsidyGDPRatio[1], 3);
                
                // Calculate components
                const compensationEmployees = Math.round(gdp * ceRatio * 10) / 10;
                const grossOperatingSurplus = Math.round(gdp * gosRatio * 10) / 10;
                const grossMixedIncome = Math.round(gdp * gmiRatio * 10) / 10;
                const taxes = Math.round(gdp * taxRatio * 10) / 10;
                const subsidies = Math.round(gdp * subsidyRatio * 10) / 10;
                
                // Calculate net taxes (T - S)
                const netTaxes = Math.round((taxes - subsidies) * 10) / 10;
                
                // Calculate GDP to verify (should match original GDP)
                const calculatedGDP = Math.round((compensationEmployees + grossOperatingSurplus + grossMixedIncome + netTaxes) * 10) / 10;
                
                // Generate deflator and real GDP for additional calculations
                const gdpDeflator = this.randomBetween(98, 103, 1);
                const realGDP = Math.round((calculatedGDP / (gdpDeflator / 100)) * 10) / 10;
                
                // Generate population for per capita calculations
                const population = this.randomBetween(30, 45, 1); // millions
                const gdpPerCapita = Math.round((calculatedGDP * 1000) / population);
                
                return {
                    scenario: scenario,
                    context: scenarioData.context,
                    description: scenarioData.description,
                    province: province,
                    year: year,
                    quarter: quarter,
                    timePeriod: `${quarter} ${year}`,
                    
                    // Income approach components
                    gdp: calculatedGDP,
                    compensationEmployees: compensationEmployees,
                    grossOperatingSurplus: grossOperatingSurplus,
                    grossMixedIncome: grossMixedIncome,
                    taxes: taxes,
                    subsidies: subsidies,
                    netTaxes: netTaxes,
                    
                    // Ratios as percentages
                    ceRatio: Math.round(ceRatio * 1000) / 10,
                    gosRatio: Math.round(gosRatio * 1000) / 10,
                    gmiRatio: Math.round(gmiRatio * 1000) / 10,
                    taxRatio: Math.round(taxRatio * 1000) / 10,
                    subsidyRatio: Math.round(subsidyRatio * 1000) / 10,
                    
                    // Additional economic indicators
                    gdpDeflator: gdpDeflator,
                    realGDP: realGDP,
                    population: population,
                    gdpPerCapita: gdpPerCapita
                };
            }

            generateQuestion(type = 'random') {
                const scenarios = Object.keys(this.scenarios);
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                const data = this.generateGDPIncomeData(scenario);
                
                if (type === 'calculation') {
                    const calcTypes = ['total_gdp', 'missing_component', 'net_taxes'];
                    const selectedType = calcTypes[Math.floor(Math.random() * calcTypes.length)];
                    return this.generateQuestionByType(selectedType, data);
                } else if (type === 'analysis') {
                    const analysisTypes = ['compensation_employees', 'operating_surplus', 'mixed_income'];
                    const selectedType = analysisTypes[Math.floor(Math.random() * analysisTypes.length)];
                    return this.generateQuestionByType(selectedType, data);
                } else if (type === 'comprehensive') {
                    return this.generateComprehensiveQuestion(data);
                } else {
                    // Random question type
                    const types = ['total_gdp', 'missing_component', 'compensation_employees', 'operating_surplus', 'mixed_income', 'net_taxes'];
                    const randomType = types[Math.floor(Math.random() * types.length)];
                    return this.generateQuestionByType(randomType, data);
                }
            }

            generateQuestionByType(type, data) {
                switch (type) {
                    case 'total_gdp':
                        return {
                            type: 'total_gdp',
                            data: data,
                            questionText: `Calculate the total GDP using the income approach for ${data.province} in ${data.timePeriod} during a period of ${data.context}.`,
                            givenComponents: ['compensationEmployees', 'grossOperatingSurplus', 'grossMixedIncome', 'taxes', 'subsidies'],
                            correctAnswer: data.gdp,
                            answerUnit: 'CAD billion'
                        };
                    case 'missing_component':
                        const components = ['compensationEmployees', 'grossOperatingSurplus', 'grossMixedIncome', 'netTaxes'];
                        const missingComponent = components[Math.floor(Math.random() * components.length)];
                        
                        const componentNames = {
                            compensationEmployees: 'Compensation of Employees (CE)',
                            grossOperatingSurplus: 'Gross Operating Surplus (GOS)',
                            grossMixedIncome: 'Gross Mixed Income (GMI)',
                            netTaxes: 'Net Taxes (T - S)'
                        };
                        
                        const givenComponents = ['gdp'];
                        components.forEach(comp => {
                            if (comp !== missingComponent) {
                                if (comp === 'netTaxes') {
                                    givenComponents.push('taxes', 'subsidies');
                                } else {
                                    givenComponents.push(comp);
                                }
                            }
                        });
                        
                        return {
                            type: 'missing_component',
                            data: data,
                            missingComponent: missingComponent,
                            questionText: `Given the total GDP and other income components for ${data.province} in ${data.timePeriod}, calculate the missing component: ${componentNames[missingComponent]}.`,
                            givenComponents: givenComponents,
                            correctAnswer: data[missingComponent],
                            answerUnit: 'CAD billion'
                        };
                    case 'compensation_employees':
                        return {
                            type: 'compensation_employees',
                            data: data,
                            questionText: `Calculate what percentage of GDP is represented by Compensation of Employees in ${data.province} during ${data.timePeriod}.`,
                            givenComponents: ['gdp', 'compensationEmployees'],
                            correctAnswer: data.ceRatio,
                            answerUnit: '%'
                        };
                    case 'operating_surplus':
                        return {
                            type: 'operating_surplus',
                            data: data,
                            questionText: `During the ${data.context} in ${data.province}, calculate the Gross Operating Surplus as a percentage of GDP.`,
                            givenComponents: ['gdp', 'grossOperatingSurplus'],
                            correctAnswer: data.gosRatio,
                            answerUnit: '%'
                        };
                    case 'mixed_income':
                        return {
                            type: 'mixed_income',
                            data: data,
                            questionText: `Calculate the Gross Mixed Income (self-employment and unincorporated business income) as a percentage of GDP for ${data.province} in ${data.timePeriod}.`,
                            givenComponents: ['gdp', 'grossMixedIncome'],
                            correctAnswer: data.gmiRatio,
                            answerUnit: '%'
                        };
                    case 'net_taxes':
                        return {
                            type: 'net_taxes',
                            data: data,
                            questionText: `Calculate the net taxes (taxes on production and imports minus subsidies) for ${data.province} in ${data.timePeriod}.`,
                            givenComponents: ['taxes', 'subsidies'],
                            correctAnswer: data.netTaxes,
                            answerUnit: 'CAD billion'
                        };
                }
            }

            generateComprehensiveQuestion(data) {
                return {
                    type: 'comprehensive',
                    data: data,
                    questionText: `Complete GDP income approach analysis for ${data.province} during the ${data.context} in ${data.timePeriod}.`,
                    givenComponents: ['compensationEmployees', 'grossOperatingSurplus', 'grossMixedIncome', 'taxes', 'subsidies', 'gdpDeflator', 'population'],
                    answers: {
                        totalGDP: data.gdp,
                        netTaxes: data.netTaxes,
                        realGDP: data.realGDP,
                        gdpPerCapita: data.gdpPerCapita,
                        ceShare: data.ceRatio,
                        gosShare: data.gosRatio
                    }
                };
            }

            displayQuestion(questionData) {
                const data = questionData.data;
                let typeClass, typeText, questionHTML;

                // Determine question type styling
                if (questionData.type === 'comprehensive') {
                    typeClass = 'type-comprehensive';
                    typeText = 'üéØ Comprehensive GDP Income Analysis';
                } else if (['compensation_employees', 'operating_surplus', 'mixed_income'].includes(questionData.type)) {
                    typeClass = 'type-analysis';
                    typeText = 'üìä Income Component Analysis';
                } else {
                    typeClass = 'type-calculation';
                    typeText = 'üßÆ GDP Income Calculation';
                }

                // Build question display
                questionHTML = `
                    <div class="type-indicator ${typeClass}">${typeText}</div>
                    
                    <div class="economic-context">
                        <div class="context-header">
                            üá®üá¶ Economic Context
                        </div>
                        <div class="economic-data">
                            <div class="data-item">
                                <span class="data-label">Province/Territory:</span>
                                <span class="data-value">${data.province}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Time Period:</span>
                                <span class="data-value">${data.timePeriod}</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Economic Condition:</span>
                                <span class="data-value">${data.context}</span>
                            </div>
                        </div>
                        <p style="font-style: italic; color: #555; margin-top: 15px;">
                            ${data.description}
                        </p>
                    </div>
                    
                    <div class="question-text">
                        <h3>${questionData.questionText}</h3>
                    </div>
                `;

                // Add given data section
                questionHTML += `<div class="income-components">
                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 15px; font-size: 1.1em;">
                        üí∞ Given Income Data
                    </div>
                    <div class="component-grid">`;

                questionData.givenComponents.forEach(component => {
                    let label, value, unit;
                    switch (component) {
                        case 'gdp':
                            label = 'Total GDP';
                            value = data.gdp;
                            unit = 'CAD billion';
                            break;
                        case 'compensationEmployees':
                            label = 'Compensation of Employees (CE)';
                            value = data.compensationEmployees;
                            unit = 'CAD billion';
                            break;
                        case 'grossOperatingSurplus':
                            label = 'Gross Operating Surplus (GOS)';
                            value = data.grossOperatingSurplus;
                            unit = 'CAD billion';
                            break;
                        case 'grossMixedIncome':
                            label = 'Gross Mixed Income (GMI)';
                            value = data.grossMixedIncome;
                            unit = 'CAD billion';
                            break;
                        case 'taxes':
                            label = 'Taxes on Production (T)';
                            value = data.taxes;
                            unit = 'CAD billion';
                            break;
                        case 'subsidies':
                            label = 'Subsidies (S)';
                            value = data.subsidies;
                            unit = 'CAD billion';
                            break;
                        case 'gdpDeflator':
                            label = 'GDP Deflator';
                            value = data.gdpDeflator;
                            unit = '(base = 100)';
                            break;
                        case 'population':
                            label = 'Population';
                            value = data.population;
                            unit = 'million';
                            break;
                    }
                    
                    questionHTML += `
                        <div class="component-item">
                            <div class="component-label">${label}</div>
                            <div class="component-value">${value} ${unit}</div>
                        </div>
                    `;
                });

                questionHTML += `</div></div>`;

                // Set up answer inputs based on question type
                if (questionData.type === 'comprehensive') {
                    questionHTML += `
                        <div class="analysis-section">
                            <div class="analysis-title">
                                üéØ Calculate All Components
                            </div>
                            <p><strong>Part A:</strong> Total GDP using income approach</p>
                            <p><strong>Part B:</strong> Net taxes (T - S)</p>
                            <p><strong>Part C:</strong> Real GDP (adjusted for inflation)</p>
                            <p><strong>Part D:</strong> GDP per capita</p>
                            <p><strong>Part E:</strong> CE share of GDP (%)</p>
                            <p><strong>Part F:</strong> GOS share of GDP (%)</p>
                        </div>
                    `;
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="comprehensive-answers">
                            <div class="input-group">
                                <label>Part A - Total GDP:</label>
                                <input type="number" id="total-gdp-input" step="0.1" placeholder="0.0">
                                <span style="font-weight: bold;">CAD billion</span>
                            </div>
                            <div class="input-group">
                                <label>Part B - Net Taxes:</label>
                                <input type="number" id="net-taxes-input" step="0.1" placeholder="0.0">
                                <span style="font-weight: bold;">CAD billion</span>
                            </div>
                            <div class="input-group">
                                <label>Part C - Real GDP:</label>
                                <input type="number" id="real-gdp-input" step="0.1" placeholder="0.0">
                                <span style="font-weight: bold;">CAD billion</span>
                            </div>
                            <div class="input-group">
                                <label>Part D - GDP per capita:</label>
                                <input type="number" id="gdp-per-capita-input" step="1" placeholder="0">
                                <span style="font-weight: bold;">CAD</span>
                            </div>
                            <div class="input-group">
                                <label>Part E - CE Share:</label>
                                <input type="number" id="ce-share-input" step="0.1" placeholder="0.0">
                                <span style="font-weight: bold;">%</span>
                            </div>
                            <div class="input-group">
                                <label>Part F - GOS Share:</label>
                                <input type="number" id="gos-share-input" step="0.1" placeholder="0.0">
                                <span style="font-weight: bold;">%</span>
                            </div>
                        </div>
                    `;
                } else {
                    // Single answer input
                    const inputStep = questionData.answerUnit === '%' ? '0.1' : '0.1';
                    const placeholder = questionData.answerUnit === '%' ? '0.0' : '0.0';
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="input-group">
                            <label>Answer:</label>
                            <input type="number" id="answer-input" step="${inputStep}" placeholder="${placeholder}">
                            <span style="font-weight: bold;">${questionData.answerUnit}</span>
                        </div>
                    `;
                }

                document.getElementById('question-container').innerHTML = questionHTML;
            }

            checkSingleAnswer(answer, correctData) {
                const tolerance = correctData.answerUnit === '%' ? 0.1 : 0.5;
                const isCorrect = Math.abs(answer - correctData.correctAnswer) <= tolerance;
                
                return {
                    isCorrect,
                    correctAnswer: correctData.correctAnswer
                };
            }

            checkComprehensiveAnswers(answers, correctData) {
                const tolerance = {
                    gdp: 0.5,
                    netTaxes: 0.5,
                    realGDP: 0.5,
                    gdpPerCapita: 100,
                    percentage: 0.1
                };
                
                const results = {
                    totalGDP: Math.abs(answers.totalGDP - correctData.answers.totalGDP) <= tolerance.gdp,
                    netTaxes: Math.abs(answers.netTaxes - correctData.answers.netTaxes) <= tolerance.netTaxes,
                    realGDP: Math.abs(answers.realGDP - correctData.answers.realGDP) <= tolerance.realGDP,
                    gdpPerCapita: Math.abs(answers.gdpPerCapita - correctData.answers.gdpPerCapita) <= tolerance.gdpPerCapita,
                    ceShare: Math.abs(answers.ceShare - correctData.answers.ceShare) <= tolerance.percentage,
                    gosShare: Math.abs(answers.gosShare - correctData.answers.gosShare) <= tolerance.percentage
                };
                
                const correctCount = Object.values(results).filter(x => x).length;
                const allCorrect = correctCount === 6;
                
                return {
                    results,
                    correctCount,
                    allCorrect,
                    correctAnswers: correctData.answers
                };
            }

            showSolution(questionData) {
                const data = questionData.data;
                let solutionHTML = '';
                
                if (questionData.type === 'total_gdp') {
                    solutionHTML = `
                        <h4>üßÆ GDP Income Approach Calculation</h4>
                        
                        <div class="solution-step">
                            <h5>Formula: GDP = CE + GOS + GMI + (T - S)</h5>
                            <div class="calculation">Step 1: Identify all income components</div>
                            <div class="calculation">CE = ${data.compensationEmployees} billion CAD</div>
                            <div class="calculation">GOS = ${data.grossOperatingSurplus} billion CAD</div>
                            <div class="calculation">GMI = ${data.grossMixedIncome} billion CAD</div>
                            <div class="calculation">T = ${data.taxes} billion CAD</div>
                            <div class="calculation">S = ${data.subsidies} billion CAD</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Step 2: Calculate net taxes</h5>
                            <div class="calculation">(T - S) = ${data.taxes} - ${data.subsidies} = ${data.netTaxes} billion CAD</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Step 3: Sum all components</h5>
                            <div class="calculation">GDP = ${data.compensationEmployees} + ${data.grossOperatingSurplus} + ${data.grossMixedIncome} + ${data.netTaxes}</div>
                            <div class="result">GDP = ${data.gdp} billion CAD</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üí∞ Economic Analysis:</strong> This ${data.context} in ${data.province} shows a GDP composition where compensation of employees represents ${data.ceRatio}% of total economic output, indicating ${data.ceRatio > 55 ? 'strong labor income' : 'moderate employment compensation'}.
                        </div>
                    `;

                } else if (questionData.type === 'missing_component') {
                    const missing = questionData.missingComponent;
                    const componentNames = {
                        compensationEmployees: 'Compensation of Employees (CE)',
                        grossOperatingSurplus: 'Gross Operating Surplus (GOS)', 
                        grossMixedIncome: 'Gross Mixed Income (GMI)',
                        netTaxes: 'Net Taxes (T - S)'
                    };
                    
                    solutionHTML = `
                        <h4>üîç Missing Component Calculation: ${componentNames[missing]}</h4>
                        
                        <div class="solution-step">
                            <h5>Using GDP = CE + GOS + GMI + (T - S)</h5>
                            <div class="calculation">Given: GDP = ${data.gdp} billion CAD</div>
                            <div class="calculation">Rearranging to solve for ${componentNames[missing]}</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Solution</h5>
                            <div class="calculation">${componentNames[missing]} = GDP - (other components)</div>
                            <div class="calculation">${componentNames[missing]} = ${data.gdp} - ${missing === 'compensationEmployees' ? `${data.grossOperatingSurplus} - ${data.grossMixedIncome} - ${data.netTaxes}` : 
                                missing === 'grossOperatingSurplus' ? `${data.compensationEmployees} - ${data.grossMixedIncome} - ${data.netTaxes}` :
                                missing === 'grossMixedIncome' ? `${data.compensationEmployees} - ${data.grossOperatingSurplus} - ${data.netTaxes}` :
                                `${data.compensationEmployees} - ${data.grossOperatingSurplus} - ${data.grossMixedIncome}`}</div>
                            <div class="result">${componentNames[missing]} = ${data[missing]} billion CAD</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Component Analysis:</strong> The ${componentNames[missing]} represents ${Math.round((data[missing] / data.gdp) * 1000) / 10}% of total GDP in this ${data.context} scenario.
                        </div>
                    `;

                } else if (questionData.type === 'comprehensive') {
                    solutionHTML = `
                        <h4>üéØ Comprehensive GDP Income Analysis</h4>
                        
                        <div class="solution-step">
                            <h5>Part A: Total GDP Calculation</h5>
                            <div class="calculation">GDP = CE + GOS + GMI + (T - S)</div>
                            <div class="calculation">GDP = ${data.compensationEmployees} + ${data.grossOperatingSurplus} + ${data.grossMixedIncome} + (${data.taxes} - ${data.subsidies})</div>
                            <div class="result">Total GDP = ${data.gdp} billion CAD</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part B: Net Taxes</h5>
                            <div class="calculation">Net Taxes = T - S = ${data.taxes} - ${data.subsidies}</div>
                            <div class="result">Net Taxes = ${data.netTaxes} billion CAD</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part C: Real GDP</h5>
                            <div class="calculation">Real GDP = Nominal GDP √∑ (GDP Deflator √∑ 100)</div>
                            <div class="calculation">Real GDP = ${data.gdp} √∑ (${data.gdpDeflator} √∑ 100)</div>
                            <div class="result">Real GDP = ${data.realGDP} billion CAD</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part D: GDP Per Capita</h5>
                            <div class="calculation">GDP per capita = (GDP √ó 1000) √∑ Population</div>
                            <div class="calculation">GDP per capita = (${data.gdp} √ó 1000) √∑ ${data.population}</div>
                            <div class="result">GDP per capita = ${data.gdpPerCapita} CAD</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Parts E & F: Income Shares</h5>
                            <div class="calculation">CE Share = (${data.compensationEmployees} √∑ ${data.gdp}) √ó 100 = ${data.ceRatio}%</div>
                            <div class="calculation">GOS Share = (${data.grossOperatingSurplus} √∑ ${data.gdp}) √ó 100 = ${data.gosRatio}%</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üá®üá¶ Economic Summary:</strong> During this ${data.context} in ${data.province}, the income distribution shows ${data.ceRatio > 55 ? 'labor-favored' : 'balanced'} economic conditions with ${data.gosRatio > 25 ? 'strong' : 'moderate'} business profitability.
                        </div>
                    `;

                } else {
                    // Percentage analysis questions
                    const componentName = questionData.type === 'compensation_employees' ? 'Compensation of Employees' :
                                        questionData.type === 'operating_surplus' ? 'Gross Operating Surplus' : 'Gross Mixed Income';
                    const componentValue = questionData.type === 'compensation_employees' ? data.compensationEmployees :
                                         questionData.type === 'operating_surplus' ? data.grossOperatingSurplus : data.grossMixedIncome;
                    
                    solutionHTML = `
                        <h4>üìä ${componentName} Analysis</h4>
                        
                        <div class="solution-step">
                            <h5>Percentage Calculation</h5>
                            <div class="calculation">Share = (Component √∑ Total GDP) √ó 100</div>
                            <div class="calculation">Share = (${componentValue} √∑ ${data.gdp}) √ó 100</div>
                            <div class="result">${componentName} = ${questionData.correctAnswer}% of GDP</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üí° Economic Insight:</strong> A ${questionData.correctAnswer}% share indicates ${questionData.correctAnswer > (questionData.type === 'compensation_employees' ? 55 : questionData.type === 'operating_surplus' ? 25 : 9) ? 'above-average' : 'typical'} ${questionData.type === 'compensation_employees' ? 'labor compensation' : questionData.type === 'operating_surplus' ? 'business profitability' : 'entrepreneurial activity'} for this economic period.
                        </div>
                    `;
                }
                
                document.getElementById('solution').innerHTML = solutionHTML;
                document.getElementById('solution').classList.remove('hidden');
            }
        }

        // Initialize simulator
        const simulator = new GDPIncomeSimulator();

        function selectQuestionType(type) {
            simulator.questionType = type;
            
            // Update selector appearance
            document.querySelectorAll('.type-selector').forEach(el => el.classList.remove('active'));
            document.getElementById(type + '-selector').classList.add('active');
            
            generateNewQuestion();
        }

        function generateNewQuestion() {
            simulator.currentQuestion = simulator.generateQuestion(simulator.questionType);
            simulator.displayQuestion(simulator.currentQuestion);
            
            // Clear previous answers and feedback
            clearAnswers();
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('solution').classList.add('hidden');
            
            // Update question counter
            document.getElementById('question-counter').textContent = `Question ${simulator.questionCount} of ‚àû`;
            simulator.questionCount++;
        }

        function checkAnswers() {
            if (!simulator.currentQuestion) {
                alert('Please generate a question first!');
                return;
            }

            const feedback = document.getElementById('feedback');
            
            if (simulator.currentQuestion.type === 'comprehensive') {
                const answers = {
                    totalGDP: parseFloat(document.getElementById('total-gdp-input').value),
                    netTaxes: parseFloat(document.getElementById('net-taxes-input').value),
                    realGDP: parseFloat(document.getElementById('real-gdp-input').value),
                    gdpPerCapita: parseFloat(document.getElementById('gdp-per-capita-input').value),
                    ceShare: parseFloat(document.getElementById('ce-share-input').value),
                    gosShare: parseFloat(document.getElementById('gos-share-input').value)
                };
                
                if (Object.values(answers).some(isNaN)) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '‚ö†Ô∏è Please enter valid numbers for all parts.';
                    feedback.classList.remove('hidden');
                    return;
                }
                
                const result = simulator.checkComprehensiveAnswers(answers, simulator.currentQuestion);
                
                // Update input styling
                document.getElementById('total-gdp-input').className = result.results.totalGDP ? 'input-correct' : 'input-incorrect';
                document.getElementById('net-taxes-input').className = result.results.netTaxes ? 'input-correct' : 'input-incorrect';
                document.getElementById('real-gdp-input').className = result.results.realGDP ? 'input-correct' : 'input-incorrect';
                document.getElementById('gdp-per-capita-input').className = result.results.gdpPerCapita ? 'input-correct' : 'input-incorrect';
                document.getElementById('ce-share-input').className = result.results.ceShare ? 'input-correct' : 'input-incorrect';
                document.getElementById('gos-share-input').className = result.results.gosShare ? 'input-correct' : 'input-incorrect';
                
                feedback.classList.remove('hidden');
                
                if (result.allCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'üéâ Perfect! All GDP income approach calculations are correct!<br>üá®üá¶ You have mastered Canadian national accounting!';
                } else if (result.correctCount >= 4) {
                    feedback.className = 'feedback partial';
                    feedback.innerHTML = `‚úÖ ${result.correctCount} out of 6 correct!<br>üí° Review the GDP income approach formula and calculation steps.`;
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚ùå Most calculations need adjustment.<br>üí∞ Remember: GDP = CE + GOS + GMI + (T - S)`;
                }
            } else {
                const singleInput = parseFloat(document.getElementById('answer-input').value);
                
                if (isNaN(singleInput)) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '‚ö†Ô∏è Please enter a valid number.';
                    feedback.classList.remove('hidden');
                    return;
                }
                
                const result = simulator.checkSingleAnswer(singleInput, simulator.currentQuestion);
                
                // Update input styling
                document.getElementById('answer-input').className = result.isCorrect ? 'input-correct' : 'input-incorrect';
                
                feedback.classList.remove('hidden');
                
                if (result.isCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'üéâ Excellent! Your GDP income calculation is correct!<br>üá®üá¶ Well done with Canadian economic analysis!';
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚ùå Not quite right. The correct answer is ${result.correctAnswer} ${simulator.currentQuestion.answerUnit}.<br>üí° Review the income approach components and try again.`;
                }
            }
        }

        function showSolution() {
            if (!simulator.currentQuestion) {
                alert('Please generate a question first!');
                return;
            }
            
            simulator.showSolution(simulator.currentQuestion);
        }

        function clearAnswers() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '';
                input.className = '';
            });
        }

        // Generate first question on page load
        window.onload = function() {
            generateNewQuestion();
        };
    </script>
</body>
</html>
