<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Measures of Dispersion - Interactive Statistics Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .red-title {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 5px solid #a71e2a;
        }

        .red-title h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .red-title p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .blue-concepts {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 25px;
            margin: 0;
        }

        .blue-concepts h3 {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .measures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .measure-card {
            padding: 20px;
            border-radius: 15px;
            border: 3px solid;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .measure-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.15);
        }

        .range-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-color: #1e7e34;
            color: white;
        }

        .iqr-card {
            background: linear-gradient(135deg, #17a2b8, #138496);
            border-color: #117a8b;
            color: white;
        }

        .variance-card {
            background: linear-gradient(135deg, #fd7e14, #e55353);
            border-color: #d63384;
            color: white;
        }

        .stddev-card {
            background: linear-gradient(135deg, #6f42c1, #8e44ad);
            border-color: #563d7c;
            color: white;
        }

        .mad-card {
            background: linear-gradient(135deg, #ffc107, #ff8800);
            border-color: #d39e00;
            color: #212529;
        }

        .cv-card {
            background: linear-gradient(135deg, #e83e8c, #d91a72);
            border-color: #c7185d;
            color: white;
        }

        .measure-card h4 {
            font-size: 1.4em;
            margin-bottom: 15px;
            text-align: center;
        }

        .measure-card .formula {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-align: center;
        }

        .measure-card .description {
            margin-bottom: 15px;
            font-weight: 500;
        }

        .measure-card .use-cases {
            margin-bottom: 15px;
            font-style: italic;
            font-size: 0.95em;
        }

        .measure-card .examples {
            font-size: 0.9em;
            border-top: 2px solid rgba(255,255,255,0.3);
            padding-top: 10px;
        }

        .interactive-section {
            padding: 30px;
            background: #f8f9fa;
        }

        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
        }

        .scenario-display {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #28a745;
        }

        .calculation-area {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #ffc107;
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px 5px;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }

        .btn:hover {
            background: linear-gradient(135deg, #20c997, #28a745);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
            box-shadow: 0 4px 10px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #495057, #6c757d);
            box-shadow: 0 6px 15px rgba(108, 117, 125, 0.4);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #007bff;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #dee2e6;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .measure-result {
            background: #e9f7ef;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-by-step {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .step {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: white;
            border-radius: 5px;
        }

        .step h5 {
            color: #007bff;
            margin-bottom: 8px;
        }

        .interpretation-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }

        .score-display {
            background: linear-gradient(135deg, #e83e8c, #d91a72);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #c7185d;
            box-shadow: 0 4px 15px rgba(232, 62, 140, 0.3);
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .option-checkbox {
            background: linear-gradient(135deg, #e9ecef, #dee2e6);
            border-radius: 10px;
            padding: 10px 12px;
            border: 2px solid #ced4da;
            display: flex;
            gap: 8px;
            align-items: flex-start;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .measures-grid {
                grid-template-columns: 1fr;
            }
            
            .data-table {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="red-title">
            <h1>üìä Measures of Dispersion (Variability)</h1>
            <p>Explore how spread out data are around the center using real-world scenarios</p>
        </div>

        <div class="blue-concepts">
            <h3>üìè Key Measures of Dispersion</h3>
            <div class="measures-grid">
                <div class="measure-card range-card">
                    <h4>üìè Range</h4>
                    <div class="formula">Range = Max ‚àí Min</div>
                    <div class="description">
                        Quick snapshot of total spread: how far the largest value is from the smallest.
                    </div>
                    <div class="use-cases">
                        <strong>When to use:</strong> First look at spread, comparing variability across similar datasets.
                    </div>
                    <div class="examples">
                        <strong>Examples:</strong> Daily temperature range, salary range in a department.
                    </div>
                </div>

                <div class="measure-card iqr-card">
                    <h4>üì¶ Interquartile Range (IQR)</h4>
                    <div class="formula">IQR = Q‚ÇÉ ‚àí Q‚ÇÅ</div>
                    <div class="description">
                        Spread of the middle 50% of values; ignores extreme high and low values.
                    </div>
                    <div class="use-cases">
                        <strong>When to use:</strong> Skewed data, outliers present, boxplots.
                    </div>
                    <div class="examples">
                        <strong>Examples:</strong> Typical house price spread, typical response times.
                    </div>
                </div>

                <div class="measure-card variance-card">
                    <h4>üìê Population vs Sample Variance</h4>
                    <div class="formula">œÉ¬≤ = Œ£(x ‚àí Œº)¬≤ / N<br> s¬≤ = Œ£(x ‚àí xÃÑ)¬≤ / (n ‚àí 1)</div>
                    <div class="description">
                        Variance measures the average squared distance from the mean. 
                        Population variance (œÉ¬≤) is used when you have data for the whole population; 
                        sample variance (s¬≤) is used when your data are a sample.
                    </div>
                    <div class="use-cases">
                        <strong>When to use:</strong> Statistical modelling, ANOVA, regression, risk modelling.
                    </div>
                    <div class="examples">
                        <strong>Examples:</strong> Variance of test scores, variance of production errors.
                    </div>
                </div>

                <div class="measure-card stddev-card">
                    <h4>üìä Population vs Sample Standard Deviation</h4>
                    <div class="formula">œÉ = ‚àöœÉ¬≤ &nbsp;&nbsp; s = ‚àös¬≤</div>
                    <div class="description">
                        Standard deviation is the typical distance from the mean in the same units as the data. 
                        We distinguish between population (œÉ) and sample (s), mirroring the two variances.
                    </div>
                    <div class="use-cases">
                        <strong>When to use:</strong> Communicating spread, describing volatility, quality control.
                    </div>
                    <div class="examples">
                        <strong>Examples:</strong> Volatility of returns, spread in delivery times.
                    </div>
                </div>

                <div class="measure-card mad-card">
                    <h4>‚ù§Ô∏è Median Absolute Deviation (MAD)</h4>
                    <div class="formula">MAD = median(|x ‚àí median(x)|)</div>
                    <div class="description">
                        Robust measure of spread based on distances from the median; less affected by outliers.
                    </div>
                    <div class="use-cases">
                        <strong>When to use:</strong> Strongly skewed data, outlier-resistant analysis.
                    </div>
                    <div class="examples">
                        <strong>Examples:</strong> Typical variation in incomes, travel times with occasional long delays.
                    </div>
                </div>

                <div class="measure-card cv-card">
                    <h4>‚öñÔ∏è Coefficient of Variation (CV)</h4>
                    <div class="formula">CV = (s / xÃÑ) √ó 100%</div>
                    <div class="description">
                        CV describes variability relative to the mean. It is unitless and expressed as a percentage.
                    </div>
                    <div class="use-cases">
                        <strong>When to use:</strong> Comparing variability across different scales or units (e.g., two investments, two machines).
                    </div>
                    <div class="examples">
                        <strong>Examples:</strong> Risk per unit of return, relative precision of lab instruments.
                    </div>
                </div>
            </div>
        </div>

        <div class="interactive-section">
            <div class="control-panel">
                <h3>üéÆ Interactive Calculations</h3>
                <p>Choose a real-world scenario, then calculate and interpret different measures of dispersion.</p>
                <button class="btn" onclick="generateScenario()">üìä Generate New Scenario</button>
                <button class="btn btn-secondary" onclick="resetCalculator()">üîÑ Reset</button>
            </div>

            <div id="scenarioDisplay" class="scenario-display" style="display: none;">
                <h3 id="scenarioTitle">üìã Scenario</h3>
                <div id="scenarioDescription"></div>
                <div id="dataDisplay"></div>

                <div style="margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #6c757d;">
                    <h4>‚öôÔ∏è Select Measures to Calculate</h4>
                    <p style="font-size: 0.9em; color: #555;">You can calculate any combination. CV is shown only when the mean is non-zero.</p>

                    <div class="options-grid" id="measureCheckboxes">
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkRange" checked style="margin-top: 3px;">
                            <div>
                                <strong>üìè Range</strong><br>
                                Total spread (max ‚àí min).
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkIQR" checked style="margin-top: 3px;">
                            <div>
                                <strong>üì¶ IQR</strong><br>
                                Spread of the middle 50% of data.
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkPopVar" checked style="margin-top: 3px;">
                            <div>
                                <strong>üìê Population Variance (œÉ¬≤)</strong><br>
                                Treating data as the full population.
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkSampVar" checked style="margin-top: 3px;">
                            <div>
                                <strong>üìê Sample Variance (s¬≤)</strong><br>
                                Using n ‚àí 1 in the denominator.
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkPopSD" checked style="margin-top: 3px;">
                            <div>
                                <strong>üìä Population SD (œÉ)</strong><br>
                                Square root of œÉ¬≤.
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkSampSD" checked style="margin-top: 3px;">
                            <div>
                                <strong>üìä Sample SD (s)</strong><br>
                                Square root of s¬≤.
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkMAD" checked style="margin-top: 3px;">
                            <div>
                                <strong>‚ù§Ô∏è MAD</strong><br>
                                Median distance from the median.
                            </div>
                        </label>
                        <label class="option-checkbox">
                            <input type="checkbox" id="chkCV" checked style="margin-top: 3px;">
                            <div>
                                <strong>‚öñÔ∏è CV</strong><br>
                                Variability relative to the mean (using sample SD).
                            </div>
                        </label>
                    </div>

                    <button class="btn" onclick="calculateMeasures()" style="margin-top: 15px;">üßÆ Calculate Selected Measures</button>
                </div>
            </div>

            <div id="calculationArea" class="calculation-area">
                <h3>üìù Calculations & Results</h3>
                <div id="calculationSteps"></div>
                <div id="resultsDisplay"></div>
                <div id="interpretationDisplay"></div>
                <button class="btn" onclick="generateScenario()">‚û°Ô∏è Try Another Scenario</button>
            </div>

            <div class="score-display">
                <h3>üéØ Practice Progress</h3>
                <div>Scenarios Explored: <span id="scenariosCompleted">0</span></div>
                <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                    Building intuition about how different measures describe variability.
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentScenario = null;
        let scenariosCompleted = 0;

        // MORE scenarios, all numerical
        const scenarios = [
            {
                title: "Canadian Tech Startup Salaries",
                description: "Annual salaries (in CAD) for developers at a Toronto tech startup.",
                context: "HR wants to describe how unequal salaries are within the team.",
                data: [65000, 68000, 72000, 75000, 78000, 82000, 85000, 88000, 165000]
            },
            {
                title: "Customer Waiting Times at a Montreal Bank",
                description: "Customer waiting times (in minutes) during peak hours.",
                context: "Operations wants to understand how consistent service times are.",
                data: [3, 4, 5, 6, 7, 8, 9, 25, 30]
            },
            {
                title: "Daily CAD/USD Exchange Rate",
                description: "Daily CAD/USD exchange rates over a trading week.",
                context: "A bank analyst wants to describe exchange rate volatility.",
                data: [0.725, 0.731, 0.718, 0.742, 0.728, 0.735, 0.721]
            },
            {
                title: "Quality Control in an Ontario Factory",
                description: "Lengths (in mm) of metal rods (target length = 100 mm).",
                context: "Engineers want to monitor variation around the target.",
                data: [99.6, 100.3, 100.1, 99.8, 100.4, 99.9, 100.2, 100.0, 99.7]
            },
            {
                title: "House Prices in a Mixed Neighbourhood",
                description: "Sale prices (in CAD) for homes in a Canadian city.",
                context: "A planner wants to summarize both typical and extreme variability.",
                data: [420000, 450000, 480000, 520000, 560000, 600000, 1350000]
            },
            {
                title: "Annual Returns of a Canadian Tech Fund",
                description: "Annual returns (%) over 7 years.",
                context: "An investor wants to quantify risk and relative risk.",
                data: [18.2, -12.1, 25.3, 4.7, 30.9, -5.4, 10.5]
            },
            {
                title: "Daily Snowfall Amounts in Calgary (cm)",
                description: "Daily snowfall amounts over a short winter period.",
                context: "A city services manager wants to know how variable snowfall is.",
                data: [0, 0.5, 3, 0, 10, 15, 0, 7, 2, 0]
            },
            {
                title: "Class Quiz Scores in a Statistics Course",
                description: "Quiz scores (out of 10) for a section of students.",
                context: "An instructor wants to see how spread out the performance is.",
                data: [3, 4, 5, 5, 6, 7, 8, 10, 10, 9, 4, 6, 7]
            },
            {
                title: "Daily Sales (in $1000s) at a Coffee Shop",
                description: "Sales over 10 days at a busy downtown location.",
                context: "The owner wants to know how stable daily revenue is.",
                data: [3.2, 3.5, 3.1, 3.8, 4.0, 3.9, 3.3, 3.6, 3.4, 3.7]
            },
            {
                title: "Commute Times for Toronto Office Workers (minutes)",
                description: "Commute times for a sample of employees.",
                context: "HR wants to understand variability in commute burden.",
                data: [20, 25, 30, 35, 40, 45, 60, 70, 80]
            }
        ];

        function generateScenario() {
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            currentScenario = scenario;

            document.getElementById('scenarioDisplay').style.display = 'block';
            document.getElementById('calculationArea').style.display = 'none';

            document.getElementById('scenarioTitle').textContent = "üìä " + scenario.title;
            document.getElementById('scenarioDescription').innerHTML = `
                <div style="background: #e9f7ef; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <h4>üìã Context:</h4>
                    <p style="margin-top: 10px;">${scenario.description}</p>
                    <p style="margin-top: 10px; font-style: italic; color: #6c757d;">
                        <strong>Goal:</strong> ${scenario.context}
                    </p>
                </div>
            `;

            displayData(scenario.data);
            // reset checkboxes to default checked state
            ["chkRange","chkIQR","chkPopVar","chkSampVar","chkPopSD","chkSampSD","chkMAD","chkCV"]
                .forEach(id => { const el = document.getElementById(id); if (el) el.checked = true; });
        }

        function displayData(data) {
            let dataHTML = `
                <h4>üìã Numerical Data:</h4>
                <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid #007bff; margin: 15px 0;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 10px; text-align: center;">
            `;
            
            data.forEach(value => {
                dataHTML += `<div style="background: #f8f9fa; padding: 10px; border-radius: 5px; border: 1px solid #dee2e6;"><strong>${value}</strong></div>`;
            });
            
            dataHTML += `
                    </div>
                    <p style="margin-top: 15px; text-align: center; color: #6c757d;">
                        n = ${data.length} observations
                    </p>
                </div>
            `;
            
            document.getElementById('dataDisplay').innerHTML = dataHTML;
        }

        function calculateMeasures() {
            if (!currentScenario) {
                alert("Please generate a scenario first.");
                return;
            }

            const data = currentScenario.data;
            const n = data.length;
            if (n < 2) {
                alert("Need at least 2 observations to calculate most measures.");
                return;
            }

            const mean = calculateMean(data);
            const median = calculateMedian([...data]);
            const sortedData = [...data].sort((a,b) => a - b);

            const results = {};
            const stepsPieces = [];

            // Range
            if (document.getElementById('chkRange').checked) {
                const range = calculateRange(sortedData);
                results.range = range;
                stepsPieces.push(rangeSteps(sortedData, range));
            }

            // IQR
            if (document.getElementById('chkIQR').checked) {
                const quartiles = calculateQuartiles(sortedData);
                results.iqr = quartiles.iqr;
                stepsPieces.push(iqrSteps(sortedData, quartiles));
            }

            // Population variance & SD
            if (document.getElementById('chkPopVar').checked || document.getElementById('chkPopSD').checked) {
                const popVar = calculatePopulationVariance(data, mean);
                if (document.getElementById('chkPopVar').checked) {
                    results.popVar = popVar;
                    stepsPieces.push(popVarianceSteps(data, mean, popVar));
                }
                if (document.getElementById('chkPopSD').checked) {
                    const popSD = Math.sqrt(popVar);
                    results.popSD = popSD;
                    stepsPieces.push(popStdSteps(popVar, popSD));
                }
            }

            // Sample variance & SD
            if (document.getElementById('chkSampVar').checked || document.getElementById('chkSampSD').checked) {
                const sampVar = calculateSampleVariance(data, mean);
                if (document.getElementById('chkSampVar').checked) {
                    results.sampVar = sampVar;
                    stepsPieces.push(sampleVarianceSteps(data, mean, sampVar));
                }
                if (document.getElementById('chkSampSD').checked) {
                    const sampSD = Math.sqrt(sampVar);
                    results.sampSD = sampSD;
                    stepsPieces.push(sampleStdSteps(sampVar, sampSD));
                }
            }

            // MAD
            if (document.getElementById('chkMAD').checked) {
