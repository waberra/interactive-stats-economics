<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standard Normal Distribution Probability Calculator - Interactive Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .type-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .type-basic {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .type-application {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .type-comprehensive {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .question-text {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            padding: 25px;
            border-left: 5px solid #3498db;
            margin-bottom: 25px;
            line-height: 1.6;
            border-radius: 0 10px 10px 0;
        }
        
        .question-text h3 {
            margin-top: 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .context-box {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #dee2e6;
        }
        
        .context-box .context-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .parameters {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .parameter {
            background: white;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .parameter-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .parameter-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stats-highlight {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            color: #155724;
        }
        
        .answer-section {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .input-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .input-group label {
            display: inline-block;
            min-width: 200px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 150px;
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .input-correct {
            border-color: #27ae60 !important;
            background-color: #d4edda !important;
        }
        
        .input-incorrect {
            border-color: #e74c3c !important;
            background-color: #f8d7da !important;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #27ae60, #229954);
        }
        
        .btn-generate:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
        }
        
        .feedback {
            padding: 18px;
            margin: 20px 0;
            border-radius: 10px;
            font-weight: bold;
            border-left: 5px solid;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left-color: #27ae60;
        }
        
        .feedback.partial {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left-color: #f39c12;
        }
        
        .feedback.incorrect {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-left-color: #e74c3c;
        }
        
        .solution {
            background: linear-gradient(135deg, #eaf2f8, #d6eaf8);
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        
        .solution h4 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .solution-step {
            background-color: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #d6eaf8;
        }
        
        .solution-step h5 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .formula {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            display: block;
            margin: 5px 0;
            border: 1px solid #dee2e6;
            font-size: 1.1em;
        }
        
        .result {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            background: linear-gradient(135deg, #d6eaf8, #aed6f1);
            padding: 10px 15px;
            border-radius: 5px;
            display: inline-block;
            margin: 8px 0;
        }
        
        .interpretation-box {
            background: linear-gradient(135deg, #e8f5e8, #d4f1d4);
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #155724;
        }
        
        .hidden {
            display: none;
        }
        
        .navigation {
            text-align: center;
            margin: 30px 0;
        }
        
        .question-counter {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 10px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .question-types {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .type-selector {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            border: 2px solid #95a5a6;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .type-selector.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #764ba2;
        }
        
        .type-selector:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .comprehensive-answers {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .part-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .part-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .normal-curve {
            text-align: center;
            margin: 20px 0;
            font-size: 2em;
            color: #667eea;
        }
    </style>
</head>
<body>
    <h1>üìä Standard Normal Distribution Probability Calculator</h1>
    
    <div class="container">
        <div class="navigation">
            <div class="question-counter" id="question-counter">Question 1 of ‚àû</div>
            
            <div class="question-types">
                <div class="type-selector active" id="basic-selector" onclick="selectQuestionType('basic')">
                    üìà Basic Z-Scores
                </div>
                <div class="type-selector" id="application-selector" onclick="selectQuestionType('application')">
                    üåç Real-World Applications  
                </div>
                <div class="type-selector" id="comprehensive-selector" onclick="selectQuestionType('comprehensive')">
                    üéØ Comprehensive Analysis
                </div>
                <div class="type-selector" id="random-selector" onclick="selectQuestionType('random')">
                    üé≤ Random Mix
                </div>
            </div>
            
            <button class="btn btn-generate" onclick="generateNewQuestion()">Generate New Problem</button>
        </div>
        
        <div class="normal-curve">
            üìà Œº=0, œÉ=1 üîî
        </div>
        
        <div id="question-container"></div>
        
        <div class="answer-section">
            <div id="answer-inputs"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="checkAnswers()">‚úì Check Answer</button>
                <button class="btn btn-secondary" onclick="showSolution()">üí° Show Solution</button>
                <button class="btn btn-secondary" onclick="clearAnswers()">üóëÔ∏è Clear</button>
            </div>
        </div>

        <div id="feedback" class="feedback hidden"></div>
        
        <div id="solution" class="solution hidden"></div>
    </div>

    <script>
        // Include the StandardNormalSimulator class
        class StandardNormalSimulator {
            constructor() {
                // Common z-scores and their probabilities for validation
                this.commonZScores = {
                    '-3.00': 0.0013, '-2.58': 0.0049, '-2.33': 0.0099, '-1.96': 0.0250,
                    '-1.645': 0.0500, '-1.28': 0.1003, '-1.00': 0.1587, '-0.67': 0.2514,
                    '0.00': 0.5000, '0.67': 0.7486, '1.00': 0.8413, '1.28': 0.8997,
                    '1.645': 0.9500, '1.96': 0.9750, '2.33': 0.9901, '2.58': 0.9951, '3.00': 0.9987
                };

                // Real-world contexts for probability applications
                this.contexts = {
                    heights: {
                        description: 'human heights',
                        meanRange: [160, 180], // cm
                        stdRange: [8, 12],
                        unit: 'cm'
                    },
                    test_scores: {
                        description: 'standardized test scores',
                        meanRange: [500, 1000],
                        stdRange: [100, 200],
                        unit: 'points'
                    },
                    manufacturing: {
                        description: 'manufacturing measurements',
                        meanRange: [50, 100],
                        stdRange: [2, 5],
                        unit: 'mm'
                    },
                    reaction_times: {
                        description: 'reaction times',
                        meanRange: [250, 400],
                        stdRange: [30, 50],
                        unit: 'milliseconds'
                    },
                    weights: {
                        description: 'product weights',
                        meanRange: [500, 1000],
                        stdRange: [15, 30],
                        unit: 'grams'
                    }
                };

                this.currentQuestion = null;
                this.currentSolution = null;
                this.questionCount = 1;
                this.questionType = 'basic';
            }

            randomBetween(min, max, decimals = 2) {
                const factor = Math.pow(10, decimals);
                return Math.round((Math.random() * (max - min) + min) * factor) / factor;
            }

            standardNormalCDF(z) {
                // Abramowitz and Stegun approximation
                if (z < -6) return 0;
                if (z > 6) return 1;
                
                const b1 = 0.319381530;
                const b2 = -0.356563782;
                const b3 = 1.781477937;
                const b4 = -1.821255978;
                const b5 = 1.330274429;
                const p = 0.2316419;
                const c = 0.39894228;
                
                if (z >= 0) {
                    const t = 1.0 / (1.0 + p * z);
                    return 1 - c * Math.exp(-z * z / 2) * t * 
                           (t * (t * (t * (t * b5 + b4) + b3) + b2) + b1);
                } else {
                    return 1 - this.standardNormalCDF(-z);
                }
            }

            standardNormalInverse(p) {
                if (p <= 0 || p >= 1) return null;
                
                // Common percentiles lookup table
                const percentiles = {
                    0.01: -2.326, 0.025: -1.96, 0.05: -1.645, 0.10: -1.282,
                    0.20: -0.842, 0.25: -0.674, 0.30: -0.524, 0.40: -0.253,
                    0.50: 0.000, 0.60: 0.253, 0.70: 0.524, 0.75: 0.674, 
                    0.80: 0.842, 0.90: 1.282, 0.95: 1.645, 0.975: 1.96, 0.99: 2.326
                };

                // Check if exact match
                if (percentiles[p]) {
                    return percentiles[p];
                }

                // Linear interpolation
                const keys = Object.keys(percentiles).map(Number).sort((a, b) => a - b);
                
                for (let i = 0; i < keys.length - 1; i++) {
                    if (p > keys[i] && p < keys[i + 1]) {
                        const p1 = keys[i];
                        const p2 = keys[i + 1];
                        const z1 = percentiles[p1];
                        const z2 = percentiles[p2];
                        
                        return z1 + (z2 - z1) * (p - p1) / (p2 - p1);
                    }
                }

                // Fallback for extreme values
                if (p < 0.01) return -3.0;
                if (p > 0.99) return 3.0;
                
                return 0;
            }

            generateLessThanQuestion() {
                const z = this.randomBetween(-3, 3);
                const probability = this.standardNormalCDF(z);

                return {
                    type: 'less_than',
                    zScore: z,
                    probability: Math.round(probability * 10000) / 10000,
                    questionText: `Find P(Z < ${z}) where Z is a standard normal random variable.`,
                    answer: Math.round(probability * 10000) / 10000
                };
            }

            generateGreaterThanQuestion() {
                const z = this.randomBetween(-3, 3);
                const probability = 1 - this.standardNormalCDF(z);

                return {
                    type: 'greater_than',
                    zScore: z,
                    probability: Math.round(probability * 10000) / 10000,
                    questionText: `Find P(Z > ${z}) where Z is a standard normal random variable.`,
                    answer: Math.round(probability * 10000) / 10000
                };
            }

            generateBetweenQuestion() {
                let z1 = this.randomBetween(-2.5, 1.5);
                let z2 = this.randomBetween(z1 + 0.5, 3);

                const prob1 = this.standardNormalCDF(z1);
                const prob2 = this.standardNormalCDF(z2);
                const probability = prob2 - prob1;

                return {
                    type: 'between',
                    z1: z1,
                    z2: z2,
                    probability: Math.round(probability * 10000) / 10000,
                    questionText: `Find P(${z1} < Z < ${z2}) where Z is a standard normal random variable.`,
                    answer: Math.round(probability * 10000) / 10000
                };
            }

            generateInverseQuestion() {
                const percentile = Math.floor(Math.random() * 89) + 5; // 5-94th percentile
                const probability = percentile / 100;
                const zScore = this.standardNormalInverse(probability);

                return {
                    type: 'inverse',
                    percentile: percentile,
                    probability: probability,
                    zScore: Math.round(zScore * 100) / 100,
                    questionText: `Find the z-score that corresponds to the ${percentile}th percentile of the standard normal distribution.`,
                    answer: Math.round(zScore * 100) / 100
                };
            }

            generateApplicationQuestion() {
                // Select random context
                const contextKeys = Object.keys(this.contexts);
                const contextKey = contextKeys[Math.floor(Math.random() * contextKeys.length)];
                const context = this.contexts[contextKey];

                // Generate parameters
                const mean = Math.floor(Math.random() * (context.meanRange[1] - context.meanRange[0] + 1)) + context.meanRange[0];
                const std = Math.floor(Math.random() * (context.stdRange[1] - context.stdRange[0] + 1)) + context.stdRange[0];

                // Generate question type
                const questionTypes = ['less_than', 'greater_than', 'between', 'percentile'];
                const questionType = questionTypes[Math.floor(Math.random() * questionTypes.length)];

                switch (questionType) {
                    case 'less_than': {
                        const z = this.randomBetween(-2, 2);
                        const value = Math.round((mean + z * std) * 10) / 10;
                        const zActual = (value - mean) / std;
                        const probability = this.standardNormalCDF(zActual);

                        return {
                            type: 'application_less_than',
                            context: contextKey,
                            contextDescription: context.description,
                            mean: mean,
                            std: std,
                            unit: context.unit,
                            value: value,
                            zScore: Math.round(zActual * 100) / 100,
                            probability: Math.round(probability * 10000) / 10000,
                            questionText: `The ${context.description} are normally distributed with mean ${mean} ${context.unit} and standard deviation ${std} ${context.unit}. What is the probability that a randomly selected measurement is less than ${value} ${context.unit}?`,
                            answer: Math.round(probability * 10000) / 10000
                        };
                    }

                    case 'greater_than': {
                        const z = this.randomBetween(-2, 2);
                        const value = Math.round((mean + z * std) * 10) / 10;
                        const zActual = (value - mean) / std;
                        const probability = 1 - this.standardNormalCDF(zActual);

                        return {
                            type: 'application_greater_than',
                            context: contextKey,
                            contextDescription: context.description,
                            mean: mean,
                            std: std,
                            unit: context.unit,
                            value: value,
                            zScore: Math.round(zActual * 100) / 100,
                            probability: Math.round(probability * 10000) / 10000,
                            questionText: `The ${context.description} are normally distributed with mean ${mean} ${context.unit} and standard deviation ${std} ${context.unit}. What is the probability that a randomly selected measurement is greater than ${value} ${context.unit}?`,
                            answer: Math.round(probability * 10000) / 10000
                        };
                    }

                    case 'between': {
                        const z1 = this.randomBetween(-2, 0);
                        const z2 = this.randomBetween(0, 2);
                        const value1 = Math.round((mean + z1 * std) * 10) / 10;
                        const value2 = Math.round((mean + z2 * std) * 10) / 10;

                        const prob1 = this.standardNormalCDF(z1);
                        const prob2 = this.standardNormalCDF(z2);
                        const probability = prob2 - prob1;

                        return {
                            type: 'application_between',
                            context: contextKey,
                            contextDescription: context.description,
                            mean: mean,
                            std: std,
                            unit: context.unit,
                            value1: value1,
                            value2: value2,
                            z1: Math.round(z1 * 100) / 100,
                            z2: Math.round(z2 * 100) / 100,
                            probability: Math.round(probability * 10000) / 10000,
                            questionText: `The ${context.description} are normally distributed with mean ${mean} ${context.unit} and standard deviation ${std} ${context.unit}. What is the probability that a randomly selected measurement falls between ${value1} ${context.unit} and ${value2} ${context.unit}?`,
                            answer: Math.round(probability * 10000) / 10000
                        };
                    }

                    case 'percentile': {
                        const percentile = Math.floor(Math.random() * 81) + 10; // 10-90th percentile
                        const probability = percentile / 100;
                        const zScore = this.standardNormalInverse(probability);
                        const value = Math.round((mean + zScore * std) * 10) / 10;

                        return {
                            type: 'application_percentile',
                            context: contextKey,
                            contextDescription: context.description,
                            mean: mean,
                            std: std,
                            unit: context.unit,
                            percentile: percentile,
                            zScore: Math.round(zScore * 100) / 100,
                            value: value,
                            questionText: `The ${context.description} are normally distributed with mean ${mean} ${context.unit} and standard deviation ${std} ${context.unit}. What value corresponds to the ${percentile}th percentile?`,
                            answer: value
                        };
                    }
                }
            }

            generateComprehensiveQuestion() {
                // Select context
                const contextKeys = Object.keys(this.contexts);
                const contextKey = contextKeys[Math.floor(Math.random() * contextKeys.length)];
                const context = this.contexts[contextKey];

                const mean = Math.floor(Math.random() * (context.meanRange[1] - context.meanRange[0] + 1)) + context.meanRange[0];
                const std = Math.floor(Math.random() * (context.stdRange[1] - context.stdRange[0] + 1)) + context.stdRange[0];

                // Generate multiple related questions
                const z1 = this.randomBetween(-1.5, 0.5);
                const z2 = this.randomBetween(0.5, 2);
                const value1 = Math.round((mean + z1 * std) * 10) / 10;
                const value2 = Math.round((mean + z2 * std) * 10) / 10;

                const probLess = this.standardNormalCDF(z1);
                const probGreater = 1 - this.standardNormalCDF(z2);
                const probBetween = this.standardNormalCDF(z2) - this.standardNormalCDF(z1);

                const percentile = Math.floor(Math.random() * 71) + 15; // 15-85th percentile
                const percProb = percentile / 100;
                const percZ = this.standardNormalInverse(percProb);
                const percValue = Math.round((mean + percZ * std) * 10) / 10;

                return {
                    type: 'comprehensive',
                    context: contextKey,
                    contextDescription: context.description,
                    mean: mean,
                    std: std,
                    unit: context.unit,
                    value1: value1,
                    value2: value2,
                    z1: Math.round(z1 * 100) / 100,
                    z2: Math.round(z2 * 100) / 100,
                    probLess: Math.round(probLess * 10000) / 10000,
                    probGreater: Math.round(probGreater * 10000) / 10000,
                    probBetween: Math.round(probBetween * 10000) / 10000,
                    percentile: percentile,
                    percZ: Math.round(percZ * 100) / 100,
                    percValue: percValue,
                    questionText: `The ${context.description} are normally distributed with mean ${mean} ${context.unit} and standard deviation ${std} ${context.unit}.`,
                    answers: {
                        probLess: Math.round(probLess * 10000) / 10000,
                        probGreater: Math.round(probGreater * 10000) / 10000,
                        probBetween: Math.round(probBetween * 10000) / 10000,
                        percentileValue: percValue
                    }
                };
            }

            generateQuestion() {
                if (this.questionType === 'basic') {
                    const basicTypes = ['less_than', 'greater_than', 'between', 'inverse'];
                    const selectedType = basicTypes[Math.floor(Math.random() * basicTypes.length)];
                    
                    switch (selectedType) {
                        case 'less_than': return this.generateLessThanQuestion();
                        case 'greater_than': return this.generateGreaterThanQuestion();
                        case 'between': return this.generateBetweenQuestion();
                        case 'inverse': return this.generateInverseQuestion();
                    }
                } else if (this.questionType === 'application') {
                    return this.generateApplicationQuestion();
                } else if (this.questionType === 'comprehensive') {
                    return this.generateComprehensiveQuestion();
                } else {
                    // Random - mix of all types
                    const allTypes = ['basic', 'application', 'comprehensive'];
                    const selectedType = allTypes[Math.floor(Math.random() * allTypes.length)];
                    
                    if (selectedType === 'basic') {
                        const basicTypes = ['less_than', 'greater_than', 'between', 'inverse'];
                        const basicType = basicTypes[Math.floor(Math.random() * basicTypes.length)];
                        switch (basicType) {
                            case 'less_than': return this.generateLessThanQuestion();
                            case 'greater_than': return this.generateGreaterThanQuestion();
                            case 'between': return this.generateBetweenQuestion();
                            case 'inverse': return this.generateInverseQuestion();
                        }
                    } else if (selectedType === 'application') {
                        return this.generateApplicationQuestion();
                    } else {
                        return this.generateComprehensiveQuestion();
                    }
                }
            }

            displayQuestion(data) {
                let typeClass, typeText, questionHTML;

                if (data.type.startsWith('less_than') || data.type.startsWith('greater_than') || 
                    data.type.startsWith('between') || data.type.startsWith('inverse')) {
                    typeClass = 'type-basic';
                    
                    if (data.type === 'less_than') {
                        typeText = 'üìà Standard Normal: P(Z < z)';
                        questionHTML = `
                            <div class="type-indicator ${typeClass}">${typeText}</div>
                            <div class="question-text">
                                <h3>Find the probability that Z is less than a value</h3>
                                <p>${data.questionText}</p>
                                <p><strong>Use the standard normal distribution table or calculator.</strong></p>
                                <p><em>Give your answer to 4 decimal places (e.g., 0.1234)</em></p>
                            </div>
                        `;
                    } else if (data.type === 'greater_than') {
                        typeText = 'üìà Standard Normal: P(Z > z)';
                        questionHTML = `
                            <div class="type-indicator ${typeClass}">${typeText}</div>
                            <div class="question-text">
                                <h3>Find the probability that Z is greater than a value</h3>
                                <p>${data.questionText}</p>
                                <p><strong>Remember: P(Z > z) = 1 - P(Z ‚â§ z)</strong></p>
                                <p><em>Give your answer to 4 decimal places (e.g., 0.1234)</em></p>
                            </div>
                        `;
                    } else if (data.type === 'between') {
                        typeText = 'üìà Standard Normal: P(a < Z < b)';
                        questionHTML = `
                            <div class="type-indicator ${typeClass}">${typeText}</div>
                            <div class="question-text">
                                <h3>Find the probability that Z is between two values</h3>
                                <p>${data.questionText}</p>
                                <p><strong>Remember: P(a < Z < b) = P(Z < b) - P(Z < a)</strong></p>
                                <p><em>Give your answer to 4 decimal places (e.g., 0.1234)</em></p>
                            </div>
                        `;
                    } else if (data.type === 'inverse') {
                        typeText = 'üìà Standard Normal: Inverse (z-score from percentile)';
                        questionHTML = `
                            <div class="type-indicator ${typeClass}">${typeText}</div>
                            <div class="question-text">
                                <h3>Find the z-score corresponding to a percentile</h3>
                                <p>${data.questionText}</p>
                                <p><strong>Find z such that P(Z < z) = ${data.probability}</strong></p>
                                <p><em>Give your answer to 2 decimal places (e.g., 1.23)</em></p>
                            </div>
                        `;
                    }
                    
                    let inputStep = data.type === 'inverse' ? '0.01' : '0.0001';
                    let placeholder = data.type === 'inverse' ? '0.00' : '0.0000';
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="input-group">
                            <label>${data.type === 'inverse' ? 'Z-score:' : 'Probability:'}</label>
                            <input type="number" id="answer-input" step="${inputStep}" placeholder="${placeholder}">
                        </div>
                    `;

                } else if (data.type.startsWith('application')) {
                    typeClass = 'type-application';
                    typeText = 'üåç Real-World Normal Distribution Application';
                    
                    questionHTML = `
                        <div class="type-indicator ${typeClass}">${typeText}</div>
                        <div class="question-text">
                            <h3>Normal Distribution in Practice</h3>
                            <p>${data.questionText}</p>
                            
                            <div class="context-box">
                                <div class="context-header">Given Parameters</div>
                                <div class="parameters">
                                    <div class="parameter">
                                        <span class="parameter-label">Population mean (Œº):</span>
                                        <span class="parameter-value">${data.mean} ${data.unit}</span>
                                    </div>
                                    <div class="parameter">
                                        <span class="parameter-label">Population standard deviation (œÉ):</span>
                                        <span class="parameter-value">${data.std} ${data.unit}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <p><strong>Remember:</strong> Standardize using z = (X - Œº) / œÉ, then use standard normal distribution.</p>
                            <p><em>Give your answer to 4 decimal places for probabilities, or 1 decimal place for values</em></p>
                        </div>
                    `;
                    
                    let inputStep = data.type === 'application_percentile' ? '0.1' : '0.0001';
                    let placeholder = data.type === 'application_percentile' ? '0.0' : '0.0000';
                    let unit = data.type === 'application_percentile' ? data.unit : '';
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="input-group">
                            <label>${data.type === 'application_percentile' ? 'Value:' : 'Probability:'}</label>
                            <input type="number" id="answer-input" step="${inputStep}" placeholder="${placeholder}">
                            ${unit ? `<span style="font-weight: bold;">${unit}</span>` : ''}
                        </div>
                    `;

                } else if (data.type === 'comprehensive') {
                    typeClass = 'type-comprehensive';
                    typeText = 'üéØ Comprehensive Normal Distribution Analysis';
                    
                    questionHTML = `
                        <div class="type-indicator ${typeClass}">${typeText}</div>
                        <div class="question-text">
                            <h3>Complete Normal Distribution Analysis</h3>
                            <p>${data.questionText}</p>
                            
                            <div class="context-box">
                                <div class="context-header">Given Parameters</div>
                                <div class="parameters">
                                    <div class="parameter">
                                        <span class="parameter-label">Population mean (Œº):</span>
                                        <span class="parameter-value">${data.mean} ${data.unit}</span>
                                    </div>
                                    <div class="parameter">
                                        <span class="parameter-label">Population standard deviation (œÉ):</span>
                                        <span class="parameter-value">${data.std} ${data.unit}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="part-section">
                                <div class="part-title">üìä Calculate All Four Values</div>
                                <p><strong>Part A:</strong> P(X < ${data.value1} ${data.unit})</p>
                                <p><strong>Part B:</strong> P(X > ${data.value2} ${data.unit})</p>
                                <p><strong>Part C:</strong> P(${data.value1} < X < ${data.value2} ${data.unit})</p>
                                <p><strong>Part D:</strong> What value corresponds to the ${data.percentile}th percentile?</p>
                            </div>
                            
                            <p><strong>Strategy:</strong> Standardize each value using z = (X - Œº) / œÉ, then use standard normal distribution.</p>
                        </div>
                    `;
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="comprehensive-answers">
                            <div class="input-group">
                                <label>Part A - P(X < ${data.value1}):</label>
                                <input type="number" id="prob-less-input" step="0.0001" placeholder="0.0000">
                            </div>
                            <div class="input-group">
                                <label>Part B - P(X > ${data.value2}):</label>
                                <input type="number" id="prob-greater-input" step="0.0001" placeholder="0.0000">
                            </div>
                            <div class="input-group">
                                <label>Part C - P(${data.value1} < X < ${data.value2}):</label>
                                <input type="number" id="prob-between-input" step="0.0001" placeholder="0.0000">
                            </div>
                            <div class="input-group">
                                <label>Part D - ${data.percentile}th percentile:</label>
                                <input type="number" id="percentile-input" step="0.1" placeholder="0.0">
                                <span style="font-weight: bold;">${data.unit}</span>
                            </div>
                        </div>
                    `;
                }

                document.getElementById('question-container').innerHTML = questionHTML;
            }

            showSolution(data) {
                let solutionHTML = '';
                
                if (data.type === 'less_than') {
                    solutionHTML = `
                        <h4>üí° Solution: P(Z < ${data.zScore})</h4>
                        
                        <div class="solution-step">
                            <h5>Using Standard Normal Distribution</h5>
                            <div class="formula">P(Z < ${data.zScore}) = ${data.probability}</div>
                            <p>Look up z = ${data.zScore} in the standard normal table or use a calculator.</p>
                            <div class="result">Answer: ${data.probability}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Interpretation:</strong> There is a ${Math.round(data.probability * 10000)/100}% probability that a standard normal random variable is less than ${data.zScore}.
                        </div>
                    `;

                } else if (data.type === 'greater_than') {
                    const complement = Math.round((1 - data.probability) * 10000) / 10000;
                    solutionHTML = `
                        <h4>üí° Solution: P(Z > ${data.zScore})</h4>
                        
                        <div class="solution-step">
                            <h5>Using Complement Rule</h5>
                            <div class="formula">P(Z > ${data.zScore}) = 1 - P(Z ‚â§ ${data.zScore})</div>
                            <div class="formula">P(Z ‚â§ ${data.zScore}) = ${complement}</div>
                            <div class="formula">P(Z > ${data.zScore}) = 1 - ${complement} = ${data.probability}</div>
                            <div class="result">Answer: ${data.probability}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Interpretation:</strong> There is a ${Math.round(data.probability * 10000)/100}% probability that a standard normal random variable is greater than ${data.zScore}.
                        </div>
                    `;

                } else if (data.type === 'between') {
                    const prob1 = Math.round(this.standardNormalCDF(data.z1) * 10000) / 10000;
                    const prob2 = Math.round(this.standardNormalCDF(data.z2) * 10000) / 10000;
                    solutionHTML = `
                        <h4>üí° Solution: P(${data.z1} < Z < ${data.z2})</h4>
                        
                        <div class="solution-step">
                            <h5>Using Subtraction Rule</h5>
                            <div class="formula">P(${data.z1} < Z < ${data.z2}) = P(Z < ${data.z2}) - P(Z < ${data.z1})</div>
                            <div class="formula">P(Z < ${data.z2}) = ${prob2}</div>
                            <div class="formula">P(Z < ${data.z1}) = ${prob1}</div>
                            <div class="formula">P(${data.z1} < Z < ${data.z2}) = ${prob2} - ${prob1} = ${data.probability}</div>
                            <div class="result">Answer: ${data.probability}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Interpretation:</strong> There is a ${Math.round(data.probability * 10000)/100}% probability that a standard normal random variable falls between ${data.z1} and ${data.z2}.
                        </div>
                    `;

                } else if (data.type === 'inverse') {
                    solutionHTML = `
                        <h4>üí° Solution: ${data.percentile}th Percentile</h4>
                        
                        <div class="solution-step">
                            <h5>Finding z-score from probability</h5>
                            <div class="formula">Find z such that P(Z < z) = ${data.probability}</div>
                            <div class="formula">Using inverse normal table or calculator</div>
                            <div class="result">z = ${data.zScore}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Interpretation:</strong> ${data.percentile}% of the standard normal distribution falls below z = ${data.zScore}.
                        </div>
                    `;

                } else if (data.type.startsWith('application')) {
                    solutionHTML = this.formatApplicationSolution(data);

                } else if (data.type === 'comprehensive') {
                    solutionHTML = `
                        <h4>üéØ Comprehensive Normal Distribution Solution</h4>
                        
                        <div class="solution-step">
                            <h5>Given Information</h5>
                            <div class="formula">Œº = ${data.mean} ${data.unit}, œÉ = ${data.std} ${data.unit}</div>
                            <p>Strategy: Standardize using z = (X - Œº) / œÉ</p>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part A: P(X < ${data.value1})</h5>
                            <div class="formula">z = (${data.value1} - ${data.mean}) / ${data.std} = ${data.z1}</div>
                            <div class="formula">P(X < ${data.value1}) = P(Z < ${data.z1}) = ${data.probLess}</div>
                            <div class="result">Part A: ${data.probLess}</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part B: P(X > ${data.value2})</h5>
                            <div class="formula">z = (${data.value2} - ${data.mean}) / ${data.std} = ${data.z2}</div>
                            <div class="formula">P(X > ${data.value2}) = P(Z > ${data.z2}) = 1 - P(Z < ${data.z2}) = ${data.probGreater}</div>
                            <div class="result">Part B: ${data.probGreater}</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part C: P(${data.value1} < X < ${data.value2})</h5>
                            <div class="formula">P(${data.value1} < X < ${data.value2}) = P(${data.z1} < Z < ${data.z2})</div>
                            <div class="formula">= P(Z < ${data.z2}) - P(Z < ${data.z1}) = ${data.probBetween}</div>
                            <div class="result">Part C: ${data.probBetween}</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Part D: ${data.percentile}th Percentile</h5>
                            <div class="formula">Find z such that P(Z < z) = ${data.percentile/100}</div>
                            <div class="formula">z = ${data.percZ}</div>
                            <div class="formula">X = Œº + zœÉ = ${data.mean} + (${data.percZ})(${data.std}) = ${data.percValue}</div>
                            <div class="result">Part D: ${data.percValue} ${data.unit}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üéØ Summary:</strong> This analysis demonstrates how to work with normal distributions by standardizing to the standard normal distribution and then applying probability principles.
                        </div>
                    `;
                }
                
                document.getElementById('solution').innerHTML = solutionHTML;
                document.getElementById('solution').classList.remove('hidden');
            }

            formatApplicationSolution(data) {
                let solutionHTML = `
                    <h4>üåç Real-World Normal Distribution Solution</h4>
                    
                    <div class="solution-step">
                        <h5>Given Information</h5>
                        <div class="formula">Œº = ${data.mean} ${data.unit}, œÉ = ${data.std} ${data.unit}</div>
                        <p>Strategy: Standardize using z = (X - Œº) / œÉ</p>
                    </div>
                `;

                if (data.type === 'application_less_than') {
                    solutionHTML += `
                        <div class="solution-step">
                            <h5>Find: P(X < ${data.value} ${data.unit})</h5>
                            <div class="formula">Step 1: Standardize z = (${data.value} - ${data.mean}) / ${data.std} = ${data.zScore}</div>
                            <div class="formula">Step 2: P(X < ${data.value}) = P(Z < ${data.zScore}) = ${data.probability}</div>
                            <div class="result">Answer: ${data.probability}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üåç Interpretation:</strong> There is a ${Math.round(data.probability * 10000)/100}% probability that a randomly selected ${data.contextDescription.slice(0, -1)} measures less than ${data.value} ${data.unit}.
                        </div>
                    `;
                } else if (data.type === 'application_greater_than') {
                    solutionHTML += `
                        <div class="solution-step">
                            <h5>Find: P(X > ${data.value} ${data.unit})</h5>
                            <div class="formula">Step 1: Standardize z = (${data.value} - ${data.mean}) / ${data.std} = ${data.zScore}</div>
                            <div class="formula">Step 2: P(X > ${data.value}) = P(Z > ${data.zScore}) = 1 - P(Z < ${data.zScore}) = ${data.probability}</div>
                            <div class="result">Answer: ${data.probability}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üåç Interpretation:</strong> There is a ${Math.round(data.probability * 10000)/100}% probability that a randomly selected ${data.contextDescription.slice(0, -1)} measures more than ${data.value} ${data.unit}.
                        </div>
                    `;
                } else if (data.type === 'application_between') {
                    solutionHTML += `
                        <div class="solution-step">
                            <h5>Find: P(${data.value1} < X < ${data.value2} ${data.unit})</h5>
                            <div class="formula">Step 1: Standardize z‚ÇÅ = (${data.value1} - ${data.mean}) / ${data.std} = ${data.z1}</div>
                            <div class="formula">Step 2: Standardize z‚ÇÇ = (${data.value2} - ${data.mean}) / ${data.std} = ${data.z2}</div>
                            <div class="formula">Step 3: P(${data.value1} < X < ${data.value2}) = P(${data.z1} < Z < ${data.z2}) = ${data.probability}</div>
                            <div class="result">Answer: ${data.probability}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üåç Interpretation:</strong> There is a ${Math.round(data.probability * 10000)/100}% probability that a randomly selected ${data.contextDescription.slice(0, -1)} measures between ${data.value1} and ${data.value2} ${data.unit}.
                        </div>
                    `;
                } else if (data.type === 'application_percentile') {
                    solutionHTML += `
                        <div class="solution-step">
                            <h5>Find: ${data.percentile}th Percentile</h5>
                            <div class="formula">Step 1: Find z such that P(Z < z) = ${data.percentile/100}</div>
                            <div class="formula">Step 2: From inverse normal: z = ${data.zScore}</div>
                            <div class="formula">Step 3: Convert back X = Œº + zœÉ = ${data.mean} + (${data.zScore})(${data.std}) = ${data.value}</div>
                            <div class="result">Answer: ${data.value} ${data.unit}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üåç Interpretation:</strong> ${data.percentile}% of ${data.contextDescription} are below ${data.value} ${data.unit}.
                        </div>
                    `;
                }

                return solutionHTML;
            }

            checkSingleAnswer(answer, correctData) {
                const tolerance = correctData.type === 'inverse' || correctData.type === 'application_percentile' ? 0.01 : 0.001;
                const isCorrect = Math.abs(answer - correctData.answer) <= tolerance;
                
                return {
                    isCorrect,
                    correctAnswer: correctData.answer
                };
            }

            checkComprehensiveAnswers(answers, correctData) {
                const tolerance = 0.001; // 0.1% tolerance for probabilities
                const valueTolerance = 0.5; // 0.5 unit tolerance for values
                
                const results = {
                    probLess: Math.abs(answers.probLess - correctData.answers.probLess) <= tolerance,
                    probGreater: Math.abs(answers.probGreater - correctData.answers.probGreater) <= tolerance,
                    probBetween: Math.abs(answers.probBetween - correctData.answers.probBetween) <= tolerance,
                    percentileValue: Math.abs(answers.percentileValue - correctData.answers.percentileValue) <= valueTolerance
                };
                
                const correctCount = Object.values(results).filter(x => x).length;
                const allCorrect = correctCount === 4;
                
                return {
                    results,
                    correctCount,
                    allCorrect,
                    correctAnswers: correctData.answers
                };
            }
        }

        // Initialize simulator
        const simulator = new StandardNormalSimulator();

        function selectQuestionType(type) {
            simulator.questionType = type;
            
            // Update selector appearance
            document.querySelectorAll('.type-selector').forEach(el => el.classList.remove('active'));
            document.getElementById(type + '-selector').classList.add('active');
            
            generateNewQuestion();
        }

        function generateNewQuestion() {
            simulator.currentQuestion = simulator.generateQuestion();
            simulator.displayQuestion(simulator.currentQuestion);
            
            // Clear previous answers and feedback
            clearAnswers();
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('solution').classList.add('hidden');
            
            // Update question counter
            document.getElementById('question-counter').textContent = `Question ${simulator.questionCount} of ‚àû`;
            simulator.questionCount++;
        }

        function checkAnswers() {
            if (!simulator.currentQuestion) {
                alert('Please generate a question first!');
                return;
            }

            const feedback = document.getElementById('feedback');
            
            if (simulator.currentQuestion.type === 'comprehensive') {
                const answers = {
                    probLess: parseFloat(document.getElementById('prob-less-input').value),
                    probGreater: parseFloat(document.getElementById('prob-greater-input').value),
                    probBetween: parseFloat(document.getElementById('prob-between-input').value),
                    percentileValue: parseFloat(document.getElementById('percentile-input').value)
                };
                
                if (Object.values(answers).some(isNaN)) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '‚ö†Ô∏è Please enter valid numbers for all parts.';
                    feedback.classList.remove('hidden');
                    return;
                }
                
                const result = simulator.checkComprehensiveAnswers(answers, simulator.currentQuestion);
                
                // Update input styling
                document.getElementById('prob-less-input').className = result.results.probLess ? 'input-correct' : 'input-incorrect';
                document.getElementById('prob-greater-input').className = result.results.probGreater ? 'input-correct' : 'input-incorrect';
                document.getElementById('prob-between-input').className = result.results.probBetween ? 'input-correct' : 'input-incorrect';
                document.getElementById('percentile-input').className = result.results.percentileValue ? 'input-correct' : 'input-incorrect';
                
                feedback.classList.remove('hidden');
                
                if (result.allCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'üéâ Perfect! All four calculations are correct!<br>You have mastered normal distribution analysis.';
                } else if (result.correctCount >= 2) {
                    feedback.className = 'feedback partial';
                    feedback.innerHTML = `‚úÖ ${result.correctCount} out of 4 correct!<br>Check the highlighted fields and review the standardization process.`;
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚ùå Most answers need adjustment.<br>üí° Remember to standardize: z = (X - Œº) / œÉ`;
                }
            } else {
                const singleInput = parseFloat(document.getElementById('answer-input').value);
                
                if (isNaN(singleInput)) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '‚ö†Ô∏è Please enter a valid number.';
                    feedback.classList.remove('hidden');
                    return;
                }
                
                const result = simulator.checkSingleAnswer(singleInput, simulator.currentQuestion);
                
                // Update input styling
                document.getElementById('answer-input').className = result.isCorrect ? 'input-correct' : 'input-incorrect';
                
                feedback.classList.remove('hidden');
                
                if (result.isCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'üéâ Excellent! Your calculation is correct!';
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚ùå Not quite right. The correct answer is ${result.correctAnswer}.<br>üí° Review the calculation steps and try again.`;
                }
            }
        }

        function showSolution() {
            if (!simulator.currentQuestion) {
                alert('Please generate a question first!');
                return;
            }
            
            simulator.showSolution(simulator.currentQuestion);
        }

        function clearAnswers() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '';
                input.className = '';
            });
        }

        // Generate first question on page load
        window.onload = function() {
            generateNewQuestion();
        };
    </script>
</body>
</html>
