<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pearson Correlation Hypothesis Testing - Canadian Economics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2em;
        }
        
        .canada-header {
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .scenario-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 12px 18px;
            margin: 6px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }
        
        .scenario-btn.active {
            background-color: #007bff;
        }
        
        .hypothesis-section {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }
        
        .hypothesis-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #007bff;
        }
        
        .hypothesis-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
            font-size: 1.1em;
            font-family: monospace;
        }
        
        .data-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ffc107;
        }
        
        .contingency-table {
            background: white;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #007bff;
            overflow-x: auto;
        }
        
        .chi-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .chi-table th {
            background: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .chi-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .chi-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .observed-cell {
            background: #e8f5e8;
            font-weight: bold;
        }
        
        .expected-cell {
            background: #fff8e1;
            color: #856404;
        }
        
        .calculation-section {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #9c27b0;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 2fr 120px 70px 70px 90px;
            gap: 8px;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 0.9em;
        }
        
        .input-row label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-row input {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .input-row select {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .small-button {
            padding: 5px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
        }
        
        .check-btn {
            background: #17a2b8;
        }
        
        .answer-btn {
            background: #28a745;
        }
        
        .steps-btn {
            background: #6f42c1;
        }
        
        .button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 8px 4px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        
        .button:hover {
            background: #218838;
        }
        
        .correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        
        .incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }
        
        .step-instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .tutorial-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            display: none;
        }
        
        .tutorial-step {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .answer-display {
            background: #d4edda;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #c3e6cb;
            font-weight: bold;
            display: none;
            font-size: 0.9em;
        }
        
        .decision-section {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }
        
        .formula-box {
            background: #fff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 10px 0;
            font-family: monospace;
            text-align: center;
            font-size: 1em;
        }
        
        .expected-calc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .expected-cell-calc {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìà Pearson Correlation (r) Hypothesis Testing - Advanced</h1>
        
        <div class="canada-header">
            <h2>üá®üá¶ Canadian Economic Relationships</h2>
            <p><strong>Pearson's r</strong> ‚Ä¢ <strong>t-test for correlation</strong> ‚Ä¢ <strong>df = n ‚àí 2</strong> ‚Ä¢ <strong>Economic interpretation</strong></p>
        </div>
        
        <div class="scenario-selector">
            <div style="font-size: 1.2em; font-weight: bold; color: #2c3e50; margin-bottom: 15px;">
                üìä Choose Correlation Scenario:
            </div>
            
            <div style="margin-bottom: 10px; font-weight: bold; color: #007bff;">
                Positive Economic Relationships:
            </div>
            <button class="scenario-btn" onclick="chooseScenario('income-mortgage')">üè† Household Income vs Mortgage Debt</button>
            <button class="scenario-btn" onclick="chooseScenario('ad-spending-sales')">üì∫ Advertising Spending vs Sales</button>
            
            <div style="margin-top: 20px; margin-bottom: 10px; font-weight: bold; color: #dc3545;">
                Negative Economic Relationships:
            </div>
            <button class="scenario-btn" onclick="chooseScenario('interest-housing')">üìâ Interest Rates vs Housing Starts</button>
            <button class="scenario-btn" onclick="chooseScenario('unemployment-gdp')">üßë‚Äçüíº Unemployment Rate vs GDP Growth</button>
        </div>
        
        <div id="problemArea" style="display: none;">
            <div class="hypothesis-section">
                <h3>üìã Step 1: Correlation Hypotheses (Pearson's r)</h3>
                <div class="step-instructions">
                    <div id="scenarioDescription"></div>
                </div>
                
                <div class="hypothesis-display">
                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 15px;">üéØ Null and Alternative Hypotheses:</div>
                    <div class="hypothesis-box">
                        <div id="h0Display" style="margin: 8px 0; color: #dc3545;"><strong>H‚ÇÄ:</strong> Loading...</div>
                        <div id="h1Display" style="margin: 8px 0; color: #007bff;"><strong>H‚ÇÅ:</strong> Loading...</div>
                    </div>
                    <div style="margin-top: 15px;">
                        <strong>üßÆ Correlation Coefficient:</strong> r = Œ£[(x ‚àí xÃÑ)(y ‚àí »≥)] / ‚àö[Œ£(x ‚àí xÃÑ)¬≤ Œ£(y ‚àí »≥)¬≤]<br>
                        <strong>üìê Test Statistic:</strong> t = r‚àö(n ‚àí 2) / ‚àö(1 ‚àí r¬≤), with df = n ‚àí 2
                    </div>
                </div>
            </div>
            
            <div class="data-section">
                <h3>üìä Step 2: Sample Data (Paired Observations)</h3>
                <div class="step-instructions">
                    <strong>Observed paired data</strong> from the sample:
                </div>
                
                <div class="contingency-table" id="dataTable">
                    <!-- Filled dynamically -->
                </div>
                
                <div class="expected-calc-grid" id="summaryStats">
                    <!-- Filled dynamically with means and sums -->
                </div>
                
                <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0;">
                    <div style="font-weight: bold;">Sample Information:</div>
                    <div>Sample Size (n): <span id="sampleSize" style="color: #007bff; font-weight: bold;"></span></div>
                    <div>Significance Level (Œ±): <span style="color: #007bff; font-weight: bold;">0.05 (two-tailed)</span></div>
                </div>
            </div>
            
            <div class="calculation-section">
                <h3>üìê Step 3: Calculate Pearson's Correlation Coefficient (r)</h3>
                <div class="step-instructions">
                    <strong>Formula:</strong> r = Œ£[(x ‚àí xÃÑ)(y ‚àí »≥)] / ‚àö[Œ£(x ‚àí xÃÑ)¬≤ Œ£(y ‚àí »≥)¬≤]
                </div>
                
                <div class="formula-box">
                    r = Œ£[(x ‚àí xÃÑ)(y ‚àí »≥)] / ‚àö[Œ£(x ‚àí xÃÑ)¬≤ Œ£(y ‚àí »≥)¬≤]
                </div>
                
                <div class="input-row">
                    <label for="rCalc">Correlation Coefficient (r):</label>
                    <input type="number" id="rCalc" step="0.001" placeholder="Calculate r">
                    <button class="small-button check-btn" onclick="checkR()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('rCalc')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('r-calc')">Steps</button>
                </div>
                
                <div class="answer-display" id="rCalc-answer"></div>
                <div class="tutorial-box" id="r-calc-tutorial"></div>
            </div>
            
            <div class="calculation-section">
                <h3>üßÆ Step 4: Test of Significance for Correlation</h3>
                <div class="step-instructions">
                    <strong>We test whether the population correlation œÅ is zero:</strong><br>
                    H‚ÇÄ: œÅ = 0 (no linear relationship) ‚Ä¢ H‚ÇÅ: œÅ ‚â† 0 (linear relationship exists)
                </div>
                
                <div class="input-row">
                    <label for="degreesOfFreedomCalc">Degrees of Freedom (df):</label>
                    <input type="number" id="degreesOfFreedomCalc" step="1" placeholder="Calculate df">
                    <button class="small-button check-btn" onclick="checkDegreesOfFreedom()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('degreesOfFreedomCalc')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('degrees-freedom')">Steps</button>
                </div>
                
                <div class="answer-display" id="degreesOfFreedomCalc-answer"></div>
                <div class="tutorial-box" id="degrees-freedom-tutorial"></div>
                
                <div class="input-row">
                    <label for="tCalc">t Test Statistic:</label>
                    <input type="number" id="tCalc" step="0.01" placeholder="Calculate t">
                    <button class="small-button check-btn" onclick="checkT()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('tCalc')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('t-calc')">Steps</button>
                </div>
                
                <div class="answer-display" id="tCalc-answer"></div>
                <div class="tutorial-box" id="t-calc-tutorial"></div>
            </div>
            
            <div class="decision-section">
                <h3>‚öñÔ∏è Step 5: Decision and Economic Interpretation</h3>
                <div class="step-instructions">
                    <strong>Use three elements:</strong><br>
                    <strong>1. Critical Value:</strong> Compare |t| to t-critical (two-tailed)<br>
                    <strong>2. P-value:</strong> Compare p-value to Œ± = 0.05<br>
                    <strong>3. Interpretation:</strong> Translate into economic meaning
                </div>
                
                <div class="input-row">
                    <label for="tCritical">t-Critical (two-tailed, Œ± = 0.05):</label>
                    <input type="number" id="tCritical" step="0.01" placeholder="From t-table">
                    <button class="small-button check-btn" onclick="checkTCritical()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('tCritical')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('t-critical')">Steps</button>
                </div>
                
                <div class="answer-display" id="tCritical-answer"></div>
                <div class="tutorial-box" id="t-critical-tutorial"></div>
                
                <div class="input-row">
                    <label for="pValue">P-value (approximate):</label>
                    <input type="number" id="pValue" step="0.001" placeholder="Probability">
                    <button class="small-button check-btn" onclick="checkPValue()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('pValue')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('p-value')">Steps</button>
                </div>
                
                <div class="answer-display" id="pValue-answer"></div>
                <div class="tutorial-box" id="p-value-tutorial"></div>
                
                <div class="input-row">
                    <label>Statistical Decision:</label>
                    <select id="decision">
                        <option value="">Choose...</option>
                        <option value="reject">Reject H‚ÇÄ (Significant linear relationship)</option>
                        <option value="fail">Fail to Reject H‚ÇÄ (No significant linear relationship)</option>
                    </select>
                    <button class="small-button check-btn" onclick="checkDecision()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('decision')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('final-decision')">Steps</button>
                </div>
                
                <div class="answer-display" id="decision-answer"></div>
                <div class="tutorial-box" id="final-decision-tutorial"></div>
                
                <div class="input-row">
                    <label>Economic Interpretation:</label>
                    <select id="interpretation">
                        <option value="">Choose...</option>
                        <option value="positive">Positive relationship (as X‚Üë, Y‚Üë)</option>
                        <option value="negative">Negative relationship (as X‚Üë, Y‚Üì)</option>
                        <option value="no-relationship">No statistically significant relationship</option>
                    </select>
                    <button class="small-button check-btn" onclick="checkInterpretation()">Check</button>
                    <button class="small-button answer-btn" onclick="showAnswer('interpretation')">Answer</button>
                    <button class="small-button steps-btn" onclick="showSteps('economic-interpretation')">Steps</button>
                </div>
                
                <div class="answer-display" id="interpretation-answer"></div>
                <div class="tutorial-box" id="economic-interpretation-tutorial"></div>
            </div>
            
            <button class="button" onclick="generateNewProblem()">üé≤ Generate New Dataset</button>
            <button class="button" onclick="checkAllAnswers()">‚úÖ Check All Calculations</button>
            <button class="button" onclick="showCompleteAnalysis()">üìñ Complete Analysis</button>
        </div>
    </div>

    <script>
        let currentScenario = '';
        let testData = {};
        let correctAnswers = {};

        const scenarios = {
            'income-mortgage': {
                name: 'Household Income vs Mortgage Debt',
                description: 'Statistics Canada is examining whether higher-income Canadian households tend to have larger mortgage balances.',
                xName: 'Household Income (thousands of $)',
                yName: 'Mortgage Debt (thousands of $)',
                direction: 'positive',
                context: 'housing and debt policy',
                params: { xStart: 45, xStep: 5, xJitter: 4, intercept: -50, slope: 2.0, noise: 20, minAbsR: 0.50, maxAbsR: 0.90 }
            },
            'ad-spending-sales': {
                name: 'Advertising Spending vs Monthly Sales',
                description: 'A Canadian retail chain is studying whether higher advertising spending leads to higher monthly sales revenue.',
                xName: 'Advertising Spending (thousands of $)',
                yName: 'Monthly Sales (thousands of $)',
                direction: 'positive',
                context: 'marketing budget decisions',
                params: { xStart: 20, xStep: 3, xJitter: 2, intercept: 50, slope: 3.5, noise: 25, minAbsR: 0.45, maxAbsR: 0.90 }
            },
            'interest-housing': {
                name: 'Interest Rates vs Housing Starts',
                description: 'The Bank of Canada is investigating whether higher interest rates are associated with lower housing starts.',
                xName: 'Interest Rate (%)',
                yName: 'Housing Starts (thousands of units)',
                direction: 'negative',
                context: 'monetary policy and housing market',
                params: { xStart: 1.5, xStep: 0.3, xJitter: 0.15, intercept: 120, slope: -15, noise: 12, minAbsR: 0.45, maxAbsR: 0.90 }
            },
            'unemployment-gdp': {
                name: 'Unemployment Rate vs GDP Growth',
                description: 'Finance Canada is studying whether provinces with higher unemployment tend to have lower GDP growth.',
                xName: 'Unemployment Rate (%)',
                yName: 'Real GDP Growth (%)',
                direction: 'negative',
                context: 'labour market and growth policy',
                params: { xStart: 4.0, xStep: 0.6, xJitter: 0.25, intercept: 5.5, slope: -0.5, noise: 0.7, minAbsR: 0.40, maxAbsR: 0.85 }
            }
        };

        function chooseScenario(scenario) {
            currentScenario = scenario;
            
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (typeof event !== 'undefined') {
                event.target.classList.add('active');
            }
            
            generateTestData(scenario);
            document.getElementById('problemArea').style.display = 'block';
            clearAllInputs();
        }

        function generateTestData(scenarioKey) {
            const scenarioData = scenarios[scenarioKey];
            const params = scenarioData.params;
            
            let n = 12 + Math.floor(Math.random() * 6); // 12‚Äì17 observations
            let x = [];
            let y = [];
            let stats = null;
            let attempts = 0;
            
            // Try a few times until r matches desired strength and sign
            while (attempts < 30) {
                x = [];
                y = [];
                for (let i = 0; i < n; i++) {
                    const baseX = params.xStart + i * params.xStep;
                    const xi = baseX + (Math.random() - 0.5) * params.xJitter * 2;
                    const noise = (Math.random() - 0.5) * params.noise * 2;
                    const yi = params.intercept + params.slope * xi + noise;
                    x.push(xi);
                    y.push(yi);
                }
                
                stats = computeCorrelationStats(x, y);
                const r = stats.r;
                
                if (Math.abs(r) >= params.minAbsR && Math.abs(r) <= params.maxAbsR) {
                    if (scenarioData.direction === 'positive' && r > 0) break;
                    if (scenarioData.direction === 'negative' && r < 0) break;
                }
                
                attempts++;
            }
            
            testData = {
                scenario: scenarioData.name,
                description: scenarioData.description,
                xName: scenarioData.xName,
                yName: scenarioData.yName,
                direction: scenarioData.direction,
                context: scenarioData.context,
                x: x,
                y: y,
                n: x.length,
                alpha: 0.05,
                stats: stats
            };
            
            calculateCorrectAnswers();
            updateDisplay();
        }

        function computeCorrelationStats(x, y) {
            const n = x.length;
            let sumX = 0, sumY = 0;
            for (let i = 0; i < n; i++) {
                sumX += x[i];
                sumY += y[i];
            }
            const meanX = sumX / n;
            const meanY = sumY / n;
            
            let sumXX = 0, sumYY = 0, sumXY = 0;
            for (let i = 0; i < n; i++) {
                const dx = x[i] - meanX;
                const dy = y[i] - meanY;
                sumXX += dx * dx;
                sumYY += dy * dy;
                sumXY += dx * dy;
            }
            
            const r = sumXY / Math.sqrt(sumXX * sumYY);
            
            return {
                n,
                sumX, sumY,
                meanX, meanY,
                sumXX, sumYY,
                sumXY,
                r
            };
        }

        function calculateCorrectAnswers() {
            const s = testData.stats;
            const n = testData.n;
            const r = s.r;
            const df = n - 2;
            const t = r * Math.sqrt(df) / Math.sqrt(1 - r * r);
            
            // Approximate t-critical for alpha=0.05 two-tailed
            const tCritical = approximateTCritical(df);
            
            // Approximate p-value like you did for chi-square
            let pValue;
            const absT = Math.abs(t);
            if (absT > tCritical * 2.2) pValue = 0.001;
            else if (absT > tCritical * 1.6) pValue = 0.01;
            else if (absT > tCritical) pValue = 0.05;
            else if (absT > tCritical * 0.7) pValue = 0.10;
            else pValue = 0.20;
            
            const decision = absT > tCritical ? 'reject' : 'fail';
            let interpretation;
            if (decision === 'reject') {
                interpretation = r > 0 ? 'positive' : 'negative';
            } else {
                interpretation = 'no-relationship';
            }
            
            correctAnswers = {
                r,
                df,
                t,
                tCritical,
                pValue,
                decision,
                interpretation
            };
        }

        function approximateTCritical(df) {
            // Approximate t-critical (two-tailed, alpha=0.05)
            if (df <= 1) return 12.706;
            if (df === 2) return 4.303;
            if (df === 3) return 3.182;
            if (df === 4) return 2.776;
            if (df === 5) return 2.571;
            if (df === 6) return 2.447;
            if (df === 7) return 2.365;
            if (df === 8) return 2.306;
            if (df === 9) return 2.262;
            if (df === 10) return 2.228;
            if (df === 11) return 2.201;
            if (df === 12) return 2.179;
            if (df === 13) return 2.160;
            if (df === 14) return 2.145;
            if (df === 15) return 2.131;
            if (df === 16) return 2.120;
            if (df === 17) return 2.110;
            if (df === 18) return 2.101;
            if (df === 19) return 2.093;
            if (df === 20) return 2.086;
            if (df <= 30) return 2.042;
            if (df <= 40) return 2.021;
            if (df <= 60) return 2.000;
            return 1.96;
        }

        function updateDisplay() {
            document.getElementById('scenarioDescription').innerHTML = 
                `<strong>${testData.scenario}</strong><br>${testData.description}`;
            
            document.getElementById('h0Display').innerHTML = `<strong>H‚ÇÄ:</strong> œÅ = 0 (no linear relationship between ${testData.xName} and ${testData.yName})`;
            document.getElementById('h1Display').innerHTML = `<strong>H‚ÇÅ:</strong> œÅ ‚â† 0 (there is a linear relationship between ${testData.xName} and ${testData.yName})`;
            
            document.getElementById('sampleSize').textContent = testData.n;
            
            updateDataTable();
            updateSummaryStats();
        }

        function updateDataTable() {
            const container = document.getElementById('dataTable');
            const { x, y, xName, yName } = testData;
            let html = `
                <table class="chi-table">
                    <thead>
                        <tr>
                            <th>Observation</th>
                            <th>${xName}</th>
                            <th>${yName}</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            for (let i = 0; i < x.length; i++) {
                html += `
                    <tr>
                        <td>${i + 1}</td>
                        <td class="observed-cell">${x[i].toFixed(2)}</td>
                        <td class="observed-cell">${y[i].toFixed(2)}</td>
                    </tr>
                `;
            }
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        function updateSummaryStats() {
            const container = document.getElementById('summaryStats');
            const s = testData.stats;
            const r = correctAnswers.r;
            
            const sx = s.sumX.toFixed(2);
            const sy = s.sumY.toFixed(2);
            const mx = s.meanX.toFixed(2);
            const my = s.meanY.toFixed(2);
            const sxx = s.sumXX.toFixed(2);
            const syy = s.sumYY.toFixed(2);
            const sxy = s.sumXY.toFixed(2);
            
            container.innerHTML = `
                <div class="expected-cell-calc">
                    <strong>Summaries for ${testData.xName} (X):</strong><br>
                    Œ£X = ${sx}<br>
                    XÃÑ = ${mx}<br>
                    Œ£(X ‚àí XÃÑ)¬≤ = ${sxx}
                </div>
                <div class="expected-cell-calc">
                    <strong>Summaries for ${testData.yName} (Y):</strong><br>
                    Œ£Y = ${sy}<br>
                    »≤ = ${my}<br>
                    Œ£(Y ‚àí »≤)¬≤ = ${syy}
                </div>
                <div class="expected-cell-calc">
                    <strong>Cross-product term:</strong><br>
                    Œ£(X ‚àí XÃÑ)(Y ‚àí »≤) = ${sxy}<br><br>
                    <strong>Correlation:</strong><br>
                    r = Œ£[(x ‚àí xÃÑ)(y ‚àí »≥)] / ‚àö[Œ£(x ‚àí xÃÑ)¬≤ Œ£(y ‚àí »≥)¬≤] = ${r.toFixed(3)}
                </div>
            `;
        }

        function checkAnswer(inputId, correctValue, tolerance = 0.1) {
            const input = document.getElementById(inputId);
            const userAnswer = parseFloat(input.value);
            
            if (isNaN(userAnswer)) {
                input.className = '';
                return false;
            }
            
            const isCorrect = Math.abs(userAnswer - correctValue) <= tolerance;
            input.className = isCorrect ? 'correct' : 'incorrect';
            return isCorrect;
        }

        function checkR() {
            return checkAnswer('rCalc', correctAnswers.r, 0.03);
        }

        function checkDegreesOfFreedom() {
            return checkAnswer('degreesOfFreedomCalc', correctAnswers.df, 0);
        }

        function checkT() {
            return checkAnswer('tCalc', correctAnswers.t, 0.2);
        }

        function checkTCritical() {
            return checkAnswer('tCritical', correctAnswers.tCritical, 0.05);
        }

        function checkPValue() {
            return checkAnswer('pValue', correctAnswers.pValue, 0.02);
        }

        function checkDecision() {
            const select = document.getElementById('decision');
            const userAnswer = select.value;
            const isCorrect = userAnswer === correctAnswers.decision;
            select.style.backgroundColor = isCorrect ? '#d4edda' : '#f8d7da';
            select.style.borderColor = isCorrect ? '#c3e6cb' : '#f5c6cb';
            return isCorrect;
        }

        function checkInterpretation() {
            const select = document.getElementById('interpretation');
            const userAnswer = select.value;
            const isCorrect = userAnswer === correctAnswers.interpretation;
            select.style.backgroundColor = isCorrect ? '#d4edda' : '#f8d7da';
            select.style.borderColor = isCorrect ? '#c3e6cb' : '#f5c6cb';
            return isCorrect;
        }

        function showAnswer(inputId) {
            const answerDiv = document.getElementById(inputId + '-answer');
            
            switch(inputId) {
                case 'rCalc':
                    answerDiv.innerHTML = `‚úÖ r = ${correctAnswers.r.toFixed(3)}`;
                    break;
                case 'degreesOfFreedomCalc':
                    answerDiv.innerHTML = `‚úÖ df = n ‚àí 2 = ${correctAnswers.df}`;
                    break;
                case 'tCalc':
                    answerDiv.innerHTML = `‚úÖ t = ${correctAnswers.t.toFixed(2)}`;
                    break;
                case 'tCritical':
                    answerDiv.innerHTML = `‚úÖ t-critical ‚âà ¬±${correctAnswers.tCritical.toFixed(3)} (two-tailed)`;
                    break;
                case 'pValue':
                    answerDiv.innerHTML = `‚úÖ P-value ‚âà ${correctAnswers.pValue.toFixed(3)}`;
                    break;
                case 'decision':
                    const decisionText = correctAnswers.decision === 'reject' ? 
                        'Reject H‚ÇÄ (significant linear relationship)' : 
                        'Fail to Reject H‚ÇÄ (no significant linear relationship)';
                    answerDiv.innerHTML = `‚úÖ ${decisionText}`;
                    break;
                case 'interpretation':
                    let interpText;
                    if (correctAnswers.interpretation === 'positive') {
                        interpText = 'Positive relationship (as X increases, Y tends to increase)';
                    } else if (correctAnswers.interpretation === 'negative') {
                        interpText = 'Negative relationship (as X increases, Y tends to decrease)';
                    } else {
                        interpText = 'No statistically significant relationship';
                    }
                    answerDiv.innerHTML = `‚úÖ ${interpText}`;
                    break;
            }
            
            answerDiv.style.display = 'block';
        }

        function showSteps(stepType) {
            const tutorialDiv = document.getElementById(stepType + '-tutorial');
            
            if (stepType === 'r-calc') {
                showRSteps(tutorialDiv);
            } else if (stepType === 't-calc') {
                showTSteps(tutorialDiv);
            } else if (stepType === 'degrees-freedom') {
                showDegreesSteps(tutorialDiv);
            } else if (stepType === 't-critical') {
                showTCriticalSteps(tutorialDiv);
            } else if (stepType === 'final-decision') {
                showFinalDecisionSteps(tutorialDiv);
            } else if (stepType === 'economic-interpretation') {
                showEconomicInterpretationSteps(tutorialDiv);
            } else if (stepType === 'p-value') {
                showPSteps(tutorialDiv);
            }
            
            tutorialDiv.style.display = tutorialDiv.style.display === 'none' ? 'block' : 'none';
        }

        function showRSteps(tutorialDiv) {
            const s = testData.stats;
            tutorialDiv.innerHTML = `
                <h4>üìö How to Calculate Pearson's r:</h4>
                <div class="tutorial-step">
                    <strong>1. Compute means:</strong><br>
                    XÃÑ = Œ£X / n = ${s.sumX.toFixed(2)} / ${s.n} = ${s.meanX.toFixed(2)}<br>
                    »≤ = Œ£Y / n = ${s.sumY.toFixed(2)} / ${s.n} = ${s.meanY.toFixed(2)}<br><br>
                    <strong>2. For each pair (x, y):</strong><br>
                    ‚Ä¢ Compute (x ‚àí XÃÑ), (y ‚àí »≤)<br>
                    ‚Ä¢ Compute (x ‚àí XÃÑ)¬≤, (y ‚àí »≤)¬≤, and (x ‚àí XÃÑ)(y ‚àí »≤)<br><br>
                    <strong>3. Sum the columns:</strong><br>
                    Œ£(X ‚àí XÃÑ)¬≤ = ${s.sumXX.toFixed(2)}<br>
                    Œ£(Y ‚àí »≤)¬≤ = ${s.sumYY.toFixed(2)}<br>
                    Œ£(X ‚àí XÃÑ)(Y ‚àí »≤) = ${s.sumXY.toFixed(2)}<br><br>
                    <strong>4. Apply the formula:</strong><br>
                    r = Œ£[(x ‚àí xÃÑ)(y ‚àí »≥)] / ‚àö[Œ£(x ‚àí xÃÑ)¬≤ Œ£(y ‚àí »≥)¬≤]<br>
                    r = ${s.sumXY.toFixed(2)} / ‚àö(${s.sumXX.toFixed(2)} √ó ${s.sumYY.toFixed(2)})<br>
                    r = ${correctAnswers.r.toFixed(3)}<br><br>
                    <strong>Interpretation:</strong> r measures the strength and direction of the <em>linear</em> relationship between the two variables.
                </div>
            `;
        }

        function showTSteps(tutorialDiv) {
            tutorialDiv.innerHTML = `
                <h4>üìö How to Calculate the t Test Statistic for r:</h4>
                <div class="tutorial-step">
                    <strong>1. Start with r:</strong><br>
                    r = ${correctAnswers.r.toFixed(3)}<br><br>
                    <strong>2. Degrees of freedom:</strong><br>
                    df = n ‚àí 2 = ${testData.n} ‚àí 2 = ${correctAnswers.df}<br><br>
                    <strong>3. Use the formula:</strong><br>
                    t = r‚àö(n ‚àí 2) / ‚àö(1 ‚àí r¬≤)<br><br>
                    <strong>Substitute values:</strong><br>
                    t = ${correctAnswers.r.toFixed(3)} √ó ‚àö(${correctAnswers.df}) / ‚àö(1 ‚àí ${correctAnswers.r.toFixed(3)}¬≤)<br>
                    t = ${correctAnswers.t.toFixed(2)} (approx.)<br><br>
                    <strong>Note:</strong> We then compare |t| to the critical t-value from the t-table.
                </div>
            `;
        }

        function showDegreesSteps(tutorialDiv) {
            tutorialDiv.innerHTML = `
                <h4>üìö Degrees of Freedom for Correlation:</h4>
                <div class="tutorial-step">
                    <strong>Formula:</strong> df = n ‚àí 2<br><br>
                    <strong>Our Data:</strong><br>
                    n = number of paired observations = ${testData.n}<br><br>
                    <strong>Calculation:</strong><br>
                    df = ${testData.n} ‚àí 2 = ${correctAnswers.df}<br><br>
                    <strong>Meaning:</strong> We lose two degrees of freedom because we estimated two means (XÃÑ and »≤) from the sample.
                </div>
            `;
        }

        function showTCriticalSteps(tutorialDiv) {
            tutorialDiv.innerHTML = `
                <h4>üìö How to Find the Critical t-value:</h4>
                <div class="tutorial-step">
                    <strong>Parameters:</strong><br>
                    Œ± = 0.05 (two-tailed)<br>
                    df = ${correctAnswers.df}<br><br>
                    <strong>From the t-table:</strong><br>
                    t<sub>Œ±/2, df</sub> ‚âà ¬±${correctAnswers.tCritical.toFixed(3)}<br><br>
                    <strong>Decision Rule (two-tailed):</strong><br>
                    If |t| > ${correctAnswers.tCritical.toFixed(3)} ‚Üí Reject H‚ÇÄ<br>
                    If |t| ‚â§ ${correctAnswers.tCritical.toFixed(3)} ‚Üí Fail to Reject H‚ÇÄ
                </div>
            `;
        }

        function showPSteps(tutorialDiv) {
            tutorialDiv.innerHTML = `
                <h4>üìö P-value for the Correlation Test:</h4>
                <div class="tutorial-step">
                    <strong>Test statistic:</strong> t = ${correctAnswers.t.toFixed(2)}<br>
                    <strong>df:</strong> ${correctAnswers.df}<br><br>
                    <strong>Using a t-table or software:</strong><br>
                    ‚Ä¢ Find the probability of getting a |t| at least as large as ${correctAnswers.t.toFixed(2)} with df = ${correctAnswers.df} under H‚ÇÄ.<br>
                    ‚Ä¢ Because this is a <em>two-tailed</em> test, p-value = 2 √ó P(T ‚â• |t|).<br><br>
                    <strong>Approximate result used here:</strong><br>
                    p ‚âà ${correctAnswers.pValue.toFixed(3)}<br><br>
                    <strong>Decision based on p:</strong><br>
                    If p ‚â§ 0.05 ‚Üí Reject H‚ÇÄ<br>
                    If p > 0.05 ‚Üí Fail to Reject H‚ÇÄ
                </div>
            `;
        }

        function showFinalDecisionSteps(tutorialDiv) {
            const absT = Math.abs(correctAnswers.t).toFixed(2);
            const tCrit = correctAnswers.tCritical.toFixed(2);
            const reject = correctAnswers.decision === 'reject';
            tutorialDiv.innerHTML = `
                <h4>üìö Final Statistical Decision:</h4>
                <div class="tutorial-step">
                    <strong>Method 1 (Critical Value):</strong><br>
                    |t| = ${absT} ${reject ? '>' : '‚â§'} t-critical = ${tCrit}<br>
                    Decision: ${reject ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}<br><br>
                    <strong>Method 2 (P-value):</strong><br>
                    p ‚âà ${correctAnswers.pValue.toFixed(3)} ${reject ? '‚â§' : '>'} Œ± = 0.05<br>
                    Decision: ${reject ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ'}<br><br>
                    <strong>Conclusion:</strong><br>
                    There is ${reject ? '' : 'not '}enough evidence to conclude that a linear relationship exists between ${testData.xName} and ${testData.yName} in the population.
                </div>
            `;
        }

        function showEconomicInterpretationSteps(tutorialDiv) {
            let meaning;
            if (correctAnswers.decision === 'reject') {
                if (correctAnswers.interpretation === 'positive') {
                    meaning = `Higher values of ${testData.xName} are associated with higher values of ${testData.yName}.`;
                } else {
                    meaning = `Higher values of ${testData.xName} are associated with lower values of ${testData.yName}.`;
                }
            } else {
                meaning = `Any apparent pattern in the sample could be due to random variation; we do not detect a statistically significant linear relationship.`;
            }
            
            tutorialDiv.innerHTML = `
                <h4>üìö Economic Interpretation:</h4>
                <div class="tutorial-step">
                    <strong>Statistical result:</strong><br>
                    ${correctAnswers.decision === 'reject' ? 'Significant' : 'No significant'} correlation (r = ${correctAnswers.r.toFixed(3)}, t = ${correctAnswers.t.toFixed(2)}, p ‚âà ${correctAnswers.pValue.toFixed(3)})<br><br>
                    <strong>Economic meaning in context of ${testData.context}:</strong><br>
                    ${meaning}<br><br>
                    <strong>Policy implications:</strong><br>
                    ${correctAnswers.decision === 'reject' 
                        ? 'Policy makers might consider this relationship when designing economic policy (e.g., targeting variables that strongly predict outcomes).'
                        : 'Policy decisions should be cautious about assuming a strong linear link between these variables based on this sample.'}
                </div>
            `;
        }

        function checkAllAnswers() {
            const results = [
                checkR(),
                checkDegreesOfFreedom(),
                checkT(),
                checkTCritical(),
                checkPValue(),
                checkDecision(),
                checkInterpretation()
            ];
            
            const correct = results.filter(r => r).length;
            const total = results.length;
            
            alert(`You got ${correct}/${total} calculations correct!\n\n${correct === total ? 'Perfect correlation analysis! üéâ' : 'Review the incorrect calculations using the Steps buttons.'}`);
        }

        function generateNewProblem() {
            if (currentScenario) {
                generateTestData(currentScenario);
                clearAllInputs();
            } else {
                alert('Please select a scenario first.');
            }
        }

        function clearAllInputs() {
            const inputs = ['rCalc', 'degreesOfFreedomCalc', 'tCalc', 'tCritical', 'pValue'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = '';
                    input.className = '';
                }
                
                const answerDiv = document.getElementById(id + '-answer');
                if (answerDiv) answerDiv.style.display = 'none';
            });
            
            const selects = ['decision', 'interpretation'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.value = '';
                    select.style.backgroundColor = '';
                    select.style.borderColor = '';
                }
            });
        }

        function showCompleteAnalysis() {
            if (!currentScenario) {
                alert('Please select a scenario first.');
                return;
            }
            
            const s = testData.stats;
            const directionWord = correctAnswers.interpretation === 'positive' ? 'positive' :
                                  correctAnswers.interpretation === 'negative' ? 'negative' :
                                  'no clear';
            const decisionText = correctAnswers.decision === 'reject' ? 'Reject H‚ÇÄ' : 'Fail to Reject H‚ÇÄ';
            
            alert(
`Complete Correlation Analysis:

Scenario: ${testData.scenario}

Hypotheses:
H‚ÇÄ: œÅ = 0 (no linear relationship between ${testData.xName} and ${testData.yName})
H‚ÇÅ: œÅ ‚â† 0 (linear relationship exists between ${testData.xName} and ${testData.yName})

Sample summaries:
n = ${testData.n}
Œ£X = ${s.sumX.toFixed(2)}, XÃÑ = ${s.meanX.toFixed(2)}
Œ£Y = ${s.sumY.toFixed(2)}, »≤ = ${s.meanY.toFixed(2)}
Œ£(X ‚àí XÃÑ)¬≤ = ${s.sumXX.toFixed(2)}
Œ£(Y ‚àí »≤)¬≤ = ${s.sumYY.toFixed(2)}
Œ£(X ‚àí XÃÑ)(Y ‚àí »≤) = ${s.sumXY.toFixed(2)}

Correlation:
r = ${correctAnswers.r.toFixed(3)}

Test statistics:
df = n ‚àí 2 = ${correctAnswers.df}
t = ${correctAnswers.t.toFixed(2)}
t-critical (two-tailed, Œ± = 0.05) ‚âà ¬±${correctAnswers.tCritical.toFixed(3)}
p-value ‚âà ${correctAnswers.pValue.toFixed(3)}

Decision: ${decisionText}

Interpretation:
Direction: ${directionWord} relationship.
Context: ${testData.context}.`
            );
        }
    </script>
</body>
</html>
