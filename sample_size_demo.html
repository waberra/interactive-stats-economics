<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Size Determination Calculator - Interactive Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .type-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .type-mean {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .type-proportion {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .type-comprehensive {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
        }
        
        .question-text {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            padding: 25px;
            border-left: 5px solid #3498db;
            margin-bottom: 25px;
            line-height: 1.6;
            border-radius: 0 10px 10px 0;
        }
        
        .question-text h3 {
            margin-top: 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .context-box {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #dee2e6;
        }
        
        .context-box .context-header {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .parameters {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .parameter {
            background: white;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .parameter-label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .parameter-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
        }
        
        .scenario-info {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 12px 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #f39c12;
            font-weight: bold;
            color: #856404;
            text-align: center;
        }
        
        .stats-highlight {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            color: #155724;
        }
        
        .answer-section {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .input-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .input-group label {
            display: inline-block;
            min-width: 200px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 150px;
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .input-correct {
            border-color: #27ae60 !important;
            background-color: #d4edda !important;
        }
        
        .input-incorrect {
            border-color: #e74c3c !important;
            background-color: #f8d7da !important;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #7f8c8d, #6c7b7d);
        }
        
        .btn-generate {
            background: linear-gradient(135deg, #27ae60, #229954);
        }
        
        .btn-generate:hover {
            background: linear-gradient(135deg, #229954, #1e8449);
        }
        
        .feedback {
            padding: 18px;
            margin: 20px 0;
            border-radius: 10px;
            font-weight: bold;
            border-left: 5px solid;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-left-color: #27ae60;
        }
        
        .feedback.partial {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-left-color: #f39c12;
        }
        
        .feedback.incorrect {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-left-color: #e74c3c;
        }
        
        .solution {
            background: linear-gradient(135deg, #eaf2f8, #d6eaf8);
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        
        .solution h4 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .solution-step {
            background-color: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #d6eaf8;
        }
        
        .solution-step h5 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        .formula {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            display: block;
            margin: 5px 0;
            border: 1px solid #dee2e6;
            font-size: 1.1em;
        }
        
        .result {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            background: linear-gradient(135deg, #d6eaf8, #aed6f1);
            padding: 10px 15px;
            border-radius: 5px;
            display: inline-block;
            margin: 8px 0;
        }
        
        .interpretation-box {
            background: linear-gradient(135deg, #e8f5e8, #d4f1d4);
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #155724;
        }
        
        .hidden {
            display: none;
        }
        
        .navigation {
            text-align: center;
            margin: 30px 0;
        }
        
        .question-counter {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 10px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .question-types {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .type-selector {
            background: linear-gradient(135deg, #ecf0f1, #bdc3c7);
            border: 2px solid #95a5a6;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .type-selector.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #764ba2;
        }
        
        .type-selector:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .comprehensive-answers {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .part-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .part-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <h1>üìä Sample Size Determination Calculator</h1>
    
    <div class="container">
        <div class="navigation">
            <div class="question-counter" id="question-counter">Question 1 of ‚àû</div>
            
            <div class="question-types">
                <div class="type-selector active" id="mean-selector" onclick="selectQuestionType('mean')">
                    üìä Population Mean
                </div>
                <div class="type-selector" id="proportion-selector" onclick="selectQuestionType('proportion')">
                    üìà Population Proportion
                </div>
                <div class="type-selector" id="comprehensive-selector" onclick="selectQuestionType('comprehensive')">
                    üéØ Comprehensive Analysis
                </div>
                <div class="type-selector" id="random-selector" onclick="selectQuestionType('random')">
                    üé≤ Random Mix
                </div>
            </div>
            
            <button class="btn btn-generate" onclick="generateNewQuestion()">Generate New Study</button>
        </div>
        
        <div id="question-container"></div>
        
        <div class="answer-section">
            <div id="answer-inputs"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="checkAnswers()">‚úì Check Sample Size</button>
                <button class="btn btn-secondary" onclick="showSolution()">üí° Show Solution</button>
                <button class="btn btn-secondary" onclick="clearAnswers()">üóëÔ∏è Clear</button>
            </div>
        </div>

        <div id="feedback" class="feedback hidden"></div>
        
        <div id="solution" class="solution hidden"></div>
    </div>

    <script>
        // Include the SampleSizeSimulator class
        class SampleSizeSimulator {
            constructor() {
                // Critical z-values for different confidence levels
                this.zValues = {
                    90: 1.645,
                    95: 1.960,
                    99: 2.576
                };

                // Sample contexts for different scenarios
                this.contexts = {
                    manufacturing: {
                        description: 'manufacturing quality control',
                        units: ['grams', 'millimeters', 'seconds', 'pounds', 'centimeters'],
                        items: ['widgets', 'components', 'parts', 'products', 'items'],
                        sigmaRange: [0.5, 15.0],
                        marginRange: [0.1, 3.0]
                    },
                    medical: {
                        description: 'medical research study',
                        units: ['mg/dL', 'mmHg', 'hours', 'days', 'minutes'],
                        items: ['patients', 'subjects', 'participants', 'individuals', 'cases'],
                        sigmaRange: [2.0, 25.0],
                        marginRange: [0.5, 5.0]
                    },
                    academic: {
                        description: 'educational research',
                        units: ['points', 'hours', 'minutes', 'scores', 'percentages'],
                        items: ['students', 'participants', 'subjects', 'individuals', 'respondents'],
                        sigmaRange: [1.0, 20.0],
                        marginRange: [0.2, 4.0]
                    },
                    market_research: {
                        description: 'market research survey',
                        units: ['dollars', 'hours', 'minutes', 'points', 'units'],
                        items: ['consumers', 'customers', 'respondents', 'participants', 'individuals'],
                        sigmaRange: [0.8, 12.0],
                        marginRange: [0.1, 2.5]
                    },
                    environmental: {
                        description: 'environmental monitoring',
                        units: ['ppm', 'mg/L', 'degrees C', 'pH units', 'meters'],
                        items: ['samples', 'measurements', 'locations', 'sites', 'readings'],
                        sigmaRange: [0.3, 8.0],
                        marginRange: [0.05, 1.5]
                    }
                };

                // Proportion contexts
                this.proportionContexts = {
                    political: {
                        description: 'political polling',
                        context: 'election survey',
                        characteristic: ['support candidate A', 'approve of policy', 'favor proposal', 'plan to vote'],
                        marginRange: [0.01, 0.05]
                    },
                    medical: {
                        description: 'medical research',
                        context: 'clinical study',
                        characteristic: ['respond to treatment', 'experience side effects', 'show improvement', 'meet criteria'],
                        marginRange: [0.02, 0.08]
                    },
                    quality: {
                        description: 'quality control',
                        context: 'production survey',
                        characteristic: ['meet specifications', 'pass inspection', 'are defective', 'require rework'],
                        marginRange: [0.005, 0.03]
                    },
                    market: {
                        description: 'market research',
                        context: 'consumer survey',
                        characteristic: ['prefer brand A', 'plan to purchase', 'are satisfied', 'recommend product'],
                        marginRange: [0.02, 0.06]
                    }
                };

                this.currentQuestion = null;
                this.currentSolution = null;
                this.questionCount = 1;
                this.questionType = 'mean';
            }

            randomBetween(min, max, decimals = 2) {
                const factor = Math.pow(10, decimals);
                return Math.round((Math.random() * (max - min) + min) * factor) / factor;
            }

            generateMeanSampleSizeQuestion() {
                const contextKeys = Object.keys(this.contexts);
                const contextKey = contextKeys[Math.floor(Math.random() * contextKeys.length)];
                const context = this.contexts[contextKey];

                const confidenceLevels = [90, 95, 99];
                const confidence = confidenceLevels[Math.floor(Math.random() * confidenceLevels.length)];
                const zCritical = this.zValues[confidence];

                const sigma = this.randomBetween(context.sigmaRange[0], context.sigmaRange[1]);
                const marginError = this.randomBetween(context.marginRange[0], context.marginRange[1]);

                const nExact = Math.pow((zCritical * sigma) / marginError, 2);
                const nRequired = Math.ceil(nExact);

                const unit = context.units[Math.floor(Math.random() * context.units.length)];
                const item = context.items[Math.floor(Math.random() * context.items.length)];

                return {
                    type: 'mean_sample_size',
                    contextType: contextKey,
                    contextDescription: context.description,
                    confidence,
                    zCritical,
                    sigma,
                    marginError,
                    unit,
                    item,
                    nExact: Math.round(nExact * 100) / 100,
                    nRequired
                };
            }

            generateProportionSampleSizeQuestion() {
                const contextKeys = Object.keys(this.proportionContexts);
                const contextKey = contextKeys[Math.floor(Math.random() * contextKeys.length)];
                const context = this.proportionContexts[contextKey];

                const confidenceLevels = [90, 95, 99];
                const confidence = confidenceLevels[Math.floor(Math.random() * confidenceLevels.length)];
                const zCritical = this.zValues[confidence];

                const marginError = this.randomBetween(context.marginRange[0], context.marginRange[1], 3);

                const usePrior = Math.random() < 0.5;
                let pEstimate, pComplement, scenario;
                if (usePrior) {
                    pEstimate = this.randomBetween(0.20, 0.80);
                    pComplement = Math.round((1 - pEstimate) * 100) / 100;
                    scenario = 'prior_estimate';
                } else {
                    pEstimate = 0.5;
                    pComplement = 0.5;
                    scenario = 'worst_case';
                }

                const nExact = (Math.pow(zCritical, 2) * pEstimate * pComplement) / Math.pow(marginError, 2);
                const nRequired = Math.ceil(nExact);

                const characteristic = context.characteristic[Math.floor(Math.random() * context.characteristic.length)];

                return {
                    type: 'proportion_sample_size',
                    contextType: contextKey,
                    contextDescription: context.description,
                    contextName: context.context,
                    confidence,
                    zCritical,
                    marginError,
                    pEstimate,
                    pComplement,
                    scenario,
                    characteristic,
                    nExact: Math.round(nExact * 100) / 100,
                    nRequired
                };
            }

            generateComprehensiveQuestion() {
                const meanQ = this.generateMeanSampleSizeQuestion();
                const propQ = this.generateProportionSampleSizeQuestion();

                return {
                    type: 'comprehensive_sample_size',
                    meanQuestion: meanQ,
                    proportionQuestion: propQ
                };
            }

            generateQuestion() {
                if (this.questionType === 'mean') {
                    return this.generateMeanSampleSizeQuestion();
                } else if (this.questionType === 'proportion') {
                    return this.generateProportionSampleSizeQuestion();
                } else if (this.questionType === 'comprehensive') {
                    return this.generateComprehensiveQuestion();
                } else {
                    const types = ['mean', 'proportion'];
                    const selectedType = types[Math.floor(Math.random() * types.length)];
                    return selectedType === 'mean' ? this.generateMeanSampleSizeQuestion() : this.generateProportionSampleSizeQuestion();
                }
            }

            displayQuestion(data) {
                let typeClass, typeText, questionHTML;

                if (data.type === 'mean_sample_size') {
                    typeClass = 'type-mean';
                    typeText = 'üìä Sample Size for Population Mean';
                    
                    questionHTML = `
                        <div class="type-indicator ${typeClass}">${typeText}</div>
                        <div class="question-text">
                            <h3>Population Standard Deviation Known</h3>
                            <p>A researcher wants to estimate the population mean for a <span class="stats-highlight">${data.contextDescription}</span>.</p>
                            
                            <div class="context-box">
                                <div class="context-header">Study Parameters</div>
                                <div class="parameters">
                                    <div class="parameter">
                                        <span class="parameter-label">Desired confidence level:</span>
                                        <span class="parameter-value">${data.confidence}%</span>
                                    </div>
                                    <div class="parameter">
                                        <span class="parameter-label">Desired margin of error:</span>
                                        <span class="parameter-value">${data.marginError} ${data.unit}</span>
                                    </div>
                                    <div class="parameter">
                                        <span class="parameter-label">Population standard deviation:</span>
                                        <span class="parameter-value">${data.sigma} ${data.unit} (known)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="scenario-info">
                                üéØ What is the minimum sample size of ${data.item} required?
                            </div>
                            
                            <p><strong>Calculate the minimum sample size needed to achieve this precision.</strong></p>
                            <p><em>(Round up to the nearest whole number)</em></p>
                        </div>
                    `;
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="input-group">
                            <label>Minimum sample size:</label>
                            <input type="number" id="sample-size-input" step="1" placeholder="0" min="1">
                            <span style="font-weight: bold;">${data.item}</span>
                        </div>
                    `;

                } else if (data.type === 'proportion_sample_size') {
                    typeClass = 'type-proportion';
                    typeText = 'üìà Sample Size for Population Proportion';
                    
                    const priorInfo = data.scenario === 'prior_estimate' 
                        ? `Previous studies suggest that approximately ${data.pEstimate} of the population will ${data.characteristic}.`
                        : `No prior information is available about the population proportion.`;

                    questionHTML = `
                        <div class="type-indicator ${typeClass}">${typeText}</div>
                        <div class="question-text">
                            <h3>Large Sample Proportion Estimation</h3>
                            <p>A researcher wants to estimate the population proportion for a <span class="stats-highlight">${data.contextDescription}</span>.</p>
                            <p><strong>Study objective:</strong> Determine what proportion of the population will <span class="stats-highlight">${data.characteristic}</span>.</p>
                            
                            <div class="context-box">
                                <div class="context-header">Study Parameters</div>
                                <div class="parameters">
                                    <div class="parameter">
                                        <span class="parameter-label">Desired confidence level:</span>
                                        <span class="parameter-value">${data.confidence}%</span>
                                    </div>
                                    <div class="parameter">
                                        <span class="parameter-label">Desired margin of error:</span>
                                        <span class="parameter-value">${data.marginError}</span>
                                    </div>
                                    <div class="parameter">
                                        <span class="parameter-label">Prior information:</span>
                                        <span class="parameter-value">${priorInfo}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="scenario-info">
                                üéØ What is the minimum sample size required?
                            </div>
                            
                            <p><strong>Calculate the minimum sample size needed to achieve this precision.</strong></p>
                            <p><em>(Round up to the nearest whole number)</em></p>
                        </div>
                    `;
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="input-group">
                            <label>Minimum sample size:</label>
                            <input type="number" id="sample-size-input" step="1" placeholder="0" min="1">
                            <span style="font-weight: bold;">participants</span>
                        </div>
                    `;

                } else if (data.type === 'comprehensive_sample_size') {
                    typeClass = 'type-comprehensive';
                    typeText = 'üéØ Comprehensive Sample Size Analysis';
                    
                    const meanData = data.meanQuestion;
                    const propData = data.proportionQuestion;
                    
                    const priorInfo = propData.scenario === 'prior_estimate' 
                        ? `Previous studies suggest that approximately ${propData.pEstimate} of the population will ${propData.characteristic}.`
                        : `No prior information is available about the population proportion.`;

                    questionHTML = `
                        <div class="type-indicator ${typeClass}">${typeText}</div>
                        <div class="question-text">
                            <h3>Comparative Sample Size Analysis</h3>
                            
                            <div class="part-section">
                                <div class="part-title">üìä Part A: Population Mean Sample Size</div>
                                <p>A researcher wants to estimate the population mean for a <span class="stats-highlight">${meanData.contextDescription}</span>.</p>
                                
                                <div class="context-box">
                                    <div class="context-header">Mean Study Parameters</div>
                                    <div class="parameters">
                                        <div class="parameter">
                                            <span class="parameter-label">Desired confidence level:</span>
                                            <span class="parameter-value">${meanData.confidence}%</span>
                                        </div>
                                        <div class="parameter">
                                            <span class="parameter-label">Desired margin of error:</span>
                                            <span class="parameter-value">${meanData.marginError} ${meanData.unit}</span>
                                        </div>
                                        <div class="parameter">
                                            <span class="parameter-label">Population standard deviation:</span>
                                            <span class="parameter-value">${meanData.sigma} ${meanData.unit} (known)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="part-section">
                                <div class="part-title">üìà Part B: Population Proportion Sample Size</div>
                                <p>A researcher wants to estimate the population proportion for a <span class="stats-highlight">${propData.contextDescription}</span>.</p>
                                <p><strong>Study objective:</strong> Determine what proportion of the population will <span class="stats-highlight">${propData.characteristic}</span>.</p>
                                
                                <div class="context-box">
                                    <div class="context-header">Proportion Study Parameters</div>
                                    <div class="parameters">
                                        <div class="parameter">
                                            <span class="parameter-label">Desired confidence level:</span>
                                            <span class="parameter-value">${propData.confidence}%</span>
                                        </div>
                                        <div class="parameter">
                                            <span class="parameter-label">Desired margin of error:</span>
                                            <span class="parameter-value">${propData.marginError}</span>
                                        </div>
                                        <div class="parameter">
                                            <span class="parameter-label">Prior information:</span>
                                            <span class="parameter-value">${priorInfo}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="scenario-info">
                                üéØ Calculate both sample sizes and compare the requirements
                            </div>
                            
                            <p><strong>Calculate the minimum sample sizes for both studies and determine which requires more participants.</strong></p>
                        </div>
                    `;
                    
                    document.getElementById('answer-inputs').innerHTML = `
                        <div class="comprehensive-answers">
                            <div class="input-group">
                                <label>Part A - Mean sample size:</label>
                                <input type="number" id="mean-sample-size-input" step="1" placeholder="0" min="1">
                                <span style="font-weight: bold;">${meanData.item}</span>
                            </div>
                            <div class="input-group">
                                <label>Part B - Proportion sample size:</label>
                                <input type="number" id="proportion-sample-size-input" step="1" placeholder="0" min="1">
                                <span style="font-weight: bold;">participants</span>
                            </div>
                        </div>
                    `;
                }

                document.getElementById('question-container').innerHTML = questionHTML;
            }

            showSolution(data) {
                let solutionHTML = '';
                
                if (data.type === 'mean_sample_size') {
                    const calculation1 = Math.round((data.zCritical * data.sigma) * 1000) / 1000;
                    const calculation2 = Math.round((calculation1 / data.marginError) * 1000) / 1000;

                    solutionHTML = `
                        <h4>üí° Sample Size for Population Mean</h4>
                        
                        <div class="solution-step">
                            <h5>Formula and Parameters</h5>
                            <div class="formula">n = (z √ó œÉ / E)¬≤</div>
                            <p><strong>Where:</strong></p>
                            <ul>
                                <li>z = critical value for ${data.confidence}% confidence = <span class="stats-highlight">${data.zCritical}</span></li>
                                <li>œÉ = population standard deviation = <span class="stats-highlight">${data.sigma} ${data.unit}</span></li>
                                <li>E = desired margin of error = <span class="stats-highlight">${data.marginError} ${data.unit}</span></li>
                            </ul>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Step-by-Step Calculation</h5>
                            <div class="formula">n = (${data.zCritical} √ó ${data.sigma} / ${data.marginError})¬≤</div>
                            <div class="formula">n = (${calculation1} / ${data.marginError})¬≤</div>
                            <div class="formula">n = ${calculation2}¬≤</div>
                            <div class="formula">n = ${data.nExact}</div>
                            <div class="result">Minimum sample size: ${data.nRequired} ${data.item}</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Interpretation:</strong> A sample of at least ${data.nRequired} ${data.item} is needed to estimate the population mean within ¬±${data.marginError} ${data.unit} with ${data.confidence}% confidence. We always round UP because we need a whole number of subjects.
                        </div>
                    `;

                } else if (data.type === 'proportion_sample_size') {
                    const pExplanation = data.scenario === 'prior_estimate' 
                        ? `Using prior estimate: p = ${data.pEstimate}, (1-p) = ${data.pComplement}`
                        : `Using worst-case scenario: p = 0.5, (1-p) = 0.5 (maximum sample size)`;

                    const zSquared = Math.round(Math.pow(data.zCritical, 2) * 1000) / 1000;
                    const numerator = Math.round(zSquared * data.pEstimate * data.pComplement * 10000) / 10000;
                    const denominator = Math.round(Math.pow(data.marginError, 2) * 1000000) / 1000000;

                    solutionHTML = `
                        <h4>üí° Sample Size for Population Proportion</h4>
                        
                        <div class="solution-step">
                            <h5>Formula and Parameters</h5>
                            <div class="formula">n = (z¬≤ √ó p √ó (1-p)) / E¬≤</div>
                            <p><strong>Where:</strong></p>
                            <ul>
                                <li>z = critical value for ${data.confidence}% confidence = <span class="stats-highlight">${data.zCritical}</span></li>
                                <li>p = estimated population proportion = <span class="stats-highlight">${data.pEstimate}</span></li>
                                <li>E = desired margin of error = <span class="stats-highlight">${data.marginError}</span></li>
                            </ul>
                            <p><strong>Proportion estimate:</strong> ${pExplanation}</p>
                        </div>
                        
                        <div class="solution-step">
                            <h5>Step-by-Step Calculation</h5>
                            <div class="formula">n = (${data.zCritical}¬≤ √ó ${data.pEstimate} √ó ${data.pComplement}) / ${data.marginError}¬≤</div>
                            <div class="formula">n = (${zSquared} √ó ${data.pEstimate} √ó ${data.pComplement}) / ${denominator}</div>
                            <div class="formula">n = ${numerator} / ${denominator}</div>
                            <div class="formula">n = ${data.nExact}</div>
                            <div class="result">Minimum sample size: ${data.nRequired} participants</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìà Interpretation:</strong> A sample of at least ${data.nRequired} participants is needed to estimate the population proportion within ¬±${data.marginError} with ${data.confidence}% confidence. We always round UP because we need a whole number of people.
                        </div>
                    `;

                } else if (data.type === 'comprehensive_sample_size') {
                    // Show solutions for both parts
                    const meanData = data.meanQuestion;
                    const propData = data.proportionQuestion;
                    
                    const comparison = meanData.nRequired > propData.nRequired 
                        ? `The mean estimation study requires more participants (${meanData.nRequired} vs ${propData.nRequired}).`
                        : `The proportion estimation study requires more participants (${propData.nRequired} vs ${meanData.nRequired}).`;

                    solutionHTML = `
                        <h4>üéØ Comprehensive Sample Size Analysis</h4>
                        
                        <div class="solution-step">
                            <h5>üìä Part A: Mean Sample Size Solution</h5>
                            <div class="formula">n = (z √ó œÉ / E)¬≤ = (${meanData.zCritical} √ó ${meanData.sigma} / ${meanData.marginError})¬≤ = ${meanData.nExact}</div>
                            <div class="result">Part A Answer: ${meanData.nRequired} ${meanData.item}</div>
                        </div>
                        
                        <div class="solution-step">
                            <h5>üìà Part B: Proportion Sample Size Solution</h5>
                            <div class="formula">n = (z¬≤ √ó p √ó (1-p)) / E¬≤ = (${propData.zCritical}¬≤ √ó ${propData.pEstimate} √ó ${propData.pComplement}) / ${propData.marginError}¬≤ = ${propData.nExact}</div>
                            <div class="result">Part B Answer: ${propData.nRequired} participants</div>
                        </div>
                        
                        <div class="interpretation-box">
                            <strong>üìä Comparison:</strong> ${comparison}<br><br>
                            <strong>Why the difference?</strong> Sample size requirements depend on the variability in the population, the desired precision (margin of error), and the confidence level. Different types of estimates may require different sample sizes even with the same confidence level.
                        </div>
                    `;
                }
                
                document.getElementById('solution').innerHTML = solutionHTML;
                document.getElementById('solution').classList.remove('hidden');
            }

            checkSingleAnswer(answer, correctData) {
                const tolerance = 0; // Exact match for sample sizes
                const isCorrect = Math.abs(answer - correctData.nRequired) <= tolerance;
                
                return {
                    isCorrect,
                    correctAnswer: correctData.nRequired
                };
            }

            checkComprehensiveAnswers(answers, correctData) {
                const tolerance = 0; // Exact match for sample sizes
                
                const results = {
                    mean: Math.abs(answers.mean - correctData.meanQuestion.nRequired) <= tolerance,
                    proportion: Math.abs(answers.proportion - correctData.proportionQuestion.nRequired) <= tolerance
                };
                
                const correctCount = Object.values(results).filter(x => x).length;
                const allCorrect = correctCount === 2;
                
                return {
                    results,
                    correctCount,
                    allCorrect,
                    correctAnswers: {
                        mean: correctData.meanQuestion.nRequired,
                        proportion: correctData.proportionQuestion.nRequired
                    }
                };
            }
        }

        // Initialize simulator
        const simulator = new SampleSizeSimulator();

        function selectQuestionType(type) {
            simulator.questionType = type;
            
            // Update selector appearance
            document.querySelectorAll('.type-selector').forEach(el => el.classList.remove('active'));
            document.getElementById(type + '-selector').classList.add('active');
            
            generateNewQuestion();
        }

        function generateNewQuestion() {
            simulator.currentQuestion = simulator.generateQuestion();
            simulator.displayQuestion(simulator.currentQuestion);
            
            // Clear previous answers and feedback
            clearAnswers();
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('solution').classList.add('hidden');
            
            // Update question counter
            document.getElementById('question-counter').textContent = `Question ${simulator.questionCount} of ‚àû`;
            simulator.questionCount++;
        }

        function checkAnswers() {
            if (!simulator.currentQuestion) {
                alert('Please generate a question first!');
                return;
            }

            const feedback = document.getElementById('feedback');
            
            if (simulator.currentQuestion.type === 'comprehensive_sample_size') {
                const answers = {
                    mean: parseInt(document.getElementById('mean-sample-size-input').value),
                    proportion: parseInt(document.getElementById('proportion-sample-size-input').value)
                };
                
                if (Object.values(answers).some(isNaN)) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '‚ö†Ô∏è Please enter valid numbers for both sample sizes.';
                    feedback.classList.remove('hidden');
                    return;
                }
                
                const result = simulator.checkComprehensiveAnswers(answers, simulator.currentQuestion);
                
                // Update input styling
                document.getElementById('mean-sample-size-input').className = result.results.mean ? 'input-correct' : 'input-incorrect';
                document.getElementById('proportion-sample-size-input').className = result.results.proportion ? 'input-correct' : 'input-incorrect';
                
                feedback.classList.remove('hidden');
                
                if (result.allCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = `üéâ Perfect! Both sample sizes are correct!<br>Mean: ${result.correctAnswers.mean}, Proportion: ${result.correctAnswers.proportion}`;
                } else if (result.correctCount === 1) {
                    feedback.className = 'feedback partial';
                    feedback.innerHTML = `‚úÖ ${result.correctCount} out of 2 correct!<br>Check the highlighted field and review the calculation steps.`;
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚ùå Both sample sizes need adjustment.<br>üí° Review the sample size formulas and try again.`;
                }
            } else {
                const singleInput = parseInt(document.getElementById('sample-size-input').value);
                
                if (isNaN(singleInput)) {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = '‚ö†Ô∏è Please enter a valid whole number.';
                    feedback.classList.remove('hidden');
                    return;
                }
                
                const result = simulator.checkSingleAnswer(singleInput, simulator.currentQuestion);
                
                // Update input styling
                document.getElementById('sample-size-input').className = result.isCorrect ? 'input-correct' : 'input-incorrect';
                
                feedback.classList.remove('hidden');
                
                if (result.isCorrect) {
                    feedback.className = 'feedback correct';
                    feedback.innerHTML = 'üéâ Excellent! Your sample size calculation is correct!';
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚ùå Not quite right. The correct sample size is ${result.correctAnswer}.<br>üí° Check your calculation and remember to round UP.`;
                }
            }
        }

        function showSolution() {
            if (!simulator.currentQuestion) {
                alert('Please generate a question first!');
                return;
            }
            
            simulator.showSolution(simulator.currentQuestion);
        }

        function clearAnswers() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.value = '';
                input.className = '';
            });
        }

        // Generate first question on page load
        window.onload = function() {
            generateNewQuestion();
        };
    </script>
</body>
</html>
