<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confidence Intervals for Means - Canadian Economics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.3em;
        }
        
        .canada-header {
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .ci-intro {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #4caf50;
        }
        
        .confidence-concept {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #007bff;
        }
        
        .concept-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .concept-explanation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        .interval-types {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .interval-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #007bff;
            text-align: center;
        }
        
        .interval-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
        }
        
        .interval-formula {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            border-left: 4px solid #28a745;
            font-weight: bold;
        }
        
        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .scenario-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 14px 16px;
            margin: 6px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }
        
        .scenario-btn.active {
            background-color: #007bff;
        }
        
        .problem-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #ffc107;
        }
        
        .data-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #007bff;
        }
        
        .sample-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .stat-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .stat-value {
            font-size: 1.3em;
            color: #007bff;
            font-weight: bold;
        }
        
        .calculation-section {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #9c27b0;
        }
        
        .step-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #9c27b0;
        }
        
        .step-number {
            background: #9c27b0;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 2fr 120px 70px 70px 90px;
            gap: 8px;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 0.9em;
        }
        
        .input-row label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-row input {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .small-button {
            padding: 5px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
        }
        
        .check-btn {
            background: #17a2b8;
        }
        
        .answer-btn {
            background: #28a745;
        }
        
        .steps-btn {
            background: #6f42c1;
        }
        
        .button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 8px 4px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        
        .button:hover {
            background: #218838;
        }
        
        .correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        
        .incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }
        
        .step-instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .tutorial-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            display: none;
        }
        
        .tutorial-step {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .answer-display {
            background: #d4edda;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #c3e6cb;
            font-weight: bold;
            display: none;
            font-size: 0.9em;
        }
        
        .interval-result {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }
        
        .final-interval {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 3px solid #2196f3;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .interpretation-section {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }
        
        .interpretation-text {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        
        .formula-box {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            margin: 15px 0;
            font-family: monospace;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Confidence Intervals for Means</h1>
        
        <div class="canada-header">
            <h2>üá®üá¶ Estimate Population Means with Confidence</h2>
            <p><strong>Statistical Estimation</strong> ‚Ä¢ <strong>Margin of Error</strong> ‚Ä¢ <strong>Canadian Economic Applications</strong></p>
        </div>
        
        <div class="ci-intro">
            <h3>üéØ What Are Confidence Intervals?</h3>
            
            <div class="confidence-concept">
                <div class="concept-title">üìà Estimate Population Parameters with Uncertainty</div>
                
                <div class="concept-explanation">
                    <strong>üéØ The Goal:</strong> Use sample data to estimate unknown population means with a measure of uncertainty. Instead of saying "the average is exactly X," we say "we're 95% confident the average is between X and Y."
                </div>
                
                <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #007bff; margin: 15px 0; text-align: center;">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #007bff;">üîë Key Idea:</div>
                    <div style="font-size: 1.1em;">Sample Mean ¬± Margin of Error</div>
                    <div style="font-style: italic; margin-top: 5px;">The range where the true population mean likely falls</div>
                </div>
                
                <div class="interval-types">
                    <div class="interval-card">
                        <div class="interval-title">üìä Z-Interval (œÉ known)</div>
                        <div class="interval-formula">
                            xÃÑ ¬± z √ó (œÉ/‚àön)<br>
                            <div style="font-size: 0.8em; margin-top: 5px;">Large samples or known population œÉ</div>
                        </div>
                    </div>
                    
                    <div class="interval-card">
                        <div class="interval-title">üìà T-Interval (œÉ unknown)</div>
                        <div class="interval-formula">
                            xÃÑ ¬± t √ó (s/‚àön)<br>
                            <div style="font-size: 0.8em; margin-top: 5px;">Small samples with sample standard deviation</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="scenario-selector">
            <div style="font-size: 1.3em; font-weight: bold; color: #2c3e50; margin-bottom: 15px;">
                üìä Choose Canadian Economic Confidence Interval Problem:
            </div>
            
            <div style="margin-bottom: 10px;">
                <button class="scenario-btn" onclick="chooseScenario('housing-prices-z')">üè† Housing Prices (œÉ known)</button>
                <button class="scenario-btn" onclick="chooseScenario('wages-t')">üí∞ Wages (Small Sample)</button>
                <button class="scenario-btn" onclick="chooseScenario('gdp-z')">üìà GDP Growth (Large Sample)</button>
            </div>
            <div>
                <button class="scenario-btn" onclick="chooseScenario('business-revenue-t')">üè¢ Business Revenue (œÉ unknown)</button>
                <button class="scenario-btn" onclick="chooseScenario('inflation-z')">üìä Inflation Rates (Historical œÉ)</button>
                <button class="scenario-btn" onclick="chooseScenario('unemployment-t')">üíº Unemployment (Regional Study)</button>
            </div>
        </div>
        
        <div id="problemArea" style="display: none;">
            <div class="problem-section">
                <h3>üìã Step 1: Sample Data & Economic Context</h3>
                <div class="step-instructions">
                    <div id="scenarioDescription"></div>
                </div>
                
                <div class="data-display">
                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 15px;">üìä Sample Statistics:</div>
                    <div class="sample-stats">
                        <div class="stat-box">
                            <div class="stat-label">Sample Size (n)</div>
                            <div class="stat-value" id="sampleSize"></div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Sample Mean (xÃÑ)</div>
                            <div class="stat-value" id="sampleMean"></div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label" id="stdLabel">Std Dev</div>
                            <div class="stat-value" id="stdValue"></div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Confidence Level</div>
                            <div class="stat-value">95%</div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #007bff; margin-top: 15px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #007bff;">üéØ Goal:</div>
                        <div id="goalDescription" style="font-size: 1.1em;"></div>
                    </div>
                </div>
            </div>
            
            <div class="calculation-section">
                <h3>üßÆ Step 2: Calculate Confidence Interval</h3>
                
                <div class="step-container">
                    <div class="step-number">Step 1</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Find Critical Value</div>
                    <div class="step-instructions">
                        <strong id="criticalInstructions">Determine the critical value for 95% confidence</strong>
                    </div>
                    
                    <div class="input-row">
                        <label id="criticalLabel">Critical Value:</label>
                        <input type="number" id="criticalInput" step="0.001" placeholder="z or t">
                        <button class="small-button check-btn" onclick="checkCritical()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('critical')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('critical-value')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="critical-answer"></div>
                    <div class="tutorial-box" id="critical-value-tutorial"></div>
                </div>
                
                <div class="step-container">
                    <div class="step-number">Step 2</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Calculate Standard Error</div>
                    <div class="step-instructions">
                        <strong>Standard Error:</strong> <span id="seFormula">SE = œÉ/‚àön or s/‚àön</span>
                    </div>
                    
                    <div class="input-row">
                        <label>Standard Error (SE):</label>
                        <input type="number" id="seInput" step="0.01" placeholder="SE">
                        <button class="small-button check-btn" onclick="checkSE()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('se')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('standard-error')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="se-answer"></div>
                    <div class="tutorial-box" id="standard-error-tutorial"></div>
                </div>
                
                <div class="step-container">
                    <div class="step-number">Step 3</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Calculate Margin of Error</div>
                    <div class="step-instructions">
                        <strong>Margin of Error:</strong> E = Critical Value √ó Standard Error
                    </div>
                    
                    <div class="input-row">
                        <label>Margin of Error (E):</label>
                        <input type="number" id="meInput" step="0.01" placeholder="MOE">
                        <button class="small-button check-btn" onclick="checkME()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('me')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('margin-error')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="me-answer"></div>
                    <div class="tutorial-box" id="margin-error-tutorial"></div>
                </div>
                
                <div class="step-container">
                    <div class="step-number">Step 4</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Construct Confidence Interval</div>
                    <div class="step-instructions">
                        <strong>Interval:</strong> (xÃÑ - E, xÃÑ + E)
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-row">
                            <label>Lower Bound:</label>
                            <input type="number" id="lowerInput" step="0.01" placeholder="Lower">
                            <button class="small-button check-btn" onclick="checkLower()">Check</button>
                            <button class="small-button answer-btn" onclick="showAnswer('lower')">Answer</button>
                        </div>
                        
                        <div class="input-row">
                            <label>Upper Bound:</label>
                            <input type="number" id="upperInput" step="0.01" placeholder="Upper">
                            <button class="small-button check-btn" onclick="checkUpper()">Check</button>
                            <button class="small-button answer-btn" onclick="showAnswer('upper')">Answer</button>
                        </div>
                    </div>
                    
                    <div class="answer-display" id="lower-answer"></div>
                    <div class="answer-display" id="upper-answer"></div>
                </div>
            </div>
            
            <div class="interval-result">
                <h3>üìà Step 3: Your Confidence Interval</h3>
                <div class="final-interval" id="finalInterval">
                    Complete all calculations to see your confidence interval
                </div>
                <div style="text-align: center; margin-top: 15px; font-style: italic;">
                    We are <strong>95% confident</strong> that the true population mean falls within this range
                </div>
            </div>
            
            <div class="interpretation-section">
                <h3>üíº Step 4: Economic Interpretation</h3>
                <div class="interpretation-text">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #2e7d32;">üìà What This Means:</div>
                    <div id="economicInterpretation"></div>
                </div>
            </div>
            
            <button class="button" onclick="generateNewProblem()">üé≤ New Confidence Interval Problem</button>
            <button class="button" onclick="checkAllSteps()">‚úÖ Check All Calculations</button>
            <button class="button" onclick="showCISummary()">üìñ CI Method Summary</button>
        </div>
    </div>

    <script>
        let currentScenario = '';
        let problemData = {};
        let correctAnswers = {};

        const scenarios = {
            'housing-prices-z': {
                name: 'Canadian Housing Prices Estimation (œÉ known)',
                description: 'CMHC conducting a national housing price study. Historical data shows population standard deviation is known.',
                variable: 'Average House Price',
                unit: 'CAD',
                intervalType: 'z',
                sampleSize: 150,
                sampleMean: 485000,
                populationStd: 95000,
                sampleStd: null,
                goal: 'Estimate the true average housing price across all Canadian markets with 95% confidence'
            },
            'wages-t': {
                name: 'Regional Wage Analysis (Small Sample)',
                description: 'Employment Canada studying wages in rural communities. Small sample with unknown population standard deviation.',
                variable: 'Annual Wage',
                unit: 'CAD',
                intervalType: 't',
                sampleSize: 25,
                sampleMean: 52000,
                populationStd: null,
                sampleStd: 8500,
                goal: 'Estimate the true average wage in rural Canadian communities with 95% confidence'
            },
            'gdp-z': {
                name: 'Provincial GDP Growth (Large Sample)',
                description: 'Statistics Canada analyzing quarterly GDP growth across provinces. Large dataset with historical variance known.',
                variable: 'GDP Growth Rate',
                unit: '%',
                intervalType: 'z',
                sampleSize: 120,
                sampleMean: 2.4,
                populationStd: 0.8,
                sampleStd: null,
                goal: 'Estimate the true average GDP growth rate for Canadian provinces with 95% confidence'
            },
            'business-revenue-t': {
                name: 'Small Business Revenue Study',
                description: 'Canadian Federation of Independent Business surveying small business revenues. Limited sample from specific sector.',
                variable: 'Monthly Revenue',
                unit: 'CAD',
                intervalType: 't',
                sampleSize: 18,
                sampleMean: 28500,
                populationStd: null,
                sampleStd: 6200,
                goal: 'Estimate the true average monthly revenue for small businesses in this sector with 95% confidence'
            },
            'inflation-z': {
                name: 'Consumer Price Index Analysis',
                description: 'Bank of Canada analyzing monthly inflation rates. Long historical data provides known population variance.',
                variable: 'Monthly Inflation Rate',
                unit: '%',
                intervalType: 'z',
                sampleSize: 200,
                sampleMean: 1.8,
                populationStd: 0.5,
                sampleStd: null,
                goal: 'Estimate the true average monthly inflation rate with 95% confidence'
            },
            'unemployment-t': {
                name: 'Regional Unemployment Study',
                description: 'Statistics Canada studying unemployment in specific census divisions. Small regional sample.',
                variable: 'Unemployment Rate',
                unit: '%',
                intervalType: 't',
                sampleSize: 22,
                sampleMean: 6.8,
                populationStd: null,
                sampleStd: 1.6,
                goal: 'Estimate the true average unemployment rate for this region with 95% confidence'
            }
        };

        function chooseScenario(scenario) {
            currentScenario = scenario;
            
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            generateProblem(scenario);
            document.getElementById('problemArea').style.display = 'block';
            clearAllInputs();
        }

        function generateProblem(scenario) {
            const scenarioData = scenarios[scenario];
            
            problemData = {
                scenario: scenarioData.name,
                description: scenarioData.description,
                variable: scenarioData.variable,
                unit: scenarioData.unit,
                intervalType: scenarioData.intervalType,
                n: scenarioData.sampleSize,
                xbar: scenarioData.sampleMean,
                sigma: scenarioData.populationStd,
                s: scenarioData.sampleStd,
                goal: scenarioData.goal,
                confidence: 0.95
            };
            
            calculateCorrectAnswers();
            updateDisplay();
        }

        function calculateCorrectAnswers() {
            const { intervalType, n, xbar, sigma, s, confidence } = problemData;
            
            let critical, standardError, marginError, lower, upper;
            
            if (intervalType === 'z') {
                // Z-interval
                critical = 1.96; // 95% confidence
                standardError = sigma / Math.sqrt(n);
            } else {
                // T-interval
                const df = n - 1;
                critical = getTCritical(df, confidence);
                standardError = s / Math.sqrt(n);
            }
            
            marginError = critical * standardError;
            lower = xbar - marginError;
            upper = xbar + marginError;
            
            correctAnswers = {
                critical: critical,
                standardError: standardError,
                marginError: marginError,
                lower: lower,
                upper: upper,
                df: intervalType === 't' ? n - 1 : null
            };
        }

        function getTCritical(df, confidence) {
            // Simplified t-critical values for 95% confidence
            const tTable = {
                5: 2.571, 10: 2.228, 15: 2.131, 17: 2.110, 20: 2.086, 
                21: 2.080, 24: 2.064, 25: 2.060, 30: 2.042
            };
            
            // Find closest df or use approximation
            if (tTable[df]) return tTable[df];
            
            // Approximation for other values
            if (df < 5) return 2.571;
            if (df > 30) return 1.96;
            
            // Linear interpolation for in-between values
            const keys = Object.keys(tTable).map(Number).sort((a, b) => a - b);
            for (let i = 0; i < keys.length - 1; i++) {
                if (df >= keys[i] && df <= keys[i + 1]) {
                    const t1 = tTable[keys[i]];
                    const t2 = tTable[keys[i + 1]];
                    const ratio = (df - keys[i]) / (keys[i + 1] - keys[i]);
                    return t1 - ratio * (t1 - t2);
                }
            }
            
            return 2.042; // Default
        }

        function updateDisplay() {
            document.getElementById('scenarioDescription').innerHTML = 
                `<strong>${problemData.scenario}</strong><br>${problemData.description}`;
            
            document.getElementById('sampleSize').textContent = problemData.n;
            document.getElementById('sampleMean').textContent = formatValue(problemData.xbar, problemData.unit);
            
            if (problemData.intervalType === 'z') {
                document.getElementById('stdLabel').textContent = 'Pop Std (œÉ)';
                document.getElementById('stdValue').textContent = formatValue(problemData.sigma, problemData.unit);
                document.getElementById('seFormula').textContent = 'SE = œÉ/‚àön';
                document.getElementById('criticalInstructions').textContent = 'Find Z-critical for 95% confidence';
                document.getElementById('criticalLabel').textContent = 'Z-critical:';
            } else {
                document.getElementById('stdLabel').textContent = 'Sample Std (s)';
                document.getElementById('stdValue').textContent = formatValue(problemData.s, problemData.unit);
                document.getElementById('seFormula').textContent = 'SE = s/‚àön';
                document.getElementById('criticalInstructions').textContent = `Find t-critical for 95% confidence with df = ${problemData.n - 1}`;
                document.getElementById('criticalLabel').textContent = 't-critical:';
            }
            
            document.getElementById('goalDescription').textContent = problemData.goal;
            updateEconomicInterpretation();
        }

        function formatValue(value, unit) {
            if (unit === 'CAD') {
                return `$${value.toLocaleString()}`;
            } else if (unit === '%') {
                return `${value}%`;
            }
            return `${value} ${unit}`;
        }

        function updateEconomicInterpretation() {
            if (correctAnswers.lower && correctAnswers.upper) {
                const lower = formatValue(correctAnswers.lower, problemData.unit);
                const upper = formatValue(correctAnswers.upper, problemData.unit);
                
                document.getElementById('economicInterpretation').innerHTML = `
                    <strong>${problemData.scenario} Results:</strong><br>
                    We are 95% confident that the true population mean ${problemData.variable.toLowerCase()} 
                    is between ${lower} and ${upper}.<br><br>
                    <strong>Policy Implications:</strong> This range helps policymakers understand the likely 
                    true values for planning, budgeting, and intervention decisions. The margin of error 
                    (¬±${formatValue(correctAnswers.marginError, problemData.unit)}) indicates the precision 
                    of our estimate.
                `;
                
                document.getElementById('finalInterval').innerHTML = `
                    ${lower} ‚â§ Œº ‚â§ ${upper}<br>
                    <div style="font-size: 0.8em; margin-top: 5px;">95% Confidence Interval for Population Mean</div>
                `;
            }
        }

        function checkAnswer(inputId, correctValue, tolerance = null) {
            const input = document.getElementById(inputId);
            const userAnswer = parseFloat(input.value);
            
            if (isNaN(userAnswer)) {
                input.className = '';
                return false;
            }
            
            // Set default tolerance based on value magnitude
            if (!tolerance) {
                tolerance = Math.max(0.01, Math.abs(correctValue) * 0.05);
            }
            
            const isCorrect = Math.abs(userAnswer - correctValue) <= tolerance;
            input.className = isCorrect ? 'correct' : 'incorrect';
            
            if (isCorrect && inputId === 'upperInput') {
                updateEconomicInterpretation();
            }
            
            return isCorrect;
        }

        function checkCritical() {
            return checkAnswer('criticalInput', correctAnswers.critical, 0.01);
        }

        function checkSE() {
            return checkAnswer('seInput', correctAnswers.standardError);
        }

        function checkME() {
            return checkAnswer('meInput', correctAnswers.marginError);
        }

        function checkLower() {
            return checkAnswer('lowerInput', correctAnswers.lower);
        }

        function checkUpper() {
            return checkAnswer('upperInput', correctAnswers.upper);
        }

        function showAnswer(answerType) {
            const answerDiv = document.getElementById(answerType + '-answer');
            
            switch(answerType) {
                case 'critical':
                    answerDiv.innerHTML = `‚úÖ ${problemData.intervalType === 'z' ? 'Z' : 't'}-critical = ${correctAnswers.critical.toFixed(3)}`;
                    break;
                case 'se':
                    answerDiv.innerHTML = `‚úÖ SE = ${correctAnswers.standardError.toFixed(4)}`;
                    break;
                case 'me':
                    answerDiv.innerHTML = `‚úÖ Margin of Error = ${correctAnswers.marginError.toFixed(4)}`;
                    break;
                case 'lower':
                    answerDiv.innerHTML = `‚úÖ Lower Bound = ${correctAnswers.lower.toFixed(2)}`;
                    break;
                case 'upper':
                    answerDiv.innerHTML = `‚úÖ Upper Bound = ${correctAnswers.upper.toFixed(2)}`;
                    break;
            }
            
            answerDiv.style.display = 'block';
        }

        function showSteps(stepType) {
            const tutorialDiv = document.getElementById(stepType + '-tutorial');
            
            if (stepType === 'critical-value') {
                let stepsHTML = `<h4>üìö Finding Critical Value:</h4>`;
                
                if (problemData.intervalType === 'z') {
                    stepsHTML += `
                        <div class="tutorial-step">
                            <strong>Z-interval (œÉ known):</strong><br>
                            For 95% confidence, Œ± = 0.05<br>
                            Œ±/2 = 0.025 in each tail<br>
                            Z‚ÇÄ.‚ÇÄ‚ÇÇ‚ÇÖ = 1.96
                        </div>
                        <div class="tutorial-step">
                            <strong>From normal table:</strong><br>
                            P(Z ‚â§ 1.96) = 0.975<br>
                            This captures 95% of the distribution
                        </div>
                    `;
                } else {
                    stepsHTML += `
                        <div class="tutorial-step">
                            <strong>T-interval (œÉ unknown):</strong><br>
                            df = n - 1 = ${problemData.n} - 1 = ${correctAnswers.df}<br>
                            For 95% confidence with df = ${correctAnswers.df}<br>
                            t‚ÇÄ.‚ÇÄ‚ÇÇ‚ÇÖ,${correctAnswers.df} = ${correctAnswers.critical.toFixed(3)}
                        </div>
                        <div class="tutorial-step">
                            <strong>Why t-distribution?</strong><br>
                            Sample size < 30 and œÉ unknown<br>
                            T-distribution accounts for extra uncertainty
                        </div>
                    `;
                }
                
                tutorialDiv.innerHTML = stepsHTML;
                
            } else if (stepType === 'standard-error') {
                stepsHTML = '<h4>üìä Standard Error Calculation:</h4>';
                
                if (problemData.intervalType === 'z') {
                    stepsHTML += `
                        <div class="tutorial-step">
                            <strong>SE = œÉ/‚àön</strong><br>
                            SE = ${problemData.sigma}/‚àö${problemData.n}<br>
                            SE = ${problemData.sigma}/${Math.sqrt(problemData.n).toFixed(3)}<br>
                            SE = ${correctAnswers.standardError.toFixed(4)}
                        </div>
                    `;
                } else {
                    stepsHTML += `
                        <div class="tutorial-step">
                            <strong>SE = s/‚àön</strong><br>
                            SE = ${problemData.s}/‚àö${problemData.n}<br>
                            SE = ${problemData.s}/${Math.sqrt(problemData.n).toFixed(3)}<br>
                            SE = ${correctAnswers.standardError.toFixed(4)}
                        </div>
                    `;
                }
                
                stepsHTML += `
                    <div class="tutorial-step">
                        <strong>Standard Error measures:</strong><br>
                        How much sample means vary from sample to sample<br>
                        Smaller SE = more precise estimate
                    </div>
                `;
                
                tutorialDiv.innerHTML = stepsHTML;
                
            } else if (stepType === 'margin-error') {
                tutorialDiv.innerHTML = `
                    <h4>üìè Margin of Error Calculation:</h4>
                    <div class="tutorial-step">
                        <strong>E = Critical Value √ó SE</strong><br>
                        E = ${correctAnswers.critical.toFixed(3)} √ó ${correctAnswers.standardError.toFixed(4)}<br>
                        E = ${correctAnswers.marginError.toFixed(4)}
                    </div>
                    <div class="tutorial-step">
                        <strong>Margin of Error represents:</strong><br>
                        Maximum likely error in our estimate<br>
                        ¬±${formatValue(correctAnswers.marginError, problemData.unit)} uncertainty around our sample mean
                    </div>
                `;
            }
            
            tutorialDiv.style.display = tutorialDiv.style.display === 'none' ? 'block' : 'none';
        }

        function checkAllSteps() {
            const results = [
                checkCritical(),
                checkSE(),
                checkME(),
                checkLower(),
                checkUpper()
            ];
            const correct = results.filter(r => r).length;
            
            alert(`You got ${correct}/5 steps correct!\n\n${correct === 5 ? 'üéâ Perfect confidence interval construction!' : 'Use the Steps buttons to see detailed solutions.'}`);
        }

        function generateNewProblem() {
            if (currentScenario) {
                generateProblem(currentScenario);
                clearAllInputs();
            } else {
                alert('Please select a scenario first.');
            }
        }

        function clearAllInputs() {
            const inputs = ['criticalInput', 'seInput', 'meInput', 'lowerInput', 'upperInput'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = '';
                    input.className = '';
                }
                
                const answerDiv = document.getElementById(id.replace('Input', '') + '-answer');
                if (answerDiv) answerDiv.style.display = 'none';
            });
            
            // Hide all tutorial boxes
            ['critical-value-tutorial', 'standard-error-tutorial', 'margin-error-tutorial'].forEach(id => {
                const div = document.getElementById(id);
                if (div) div.style.display = 'none';
            });
            
            // Reset final interval
            document.getElementById('finalInterval').textContent = 'Complete all calculations to see your confidence interval';
            document.getElementById('economicInterpretation').textContent = 'Complete the confidence interval calculation to see economic interpretation.';
        }

        function showCISummary() {
            alert(`üìä Confidence Interval Method Summary:\n\n` +
                `CHOOSE THE RIGHT INTERVAL:\n` +
                `‚Ä¢ Z-interval: œÉ known OR large sample (n ‚â• 30)\n` +
                `‚Ä¢ T-interval: œÉ unknown AND small sample (n < 30)\n\n` +
                `CALCULATION STEPS:\n` +
                `1. Find Critical Value (z or t)\n` +
                `2. Calculate Standard Error (œÉ/‚àön or s/‚àön)\n` +
                `3. Calculate Margin of Error (Critical √ó SE)\n` +
                `4. Construct Interval: xÃÑ ¬± E\n\n` +
                `INTERPRETATION:\n` +
                `"We are 95% confident that the true population\n` +
                `mean falls between [lower] and [upper]"\n\n` +
                `üá®üá¶ ECONOMIC APPLICATIONS:\n` +
                `‚Ä¢ Budget planning with uncertainty\n` +
                `‚Ä¢ Performance benchmarking\n` +
                `‚Ä¢ Policy threshold estimation\n` +
                `‚Ä¢ Risk assessment`);
        }
    </script>
</body>
</html>
