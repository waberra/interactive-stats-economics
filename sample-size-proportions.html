 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sample Size Determination for Proportions - Canadian Economics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.3em;
        }
        
        .canada-header {
            background: linear-gradient(135deg, #ff0000, #ff6b6b);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .proportion-size-intro {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #4caf50;
        }
        
        .planning-concept {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 3px solid #007bff;
        }
        
        .concept-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .concept-explanation {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        
        .factors-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .factor-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #007bff;
            text-align: center;
        }
        
        .factor-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .factor-text {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            font-size: 0.9em;
            border-left: 4px solid #28a745;
        }
        
        .scenario-selector {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }
        
        .scenario-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 14px 16px;
            margin: 6px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }
        
        .scenario-btn.active {
            background-color: #007bff;
        }
        
        .problem-section {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #ffc107;
        }
        
        .planning-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #007bff;
        }
        
        .requirements-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        
        .requirement-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .requirement-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .requirement-value {
            font-size: 1.3em;
            color: #007bff;
            font-weight: bold;
        }
        
        .calculation-section {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 3px solid #9c27b0;
        }
        
        .step-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #9c27b0;
        }
        
        .step-number {
            background: #9c27b0;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 2fr 120px 70px 70px 90px;
            gap: 8px;
            align-items: center;
            margin: 12px 0;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 0.9em;
        }
        
        .input-row label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-row input {
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
        }
        
        .small-button {
            padding: 5px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.75em;
            font-weight: bold;
            color: white;
        }
        
        .check-btn {
            background: #17a2b8;
        }
        
        .answer-btn {
            background: #28a745;
        }
        
        .steps-btn {
            background: #6f42c1;
        }
        
        .button {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 8px 4px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        
        .button:hover {
            background: #218838;
        }
        
        .correct {
            background-color: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        
        .incorrect {
            background-color: #f8d7da !important;
            border-color: #f5c6cb !important;
        }
        
        .step-instructions {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
        
        .tutorial-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            display: none;
        }
        
        .tutorial-step {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .answer-display {
            background: #d4edda;
            padding: 8px;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #c3e6cb;
            font-weight: bold;
            display: none;
            font-size: 0.9em;
        }
        
        .sample-size-result {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }
        
        .final-sample-size {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 3px solid #2196f3;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .cost-analysis {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }
        
        .cost-breakdown {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        
        .formula-box {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            margin: 15px 0;
            font-family: monospace;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .precision-comparison {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #ffc107;
        }
        
        .prior-estimate {
            background: #e1f5fe;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #0288d1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Sample Size Determination for Proportions</h1>
        
        <div class="canada-header">
            <h2>üá®üá¶ Plan Accurate Polling & Percentage Studies</h2>
            <p><strong>Policy Polling</strong> ‚Ä¢ <strong>Percentage Planning</strong> ‚Ä¢ <strong>Cost-Effective Surveys</strong></p>
        </div>
        
        <div class="proportion-size-intro">
            <h3>üéØ Why Plan Sample Size for Proportions?</h3>
            
            <div class="planning-concept">
                <div class="concept-title">üìà From "How Many?" to "How Accurate?"</div>
                
                <div class="concept-explanation">
                    <strong>üéØ The Challenge:</strong> Polling companies can't survey all Canadians. When they say "42% support this policy ¬± 3%," that margin of error depends entirely on sample size. Larger samples = smaller margins of error = more accurate estimates.
                </div>
                
                <div style="background: #fff; padding: 15px; border-radius: 8px; border: 2px solid #007bff; margin: 15px 0; text-align: center;">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #007bff;">üîë Sample Size Formula for Proportions:</div>
                    <div style="font-size: 1.1em;">n = (z¬≤ √ó p(1-p)) / E¬≤</div>
                    <div style="font-style: italic; margin-top: 5px;">where p = estimated proportion, E = margin of error</div>
                </div>
                
                <div class="factors-grid">
                    <div class="factor-card">
                        <div class="factor-title">üéØ Precision (E)</div>
                        <div class="factor-text">
                            Smaller margin of error<br>
                            = Need larger sample<br>
                            "¬±1% vs ¬±3% vs ¬±5%"
                        </div>
                    </div>
                    
                    <div class="factor-card">
                        <div class="factor-title">üìä Confidence (z)</div>
                        <div class="factor-text">
                            Higher confidence<br>
                            = Need larger sample<br>
                            "90% vs 95% vs 99%"
                        </div>
                    </div>
                    
                    <div class="factor-card">
                        <div class="factor-title">üìà Proportion (p)</div>
                        <div class="factor-text">
                            p = 0.5 is worst case<br>
                            = Largest sample needed<br>
                            "50% needs most observations"
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="scenario-selector">
            <div style="font-size: 1.3em; font-weight: bold; color: #2c3e50; margin-bottom: 15px;">
                üìä Choose Canadian Policy/Economic Proportion Planning Scenario:
            </div>
            
            <div style="margin-bottom: 10px;">
                <button class="scenario-btn" onclick="chooseScenario('election-polling')">üó≥Ô∏è Election Polling</button>
                <button class="scenario-btn" onclick="chooseScenario('policy-support')">üìã Policy Support Survey</button>
                <button class="scenario-btn" onclick="chooseScenario('economic-confidence')">üìà Economic Confidence</button>
            </div>
            <div>
                <button class="scenario-btn" onclick="chooseScenario('healthcare-satisfaction')">üè• Healthcare Satisfaction</button>
                <button class="scenario-btn" onclick="chooseScenario('employment-survey')">üíº Employment Status Survey</button>
                <button class="scenario-btn" onclick="chooseScenario('business-optimism')">üè¢ Business Optimism Index</button>
            </div>
        </div>
        
        <div id="problemArea" style="display: none;">
            <div class="problem-section">
                <h3>üìã Step 1: Polling Requirements & Prior Information</h3>
                <div class="step-instructions">
                    <div id="scenarioDescription"></div>
                </div>
                
                <div class="planning-display">
                    <div style="font-weight: bold; color: #2c3e50; margin-bottom: 15px;">üìä Survey Requirements:</div>
                    <div class="requirements-grid">
                        <div class="requirement-box">
                            <div class="requirement-label">Desired Margin of Error (E)</div>
                            <div class="requirement-value" id="marginError"></div>
                        </div>
                        <div class="requirement-box">
                            <div class="requirement-label">Confidence Level</div>
                            <div class="requirement-value">95%</div>
                        </div>
                        <div class="requirement-box">
                            <div class="requirement-label">Prior Estimate (p)</div>
                            <div class="requirement-value" id="priorEstimate"></div>
                        </div>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 2px solid #007bff; margin-top: 15px;">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #007bff;">üéØ Study Goal:</div>
                        <div id="studyGoal" style="font-size: 1.1em;"></div>
                    </div>
                </div>
                
                <div class="prior-estimate">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #0277bd;">üîç Prior Proportion Estimate:</div>
                    <div id="priorExplanation">Using previous polls or best guess for proportion estimate</div>
                </div>
                
                <div class="precision-comparison">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #856404;">üí° Margin of Error Impact:</div>
                    <div id="precisionComparison">Understanding how precision affects sample size and polling costs</div>
                </div>
            </div>
            
            <div class="calculation-section">
                <h3>üßÆ Step 2: Calculate Required Sample Size</h3>
                
                <div class="step-container">
                    <div class="step-number">Step 1</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Find Critical Z-value</div>
                    <div class="step-instructions">
                        <strong>For 95% confidence:</strong> Find Z‚ÇÄ.‚ÇÄ‚ÇÇ‚ÇÖ = 1.96
                    </div>
                    
                    <div class="input-row">
                        <label>Z-critical value:</label>
                        <input type="number" id="zInput" step="0.001" placeholder="Z-value">
                        <button class="small-button check-btn" onclick="checkZ()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('z')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('z-critical')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="z-answer"></div>
                    <div class="tutorial-box" id="z-critical-tutorial"></div>
                </div>
                
                <div class="step-container">
                    <div class="step-number">Step 2</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Calculate p(1-p) Term</div>
                    <div class="step-instructions">
                        <strong>Variance Component:</strong> p(1-p) measures proportion uncertainty
                    </div>
                    
                    <div class="formula-box" id="pqDisplay">
                        p(1-p) = ? √ó (1-?) = ?
                    </div>
                    
                    <div class="input-row">
                        <label>Calculate p(1-p):</label>
                        <input type="number" id="pqInput" step="0.0001" placeholder="p(1-p)" min="0" max="0.25">
                        <button class="small-button check-btn" onclick="checkPQ()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('pq')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('pq-calculation')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="pq-answer"></div>
                    <div class="tutorial-box" id="pq-calculation-tutorial"></div>
                </div>
                
                <div class="step-container">
                    <div class="step-number">Step 3</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Apply Proportion Sample Size Formula</div>
                    <div class="step-instructions">
                        <strong>Formula:</strong> n = (z¬≤ √ó p(1-p)) / E¬≤
                    </div>
                    
                    <div class="formula-box" id="formulaDisplay">
                        n = (Z¬≤ √ó p(1-p)) / E¬≤
                    </div>
                    
                    <div class="input-row">
                        <label>Calculate n (exact):</label>
                        <input type="number" id="exactInput" step="0.1" placeholder="Exact n">
                        <button class="small-button check-btn" onclick="checkExact()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('exact')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('exact-calculation')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="exact-answer"></div>
                    <div class="tutorial-box" id="exact-calculation-tutorial"></div>
                </div>
                
                <div class="step-container">
                    <div class="step-number">Step 4</div>
                    <div style="font-weight: bold; margin-bottom: 10px;">Round to Practical Sample Size</div>
                    <div class="step-instructions">
                        <strong>Rule:</strong> Always round UP to ensure margin of error requirement is met
                    </div>
                    
                    <div class="input-row">
                        <label>Final sample size (n):</label>
                        <input type="number" id="finalInput" step="1" placeholder="Rounded n" min="1">
                        <button class="small-button check-btn" onclick="checkFinal()">Check</button>
                        <button class="small-button answer-btn" onclick="showAnswer('final')">Answer</button>
                        <button class="small-button steps-btn" onclick="showSteps('rounding-logic')">Steps</button>
                    </div>
                    
                    <div class="answer-display" id="final-answer"></div>
                    <div class="tutorial-box" id="rounding-logic-tutorial"></div>
                </div>
            </div>
            
            <div class="sample-size-result">
                <h3>üìà Step 3: Your Polling Sample Size Recommendation</h3>
                <div class="final-sample-size" id="finalSampleSize">
                    Complete calculations to see sample size recommendation
                </div>
                <div style="text-align: center; margin-top: 15px; font-style: italic;">
                    This sample size ensures <strong>95% confidence</strong> with your desired precision
                </div>
            </div>
            
            <div class="cost-analysis">
                <h3>üíº Step 4: Polling Cost & Feasibility Analysis</h3>
                <div class="cost-breakdown">
                    <div style="font-weight: bold; margin-bottom: 10px; color: #2e7d32;">üìà Polling Strategy Implications:</div>
                    <div id="costAnalysis"></div>
                </div>
            </div>
            
            <button class="button" onclick="generateNewProblem()">üé≤ New Proportion Sample Size Problem</button>
            <button class="button" onclick="checkAllSteps()">‚úÖ Check All Calculations</button>
            <button class="button" onclick="showProportionSizeSummary()">üìñ Proportion Sample Size Guide</button>
        </div>
    </div>

    <script>
        let currentScenario = '';
        let problemData = {};
        let correctAnswers = {};

        const scenarios = {
            'election-polling': {
                name: 'Federal Election Polling Planning',
                description: 'Elections Canada planning pre-election polling accuracy. Need reliable estimates of voting intentions with minimal margin of error.',
                question: 'What percentage will vote for the incumbent party?',
                marginError: 0.03, // 3%
                priorEstimate: 0.45,
                costPerResponse: 25,
                goal: 'Estimate voting intentions within ¬±3% with 95% confidence'
            },
            'policy-support': {
                name: 'Carbon Tax Policy Support Survey',
                description: 'Environment Canada measuring public support for carbon pricing policy. Need accurate estimates for policy refinement.',
                question: 'What percentage support carbon tax policy?',
                marginError: 0.04, // 4%
                priorEstimate: 0.52,
                costPerResponse: 18,
                goal: 'Estimate carbon tax support within ¬±4% with 95% confidence'
            },
            'economic-confidence': {
                name: 'National Economic Confidence Index',
                description: 'Bank of Canada tracking economic confidence among Canadians. Need precise measures for monetary policy guidance.',
                question: 'What percentage are confident about economic outlook?',
                marginError: 0.035, // 3.5%
                priorEstimate: 0.38,
                costPerResponse: 22,
                goal: 'Measure economic confidence within ¬±3.5% with 95% confidence'
            },
            'healthcare-satisfaction': {
                name: 'National Healthcare Satisfaction Survey',
                description: 'Health Canada measuring satisfaction with public healthcare system for policy planning.',
                question: 'What percentage are satisfied with healthcare?',
                marginError: 0.025, // 2.5%
                priorEstimate: 0.72,
                costPerResponse: 30,
                goal: 'Measure healthcare satisfaction within ¬±2.5% with 95% confidence'
            },
            'employment-survey': {
                name: 'Youth Employment Status Survey',
                description: 'Employment Canada studying youth employment rates for targeted program development.',
                question: 'What percentage of youth are employed?',
                marginError: 0.04, // 4%
                priorEstimate: 0.68,
                costPerResponse: 35,
                goal: 'Estimate youth employment rate within ¬±4% with 95% confidence'
            },
            'business-optimism': {
                name: 'Small Business Optimism Index',
                description: 'Innovation Canada tracking small business optimism for economic policy development.',
                question: 'What percentage of small businesses are optimistic?',
                marginError: 0.05, // 5%
                priorEstimate: 0.41,
                costPerResponse: 45,
                goal: 'Measure business optimism within ¬±5% with 95% confidence'
            }
        };

        function chooseScenario(scenario) {
            currentScenario = scenario;
            
            document.querySelectorAll('.scenario-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            generateProblem(scenario);
            document.getElementById('problemArea').style.display = 'block';
            clearAllInputs();
        }

        function generateProblem(scenario) {
            const scenarioData = scenarios[scenario];
            
            problemData = {
                scenario: scenarioData.name,
                description: scenarioData.description,
                question: scenarioData.question,
                E: scenarioData.marginError,
                p: scenarioData.priorEstimate,
                costPerResponse: scenarioData.costPerResponse,
                goal: scenarioData.goal,
                confidence: 0.95,
                z: 1.96
            };
            
            calculateCorrectAnswers();
            updateDisplay();
        }

        function calculateCorrectAnswers() {
            const { z, p, E } = problemData;
            
            // Calculate p(1-p)
            const pq = p * (1 - p);
            
            // Calculate exact sample size
            const exactN = (Math.pow(z, 2) * pq) / Math.pow(E, 2);
            
            // Round up for practical sample size
            const finalN = Math.ceil(exactN);
            
            correctAnswers = {
                z: z,
                pq: pq,
                exactN: exactN,
                finalN: finalN
            };
        }

        function updateDisplay() {
            document.getElementById('scenarioDescription').innerHTML = 
                `<strong>${problemData.scenario}</strong><br>${problemData.description}`;
            
            document.getElementById('marginError').textContent = `¬±${(problemData.E * 100).toFixed(1)}%`;
            document.getElementById('priorEstimate').textContent = `${(problemData.p * 100).toFixed(0)}%`;
            document.getElementById('studyGoal').textContent = problemData.goal;
            
            // Update formula displays
            document.getElementById('pqDisplay').innerHTML = 
                `p(1-p) = ${problemData.p} √ó (1-${problemData.p}) = ${problemData.p} √ó ${(1-problemData.p).toFixed(2)} = ?`;
            
            document.getElementById('formulaDisplay').innerHTML = 
                `n = (${problemData.z}¬≤ √ó ${(correctAnswers.pq || 'p(1-p)').toFixed(4)}) / (${problemData.E})¬≤`;
            
            updatePriorExplanation();
            updatePrecisionComparison();
            updateCostAnalysis();
        }

        function updatePriorExplanation() {
            const priorPercent = (problemData.p * 100).toFixed(0);
            document.getElementById('priorExplanation').innerHTML = `
                <strong>Using ${priorPercent}% as prior estimate.</strong> This comes from previous surveys or expert judgment.<br><br>
                <strong>Why this matters:</strong> The formula n = (z¬≤ √ó p(1-p)) / E¬≤ depends on p(1-p). 
                This is maximized when p = 0.5 (50%). If no prior information exists, use p = 0.5 for 
                the most conservative (largest) sample size estimate.<br><br>
                <strong>Current p(1-p) = ${(problemData.p * (1-problemData.p)).toFixed(4)}</strong><br>
                <strong>Maximum p(1-p) = 0.25 (when p = 0.5)</strong>
            `;
        }

        function updatePrecisionComparison() {
            const { p, z } = problemData;
            
            // Calculate sample sizes for different margins of error
            const currentE = problemData.E;
            const looserE = currentE + 0.01; // 1% larger margin
            const tighterE = Math.max(0.01, currentE - 0.01); // 1% smaller margin
            
            const pq = p * (1 - p);
            const currentN = Math.ceil((Math.pow(z, 2) * pq) / Math.pow(currentE, 2));
            const looserN = Math.ceil((Math.pow(z, 2) * pq) / Math.pow(looserE, 2));
            const tighterN = Math.ceil((Math.pow(z, 2) * pq) / Math.pow(tighterE, 2));
            
            document.getElementById('precisionComparison').innerHTML = `
                <strong>Precision vs Sample Size Trade-off:</strong><br>
                ‚Ä¢ Looser precision (¬±${(looserE * 100).toFixed(1)}%): n = ${looserN.toLocaleString()}<br>
                ‚Ä¢ Current precision (¬±${(currentE * 100).toFixed(1)}%): n = ${currentN.toLocaleString()}<br>
                ‚Ä¢ Tighter precision (¬±${(tighterE * 100).toFixed(1)}%): n = ${tighterN.toLocaleString()}<br>
                <em>Small changes in precision requirements dramatically affect sample size!</em>
            `;
        }

        function updateCostAnalysis() {
            if (correctAnswers.finalN !== undefined) {
                const totalCost = correctAnswers.finalN * problemData.costPerResponse;
                const timeEstimate = Math.ceil(correctAnswers.finalN / 100); // Assume 100 responses per day
                
                // Calculate worst-case scenario (p = 0.5)
                const worstCaseN = Math.ceil((Math.pow(problemData.z, 2) * 0.25) / Math.pow(problemData.E, 2));
                const worstCaseCost = worstCaseN * problemData.costPerResponse;
                
                document.getElementById('costAnalysis').innerHTML = `
                    <strong>${problemData.scenario} Resource Planning:</strong><br>
                    Sample Size Needed: ${correctAnswers.finalN.toLocaleString()} responses<br>
                    Estimated Cost: $${totalCost.toLocaleString()} (at $${problemData.costPerResponse}/response)<br>
                    Estimated Fieldwork Time: ${timeEstimate} working days<br><br>
                    <strong>Conservative Planning:</strong> If no prior estimate available, use p = 0.5<br>
                    Worst-case sample needed: ${worstCaseN.toLocaleString()} (Cost: $${worstCaseCost.toLocaleString()})<br><br>
                    <strong>Strategic Considerations:</strong> Consider if slightly larger margin of error 
                    (e.g., ¬±${((problemData.E + 0.01) * 100).toFixed(1)}% vs ¬±${(problemData.E * 100).toFixed(1)}%) 
                    could significantly reduce costs while still meeting policy needs.
                `;
                
                document.getElementById('finalSampleSize').innerHTML = `
                    Required Sample Size: ${correctAnswers.finalN.toLocaleString()} responses<br>
                    <div style="font-size: 0.8em; margin-top: 5px;">Margin of Error: ¬±${(problemData.E * 100).toFixed(1)}% with 95% confidence</div>
                `;
            }
        }

        function checkAnswer(inputId, correctValue, tolerance = null) {
            const input = document.getElementById(inputId);
            const userAnswer = parseFloat(input.value);
            
            if (isNaN(userAnswer)) {
                input.className = '';
                return false;
            }
            
            // Set tolerance based on value type
            if (!tolerance) {
                if (inputId === 'zInput') tolerance = 0.01;
                else if (inputId === 'pqInput') tolerance = 0.0001;
                else if (inputId === 'exactInput') tolerance = 1;
                else tolerance = 0;
            }
            
            const isCorrect = Math.abs(userAnswer - correctValue) <= tolerance;
            input.className = isCorrect ? 'correct' : 'incorrect';
            
            if (isCorrect && inputId === 'finalInput') {
                updateCostAnalysis();
            }
            
            return isCorrect;
        }

        function checkZ() {
            return checkAnswer('zInput', correctAnswers.z, 0.01);
        }

        function checkPQ() {
            return checkAnswer('pqInput', correctAnswers.pq, 0.0001);
        }

        function checkExact() {
            return checkAnswer('exactInput', correctAnswers.exactN, 1);
        }

        function checkFinal() {
            return checkAnswer('finalInput', correctAnswers.finalN, 0);
        }

        function showAnswer(answerType) {
            const answerDiv = document.getElementById(answerType + '-answer');
            
            switch(answerType) {
                case 'z':
                    answerDiv.innerHTML = `‚úÖ Z-critical = ${correctAnswers.z}`;
                    break;
                case 'pq':
                    answerDiv.innerHTML = `‚úÖ p(1-p) = ${correctAnswers.pq.toFixed(4)}`;
                    break;
                case 'exact':
                    answerDiv.innerHTML = `‚úÖ Exact n = ${correctAnswers.exactN.toFixed(1)}`;
                    break;
                case 'final':
                    answerDiv.innerHTML = `‚úÖ Final n = ${correctAnswers.finalN.toLocaleString()}`;
                    break;
            }
            
            answerDiv.style.display = 'block';
        }

        function showSteps(stepType) {
            const tutorialDiv = document.getElementById(stepType + '-tutorial');
            
            if (stepType === 'z-critical') {
                tutorialDiv.innerHTML = `
                    <h4>üìä Z-Critical for Proportion Sample Size:</h4>
                    <div class="tutorial-step">
                        <strong>For 95% confidence:</strong><br>
                        Œ± = 0.05, so Œ±/2 = 0.025<br>
                        Z‚ÇÄ.‚ÇÄ‚ÇÇ‚ÇÖ = 1.96 (same as for means)
                    </div>
                    <div class="tutorial-step">
                        <strong>Common confidence levels:</strong><br>
                        90% confidence: Z = 1.645<br>
                        95% confidence: Z = 1.96<br>
                        99% confidence: Z = 2.576
                    </div>
                `;
                
            } else if (stepType === 'pq-calculation') {
                tutorialDiv.innerHTML = `
                    <h4>üßÆ p(1-p) Calculation:</h4>
                    <div class="tutorial-step">
                        <strong>Formula:</strong> p(1-p)<br>
                        p(1-p) = ${problemData.p} √ó (1 - ${problemData.p})<br>
                        p(1-p) = ${problemData.p} √ó ${(1 - problemData.p).toFixed(2)}<br>
                        p(1-p) = ${correctAnswers.pq.toFixed(4)}
                    </div>
                    <div class="tutorial-step">
                        <strong>Why p(1-p)?</strong><br>
                        This represents the variance of a proportion<br>
                        Maximum when p = 0.5: 0.5 √ó 0.5 = 0.25<br>
                        Use p = 0.5 when no prior estimate available (most conservative)
                    </div>
                `;
                
            } else if (stepType === 'exact-calculation') {
                tutorialDiv.innerHTML = `
                    <h4>üßÆ Proportion Sample Size Formula:</h4>
                    <div class="tutorial-step">
                        <strong>Formula:</strong> n = (z¬≤ √ó p(1-p)) / E¬≤<br>
                        n = (${problemData.z}¬≤ √ó ${correctAnswers.pq.toFixed(4)}) / (${problemData.E})¬≤<br>
                        n = (${(problemData.z ** 2).toFixed(4)} √ó ${correctAnswers.pq.toFixed(4)}) / ${(problemData.E ** 2).toFixed(6)}<br>
                        n = ${(problemData.z ** 2 * correctAnswers.pq).toFixed(4)} / ${(problemData.E ** 2).toFixed(6)}<br>
                        n = ${correctAnswers.exactN.toFixed(1)}
                    </div>
                    <div class="tutorial-step">
                        <strong>Formula components:</strong><br>
                        z¬≤ = confidence level factor<br>
                        p(1-p) = proportion variability<br>
                        E¬≤ = desired precision squared
                    </div>
                `;
                
            } else if (stepType === 'rounding-logic') {
                tutorialDiv.innerHTML = `
                    <h4>üìè Rounding for Proportion Sample Size:</h4>
                    <div class="tutorial-step">
                        <strong>Exact calculation:</strong> n = ${correctAnswers.exactN.toFixed(1)}<br>
                        <strong>Rounded UP:</strong> n = ${correctAnswers.finalN}
                    </div>
                    <div class="tutorial-step">
                        <strong>Why round up?</strong><br>
                        Ensures margin of error is ‚â§ target requirement<br>
                        Rounding down would give larger margin of error than desired<br>
                        Small cost of extra responses vs. risk of inadequate precision
                    </div>
                    <div class="tutorial-step">
                        <strong>Practical polling considerations:</strong><br>
                        Add 15-25% for non-response and refusals<br>
                        Consider stratification and weighting needs<br>
                        Account for design effects in complex surveys
                    </div>
                `;
            }
            
            tutorialDiv.style.display = tutorialDiv.style.display === 'none' ? 'block' : 'none';
        }

        function checkAllSteps() {
            const results = [checkZ(), checkPQ(), checkExact(), checkFinal()];
            const correct = results.filter(r => r).length;
            
            alert(`You got ${correct}/4 steps correct!\n\n${correct === 4 ? 'üéâ Perfect proportion sample size planning!' : 'Use the Steps buttons to see detailed solutions.'}`);
        }

        function generateNewProblem() {
            if (currentScenario) {
                // Generate variation in requirements
                const scenarioData = scenarios[currentScenario];
                
                // Vary margin of error (¬±0.5%)
                const baseE = scenarioData.marginError;
                problemData.E = Math.max(0.01, baseE + (Math.random() - 0.5) * 0.01);
                
                // Vary prior estimate (¬±10%)
                const baseP = scenarioData.priorEstimate;
                problemData.p = Math.min(0.95, Math.max(0.05, baseP + (Math.random() - 0.5) * 0.2));
                
                calculateCorrectAnswers();
                updateDisplay();
                clearAllInputs();
            } else {
                alert('Please select a scenario first.');
            }
        }

        function clearAllInputs() {
            const inputs = ['zInput', 'pqInput', 'exactInput', 'finalInput'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = '';
                    input.className = '';
                }
                
                const answerDiv = document.getElementById(id.replace('Input', '') + '-answer');
                if (answerDiv) answerDiv.style.display = 'none';
            });
            
            // Hide all tutorial boxes
            ['z-critical-tutorial', 'pq-calculation-tutorial', 'exact-calculation-tutorial', 'rounding-logic-tutorial'].forEach(id => {
                const div = document.getElementById(id);
                if (div) div.style.display = 'none';
            });
            
            // Reset final display
            document.getElementById('finalSampleSize').textContent = 'Complete calculations to see sample size recommendation';
        }

        function showProportionSizeSummary() {
            alert(`üìä Sample Size Planning for Proportions:\n\n` +
                `PLANNING FORMULA:\n` +
                `n = (z¬≤ √ó p(1-p)) / E¬≤\n` +
                `where:\n` +
                `‚Ä¢ z = confidence level critical value\n` +
                `‚Ä¢ p = estimated proportion (use 0.5 if unknown)\n` +
                `‚Ä¢ E = desired margin of error\n\n` +
                `KEY FACTORS:\n` +
                `‚Ä¢ Higher confidence ‚Üí Larger sample\n` +
                `‚Ä¢ Smaller margin of error ‚Üí Much larger sample\n` +
                `‚Ä¢ p closer to 0.5 ‚Üí Larger sample needed\n` +
                `‚Ä¢ p = 0.5 gives most conservative estimate\n\n` +
                `PRACTICAL STEPS:\n` +
                `1. Define precision requirements (E)\n` +
                `2. Choose confidence level (z)\n` +
                `3. Estimate proportion (p) or use 0.5\n` +
                `4. Calculate and round UP\n` +
                `5. Add buffer for non-response (15-25%)\n\n` +
                `üá®üá¶ POLLING APPLICATIONS:\n` +
                `‚Ä¢ Election polling accuracy\n` +
                `‚Ä¢ Policy support measurement\n` +
                `‚Ä¢ Market research planning\n` +
                `‚Ä¢ Public opinion surveys\n` +
                `‚Ä¢ Economic confidence tracking`);
        }
    </script>
</body>
</html>
